<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ITS Demo - Inference-Time Scaling</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Azeret+Mono:wght@400;500;600;700;800&family=Public+Sans:wght@300;400;500;600;700&family=IBM+Plex+Mono:wght@400;500;600&display=swap" rel="stylesheet">

    <!-- Performance Visualization V2 CSS -->
    <link rel="stylesheet" href="performance-viz-v2.css">

    <!-- Guided Demo CSS -->
    <link rel="stylesheet" href="guided-demo.css">

    <!-- KaTeX for Math Rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"></script>
    <style>
        :root {
            /* Dark-first - Computational Research Terminal theme */
            /* Nord-inspired palette */
            --bg-primary: #2e3440;
            --bg-secondary: #3b4252;
            --bg-tertiary: #434c5e;
            --bg-elevated: #4c566a;
            --text-primary: #eceff4;
            --text-secondary: #d8dee9;
            --text-tertiary: #8b95a8;
            --border-color: #4c566a;

            /* Frost blue - primary accent */
            --primary: #88c0d0;
            --primary-hover: #8fbcbb;
            --primary-light: rgba(136, 192, 208, 0.15);

            /* Aurora red - secondary accent */
            --accent: #bf616a;
            --accent-hover: #d08770;
            --accent-light: rgba(191, 97, 106, 0.15);

            /* Semantic colors */
            --success: #a3be8c;
            --danger: #bf616a;
            --warning: #ebcb8b;
            --info: #81a1c1;

            --border-focus: #88c0d0;
            --shadow-sm: 0 2px 4px 0 rgba(0, 0, 0, 0.3);
            --shadow: 0 4px 6px 0 rgba(0, 0, 0, 0.4);
            --shadow-lg: 0 10px 20px 0 rgba(0, 0, 0, 0.5);
            --shadow-xl: 0 20px 40px 0 rgba(0, 0, 0, 0.6);

            /* Brutalist: no rounded corners */
            --radius-sm: 0px;
            --radius: 0px;
            --radius-lg: 0px;
            --radius-xl: 0px;
        }

        [data-theme="light"] {
            --bg-primary: #eceff4;
            --bg-secondary: #e5e9f0;
            --bg-tertiary: #d8dee9;
            --bg-elevated: #ffffff;
            --text-primary: #2e3440;
            --text-secondary: #3b4252;
            --text-tertiary: #626c7e;
            --border-color: #d8dee9;
            --primary: #5e81ac;
            --primary-hover: #81a1c1;
            --accent: #bf616a;
            --accent-hover: #d08770;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow: 0 2px 4px 0 rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 8px 16px 0 rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Public Sans', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.65;
            transition: background 0.3s ease, color 0.3s ease;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            position: relative;
        }

        /* Terminal scanline effect */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image:
                repeating-linear-gradient(
                    0deg,
                    rgba(136, 192, 208, 0.03) 0px,
                    rgba(136, 192, 208, 0.03) 1px,
                    transparent 1px,
                    transparent 2px
                );
            pointer-events: none;
            z-index: -1;
            opacity: 0.5;
        }

        /* Subtle grid accent on left edge */
        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(
                180deg,
                var(--primary) 0%,
                var(--accent) 100%
            );
            z-index: 1000;
            pointer-events: none;
        }

        /* Page load animation */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .container {
            animation: fadeInUp 0.6s ease-out;
        }

        h1, h2, h3, h4, h5, h6 {
            font-family: 'Azeret Mono', monospace;
            font-weight: 700;
            letter-spacing: -0.02em;
            text-transform: uppercase;
        }

        .container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 24px;
        }

        @media (min-width: 768px) {
            .container {
                padding: 40px;
            }
        }

        /* Header - Minimal & Clean */
        header {
            background: var(--bg-primary);
            padding: 32px;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
            margin-bottom: 32px;
            border: 2px solid var(--border-color);
            animation: fadeInUp 0.6s ease-out 0.1s both;
        }

        .header-content {
            text-align: center;
            max-width: 800px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 16px;
        }

        .header-logo-section {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .header-logo {
            width: 80px;
            height: 80px;
            object-fit: contain;
        }

        .header-text {
            text-align: left;
        }

        .header-content h1 {
            font-size: 28px;
            margin-bottom: 4px;
            font-weight: 700;
            color: var(--text-primary);
            letter-spacing: -0.02em;
            line-height: 1.2;
        }

        .header-title-main {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 4px;
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 16px;
            font-weight: 400;
            text-align: center;
            margin-top: 4px;
        }

        /* Dark Mode Toggle - Floating */
        .theme-toggle {
            position: fixed;
            top: 24px;
            right: 24px;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 10px 16px;
            background: var(--bg-primary);
            border: 2px solid var(--border-color);
            border-radius: var(--radius);
            transition: all 0.2s ease;
            box-shadow: var(--shadow);
        }

        .theme-toggle:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-1px);
        }

        .theme-icon {
            font-size: 18px;
            transition: transform 0.3s ease;
        }

        .theme-toggle:hover .theme-icon {
            transform: rotate(180deg);
        }

        [data-theme="dark"] .sun-icon {
            display: none;
        }

        [data-theme="light"] .moon-icon {
            display: none;
        }

        /* Landing Page */
        #landingPage {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 40px 20px;
            animation: fadeIn 0.8s ease-out;
        }

        #landingPage.hidden {
            display: none;
        }

        .landing-header {
            text-align: center;
            margin-bottom: 60px;
            max-width: 800px;
        }

        .landing-title {
            font-family: 'Azeret Mono', monospace;
            font-size: 48px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: -0.02em;
            margin-bottom: 16px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .landing-subtitle {
            font-size: 20px;
            color: var(--text-secondary);
            font-weight: 400;
            line-height: 1.6;
        }

        .landing-choices {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 32px;
            max-width: 1200px;
            width: 100%;
        }

        @media (max-width: 768px) {
            .landing-choices {
                grid-template-columns: 1fr;
                gap: 24px;
            }

            .landing-title {
                font-size: 32px;
            }
        }

        .choice-card {
            background: var(--bg-secondary);
            border: 3px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 48px 40px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .choice-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.3s ease;
        }

        .choice-card:hover::before {
            transform: scaleX(1);
        }

        .choice-card:hover {
            border-color: var(--primary);
            transform: translateY(-8px);
            box-shadow: var(--shadow-xl);
        }

        .choice-card.guided {
            border-color: var(--accent);
        }

        .choice-card.guided:hover {
            border-color: var(--accent);
        }

        .choice-card.interactive {
            border-color: var(--primary);
        }

        .choice-card.interactive:hover {
            border-color: var(--primary);
        }

        .choice-icon {
            font-size: 64px;
            margin-bottom: 24px;
            display: block;
        }

        .choice-title {
            font-family: 'Azeret Mono', monospace;
            font-size: 28px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: -0.01em;
            margin-bottom: 16px;
            color: var(--text-primary);
        }

        .choice-card.guided .choice-title {
            color: var(--accent);
        }

        .choice-card.interactive .choice-title {
            color: var(--primary);
        }

        .choice-description {
            font-size: 16px;
            line-height: 1.7;
            color: var(--text-secondary);
            margin-bottom: 24px;
        }

        .choice-features {
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .choice-features li {
            font-size: 14px;
            color: var(--text-tertiary);
            margin-bottom: 12px;
            padding-left: 24px;
            position: relative;
        }

        .choice-features li::before {
            content: 'â†’';
            position: absolute;
            left: 0;
            color: var(--primary);
            font-weight: 700;
        }

        .choice-card.guided .choice-features li::before {
            color: var(--accent);
        }

        .choice-cta {
            display: inline-block;
            margin-top: 24px;
            padding: 14px 28px;
            background: transparent;
            border: 2px solid var(--border-color);
            color: var(--text-primary);
            font-family: 'Azeret Mono', monospace;
            font-size: 14px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            transition: all 0.2s ease;
        }

        .choice-card:hover .choice-cta {
            background: var(--primary);
            border-color: var(--primary);
            color: var(--bg-primary);
        }

        .choice-card.guided:hover .choice-cta {
            background: var(--accent);
            border-color: var(--accent);
        }

        .landing-footer {
            margin-top: 60px;
            text-align: center;
            color: var(--text-tertiary);
            font-size: 14px;
        }

        /* Main demo container - initially hidden */
        #demoContainer.hidden {
            display: none;
        }

        /* Back to Home button */
        .back-to-home {
            position: fixed;
            top: 24px;
            left: 24px;
            z-index: 1001;
            padding: 10px 16px;
            background: var(--bg-primary);
            border: 2px solid var(--border-color);
            border-radius: var(--radius);
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            transition: all 0.2s ease;
            box-shadow: var(--shadow);
            display: none;
        }

        .back-to-home.visible {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .back-to-home:hover {
            background: var(--bg-secondary);
            border-color: var(--primary);
            color: var(--text-primary);
            box-shadow: var(--shadow-lg);
            transform: translateY(-1px);
        }

        /* Guided Demo Scenario Selector */
        .scenario-selector-container {
            display: none;
            margin-bottom: 24px;
            padding: 20px;
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: var(--radius);
        }

        .scenario-selector-container.visible {
            display: block;
        }

        .scenario-selector-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .scenario-selector-label {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .scenario-navigation {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .scenario-nav-btn {
            padding: 6px 12px;
            background: var(--bg-primary);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
            transition: all 0.2s ease;
        }

        .scenario-nav-btn:hover:not(:disabled) {
            background: var(--bg-tertiary);
            border-color: var(--primary);
            color: var(--text-primary);
        }

        .scenario-nav-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .scenario-dropdown {
            flex: 1;
            max-width: 500px;
            padding: 10px 14px;
            background: var(--bg-primary);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-sm);
            color: var(--text-primary);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .scenario-dropdown:hover {
            border-color: var(--primary);
        }

        .scenario-dropdown:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px var(--primary-light);
        }

        .scenario-info {
            display: grid;
            grid-template-columns: auto 1fr auto;
            gap: 16px;
            padding: 16px;
            background: var(--bg-primary);
            border: 2px solid var(--border-color);
            border-radius: var(--radius);
            margin-top: 12px;
        }

        .scenario-tag {
            display: inline-block;
            padding: 4px 10px;
            background: var(--primary-light);
            color: var(--primary);
            border-radius: var(--radius-sm);
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-right: 6px;
        }

        .scenario-meta {
            display: flex;
            gap: 12px;
            font-size: 12px;
            color: var(--text-tertiary);
        }

        .scenario-meta-item {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .guided-demo-badge {
            position: fixed;
            top: 80px;
            right: 24px;
            z-index: 999;
            padding: 8px 14px;
            background: linear-gradient(135deg, rgba(191, 97, 106, 0.15) 0%, rgba(208, 135, 112, 0.15) 100%);
            color: var(--accent);
            border: 2px solid var(--accent);
            border-radius: var(--radius-sm);
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: var(--shadow);
            animation: fadeInUp 0.6s ease-out 0.3s both;
        }

        /* Guided Mode Question Selector */
        .guided-questions {
            display: none;
            margin-bottom: 20px;
        }

        .guided-questions.visible {
            display: block;
        }

        .guided-questions-label {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 12px;
            display: block;
        }

        .guided-questions-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        @media (max-width: 768px) {
            .guided-questions-grid {
                grid-template-columns: 1fr;
            }
        }

        .guided-question-card {
            position: relative;
            display: block;
            cursor: pointer;
            border-radius: var(--radius);
            border: 2px solid var(--border-color);
            background: var(--bg-secondary);
            padding: 16px;
            transition: all 0.2s ease;
        }

        .guided-question-card:hover {
            border-color: var(--primary);
            background: var(--bg-tertiary);
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .guided-question-card input[type="radio"] {
            position: absolute;
            opacity: 0;
            pointer-events: none;
        }

        .guided-question-card.selected {
            border-color: var(--primary);
            background: var(--primary-light);
            box-shadow: 0 0 0 3px rgba(136, 192, 208, 0.15);
        }

        .guided-question-number {
            display: inline-block;
            width: 24px;
            height: 24px;
            background: var(--primary);
            color: var(--bg-primary);
            border-radius: 50%;
            text-align: center;
            line-height: 24px;
            font-size: 12px;
            font-weight: 700;
            margin-right: 8px;
            flex-shrink: 0;
        }

        .guided-question-text {
            font-size: 14px;
            color: var(--text-primary);
            line-height: 1.5;
            display: flex;
            align-items: flex-start;
        }

        .guided-question-card.selected .guided-question-number {
            background: var(--primary);
            box-shadow: 0 0 0 2px var(--bg-primary), 0 0 0 4px var(--primary);
        }

        /* Expert Mode Toggle - Floating below theme toggle */
        .expert-mode-toggle {
            position: fixed;
            top: 76px;
            right: 24px;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            padding: 10px 16px;
            background: var(--bg-primary);
            border: 2px solid var(--border-color);
            border-radius: var(--radius);
            transition: all 0.2s ease;
            box-shadow: var(--shadow);
        }

        .expert-mode-toggle:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-1px);
        }

        .expert-mode-toggle.active {
            border-color: var(--primary);
            background: var(--primary-light);
        }

        .expert-mode-label {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .expert-mode-toggle.active .expert-mode-label {
            color: var(--primary);
        }

        .expert-mode-icon {
            font-size: 16px;
            transition: transform 0.3s ease;
        }

        .expert-mode-toggle:hover .expert-mode-icon {
            transform: scale(1.1);
        }

        /* Locked control styling */
        .form-group.locked label::after {
            content: "ðŸ”’";
            margin-left: 8px;
            font-size: 12px;
            opacity: 0.6;
        }

        .form-group.locked select,
        .form-group.locked input[type="range"] {
            opacity: 0.6;
            cursor: not-allowed;
            background: var(--bg-secondary);
        }

        .locked-helper {
            font-size: 12px;
            color: var(--text-tertiary);
            margin-top: 6px;
            font-style: italic;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .locked-helper::before {
            content: "â„¹ï¸";
            font-size: 14px;
        }

        /* Hidden in guided mode */
        .expert-only {
            display: none;
        }

        .expert-mode .expert-only {
            display: block;
        }

        /* Section Styling */
        .section {
            background: var(--bg-primary);
            padding: 32px;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
            margin-bottom: 24px;
            border: 2px solid var(--border-color);
            animation: fadeInUp 0.6s ease-out calc(0.2s + var(--animation-delay, 0s)) both;
        }

        .section:nth-child(2) { --animation-delay: 0.05s; }
        .section:nth-child(3) { --animation-delay: 0.1s; }
        .section:nth-child(4) { --animation-delay: 0.15s; }

        /* Use Case Cards */
        .use-case-card {
            position: relative;
            display: block;
            cursor: pointer;
            border-radius: var(--radius-lg);
            border: 2px solid var(--border-color);
            background: var(--bg-secondary);
            transition: all 0.2s ease;
            overflow: hidden;
        }

        .use-case-card:hover {
            border-color: var(--primary);
            box-shadow: var(--shadow);
            transform: translateY(-2px);
        }

        .use-case-card input[type="radio"] {
            position: absolute;
            opacity: 0;
            pointer-events: none;
        }

        .use-case-card input[type="radio"]:checked + .use-case-content {
            background: var(--primary-light);
            border-color: var(--primary);
        }

        .use-case-card input[type="radio"]:checked ~ .use-case-content::before {
            content: 'âœ“';
            position: absolute;
            top: 12px;
            right: 12px;
            width: 24px;
            height: 24px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 600;
        }

        .use-case-content {
            position: relative;
            padding: 24px;
            background: transparent;
            border: 2px solid transparent;
            border-radius: var(--radius-lg);
            transition: all 0.2s ease;
        }

        .use-case-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .use-case-icon {
            font-size: 28px;
        }

        .use-case-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0;
        }

        .use-case-description {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 16px;
            line-height: 1.5;
        }

        .use-case-comparison {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px;
            background: var(--bg-primary);
            border-radius: var(--radius);
            font-size: 12px;
            font-weight: 500;
        }

        .comparison-item {
            flex: 1;
            text-align: center;
            padding: 6px 8px;
            background: var(--bg-secondary);
            border-radius: var(--radius-sm);
            color: var(--text-secondary);
        }

        .comparison-item.highlight {
            background: var(--primary-light);
            color: var(--primary);
            font-weight: 600;
        }

        .comparison-vs {
            font-size: 11px;
            color: var(--text-tertiary);
            font-weight: 400;
        }

        @media (max-width: 768px) {
            .section > div[style*="grid-template-columns"] {
                grid-template-columns: 1fr !important;
            }

            .use-case-title {
                font-size: 14px;
            }

            .use-case-description {
                font-size: 13px;
            }
        }

        .section-header {
            margin-bottom: 24px;
        }

        .section-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 4px;
            color: var(--text-primary);
        }

        .section-description {
            font-size: 14px;
            color: var(--text-secondary);
            font-weight: 400;
        }

        /* Algorithm Info Card - Expandable */
        .algorithm-info {
            margin-top: 16px;
            padding: 20px;
            background: var(--primary-light);
            border-radius: var(--radius);
            border-left: 3px solid var(--primary);
            animation: slideDown 0.2s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .fade-in {
            animation: fadeIn 0.3s ease;
        }

        .algorithm-info-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
        }

        .algorithm-type-badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 12px;
            border-radius: var(--radius-sm);
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .algorithm-type-badge.outcome {
            background: var(--success);
            color: white;
        }

        .algorithm-type-badge.process {
            background: var(--info);
            color: white;
        }

        .algorithm-info h3 {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0;
        }

        .algorithm-info p {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 10px;
            line-height: 1.6;
        }

        .algorithm-info .use-case {
            font-size: 13px;
            color: var(--primary);
            font-weight: 500;
        }

        /* Form Controls - Clean & Modern */
        .form-grid {
            display: grid;
            gap: 20px;
        }

        @media (min-width: 768px) {
            .form-grid {
                grid-template-columns: 2fr 1fr;
            }
        }

        .form-group {
            margin-bottom: 0;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 14px;
            color: var(--text-primary);
        }

        .label-helper {
            color: var(--text-tertiary);
            font-weight: 400;
            font-size: 13px;
        }

        select, textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border-color);
            border-radius: var(--radius);
            font-size: 14px;
            font-family: inherit;
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: all 0.2s ease;
        }

        select:hover, textarea:hover {
            border-color: var(--text-tertiary);
        }

        select:focus, textarea:focus {
            outline: none;
            border-color: var(--border-focus);
            box-shadow: 0 0 0 3px rgba(13, 148, 136, 0.1);
        }

        textarea {
            min-height: 120px;
            resize: vertical;
            line-height: 1.6;
        }

        textarea:disabled {
            background: var(--bg-secondary);
            color: var(--text-secondary);
            cursor: not-allowed;
            opacity: 0.8;
            border-color: var(--border-color);
        }

        /* Budget Slider - Modern Design */
        .slider-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .slider-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .slider-container input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: linear-gradient(to right, var(--primary) 0%, var(--primary) 12.5%, var(--border-color) 12.5%, var(--border-color) 100%);
            outline: none;
            -webkit-appearance: none;
            appearance: none;
        }

        .slider-container input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            transition: all 0.2s ease;
            border: 3px solid var(--bg-primary);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .slider-container input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.15);
            box-shadow: 0 0 0 8px rgba(13, 148, 136, 0.1);
        }

        .slider-container input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            transition: all 0.2s ease;
            border: 3px solid var(--bg-primary);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .budget-value {
            font-weight: 600;
            min-width: 40px;
            text-align: center;
            padding: 6px 16px;
            background: var(--primary-light);
            color: var(--primary);
            border-radius: var(--radius-sm);
            font-size: 15px;
        }

        /* Example Questions - Subtle */
        .example-questions-container {
            margin-top: 12px;
        }

        .example-label {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 13px;
            color: var(--text-secondary);
        }

        .example-select {
            width: 100%;
            padding: 10px 14px;
            border: 2px solid var(--border-color);
            border-radius: var(--radius);
            font-size: 13px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .example-select:hover {
            border-color: var(--text-tertiary);
        }

        .example-select:focus {
            outline: none;
            border-color: var(--border-focus);
            box-shadow: 0 0 0 3px rgba(13, 148, 136, 0.1);
        }

        /* Action Buttons - Modern & Clean */
        .action-buttons {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin-top: 24px;
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: var(--radius);
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: 'Inter', sans-serif;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
            box-shadow: var(--shadow-sm);
        }

        .btn-primary:hover:not(:disabled) {
            background: var(--primary-hover);
            transform: translateY(-1px);
            box-shadow: var(--shadow-lg);
        }

        .btn-primary:active:not(:disabled) {
            transform: translateY(0);
        }

        .btn-secondary {
            background: transparent;
            color: var(--text-secondary);
            border: 2px solid var(--border-color);
        }

        .btn-secondary:hover:not(:disabled) {
            background: var(--bg-secondary);
            border-color: var(--text-tertiary);
            color: var(--text-primary);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        /* Performance Metrics - Removed from main dashboard, moved to Performance Details */

        /* Results - Clean Side-by-Side */
        .results {
            display: grid;
            gap: 20px;
            margin-bottom: 24px;
        }

        @media (min-width: 1024px) {
            .results {
                grid-template-columns: 1fr 1fr;
            }

            .results.three-column {
                grid-template-columns: 1fr 1fr 1fr;
            }
        }

        @media (min-width: 768px) and (max-width: 1023px) {
            .results.three-column {
                grid-template-columns: 1fr 1fr;
            }

            .results.three-column .result-pane:last-child {
                grid-column: 1 / -1;
            }
        }

        .result-pane {
            background: var(--bg-primary);
            padding: 24px;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
            border: 2px solid var(--border-color);
            min-height: 400px;
            position: relative;
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
        }

        .result-pane:hover {
            box-shadow: var(--shadow);
        }

        .pane-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 2px solid var(--border-color);
        }

        .pane-title {
            font-size: 16px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-primary);
        }

        .pane-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .pane-indicator.baseline {
            background: var(--text-tertiary);
            box-shadow: 0 0 0 3px rgba(156, 163, 175, 0.15);
        }

        .pane-indicator.its {
            background: var(--primary);
            box-shadow: 0 0 0 3px rgba(13, 148, 136, 0.15);
        }

        .pane-indicator.frontier {
            background: var(--success);
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.15);
        }

        /* Subtle background tint for ITS pane */
        .results .result-pane:last-child {
            background: linear-gradient(to bottom, var(--bg-primary), var(--bg-primary) 50%, rgba(13, 148, 136, 0.02) 100%);
        }

        .latency-badge {
            background: var(--bg-secondary);
            padding: 4px 10px;
            border-radius: var(--radius-sm);
            font-size: 12px;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .cost-badge {
            background: rgba(16, 185, 129, 0.1);
            border: 2px solid rgba(16, 185, 129, 0.3);
            color: var(--success);
            padding: 4px 10px;
            border-radius: var(--radius-sm);
            font-size: 12px;
            font-weight: 600;
        }

        .cost-badge.expensive {
            background: rgba(239, 68, 68, 0.1);
            border: 2px solid rgba(239, 68, 68, 0.3);
            color: var(--danger);
        }

        .size-badge {
            padding: 3px 8px;
            border-radius: var(--radius-sm);
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            margin-left: 6px;
        }

        .size-badge.large {
            background: rgba(13, 148, 136, 0.1);
            color: var(--primary);
            border: 2px solid rgba(13, 148, 136, 0.3);
        }

        .size-badge.small {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
            border: 2px solid rgba(16, 185, 129, 0.3);
        }

        .answer-content {
            font-size: 15px;
            line-height: 1.8;
            color: var(--text-primary);
            flex: 1;
            overflow-y: auto;
            padding: 4px;
            margin: -4px;
        }

        .answer-content p {
            margin-bottom: 16px;
        }

        .answer-content p:last-child {
            margin-bottom: 0;
        }

        /* Math Expression Styling */
        .answer-content .katex {
            font-size: 1.05em;
        }

        .answer-content .katex-display {
            margin: 20px 0;
            padding: 20px;
            background: var(--bg-secondary);
            border-radius: var(--radius);
            border: 2px solid var(--border-color);
            overflow-x: auto;
            text-align: center;
            max-width: 100%;
        }

        .answer-content .katex-display::-webkit-scrollbar {
            height: 6px;
        }

        .answer-content .katex-display::-webkit-scrollbar-track {
            background: transparent;
        }

        .answer-content .katex-display::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 3px;
        }

        .answer-content .katex-display::-webkit-scrollbar-thumb:hover {
            background: var(--text-tertiary);
        }

        /* Inline math should stand out slightly */
        .answer-content .katex:not(.katex-display) {
            padding: 2px 4px;
            background: var(--bg-secondary);
            border-radius: 3px;
        }

        /* Inline code and math */
        .answer-content code {
            font-family: 'IBM Plex Mono', monospace;
            background: var(--bg-secondary);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.9em;
            color: var(--primary);
        }

        /* Step markers */
        .answer-step {
            margin-bottom: 24px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--border-color);
            display: flex;
            gap: 12px;
            align-items: flex-start;
        }

        .answer-step:last-child {
            border-bottom: none;
            padding-bottom: 0;
            margin-bottom: 0;
        }

        .step-marker {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 28px;
            height: 28px;
            background: var(--primary-light);
            color: var(--primary);
            border-radius: 50%;
            font-size: 13px;
            font-weight: 600;
            flex-shrink: 0;
            margin-top: 2px;
        }

        .answer-step > span:last-child {
            flex: 1;
            padding-top: 2px;
        }

        /* Final answer at the top */
        .final-answer-section {
            margin-bottom: 20px;
            padding: 20px 24px;
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-lg);
            animation: slideDown 0.3s ease;
        }

        .final-answer-label {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-secondary);
            font-weight: 600;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .final-answer-content {
            font-size: 15px;
            font-weight: 400;
            color: var(--text-primary);
            line-height: 1.7;
            text-align: left;
        }

        .final-answer-content p {
            margin: 0.75em 0;
        }

        .final-answer-content p:first-child {
            margin-top: 0;
        }

        .final-answer-content p:last-child {
            margin-bottom: 0;
        }

        /* Expandable Sections */
        .expandable-section {
            margin-top: 16px;
            border: 2px solid var(--border-color);
            border-radius: var(--radius-md);
            overflow: hidden;
            background: var(--bg-primary);
            transition: all 0.2s ease;
        }

        .expandable-section:hover {
            border-color: var(--primary);
        }

        .expand-button {
            width: 100%;
            padding: 12px 16px;
            background: var(--bg-secondary);
            border: none;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-secondary);
            transition: all 0.2s ease;
        }

        .expand-button:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .expand-icon {
            transition: transform 0.3s ease;
            flex-shrink: 0;
        }

        .expandable-section.expanded .expand-icon {
            transform: rotate(180deg);
        }

        .expandable-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .expandable-section.expanded .expandable-content {
            max-height: 5000px;
        }

        .details-section {
            padding: 16px;
            background: var(--bg-secondary);
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 2px solid var(--border-color);
        }

        .detail-row:last-child {
            border-bottom: none;
        }

        .detail-label {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .detail-value {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            font-family: 'IBM Plex Mono', monospace;
        }

        /* Algorithm Trace Visualization */
        .trace-section {
            padding: 16px;
            background: var(--bg-secondary);
        }

        .trace-summary {
            font-size: 13px;
            color: var(--text-tertiary);
            margin-bottom: 12px;
            font-style: italic;
        }

        .candidate-card {
            background: var(--bg-primary);
            border: 2px solid var(--border-color);
            border-radius: var(--radius);
            padding: 12px 16px;
            margin-bottom: 8px;
            transition: border-color 0.2s ease;
        }

        .candidate-card.winner {
            border-color: var(--success);
            background: rgba(163, 190, 140, 0.08);
        }

        .candidate-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .candidate-label {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .candidate-card.winner .candidate-label {
            color: var(--success);
        }

        .winner-badge {
            font-size: 11px;
            font-weight: 700;
            color: var(--success);
            background: rgba(163, 190, 140, 0.15);
            padding: 2px 8px;
            border-radius: 4px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .candidate-content {
            font-size: 13px;
            line-height: 1.5;
            color: var(--text-secondary);
            max-height: 80px;
            overflow: hidden;
            position: relative;
        }

        .candidate-content.expanded-candidate {
            max-height: none;
        }

        .candidate-content::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 30px;
            background: linear-gradient(transparent, var(--bg-primary));
            pointer-events: none;
        }

        .candidate-content.expanded-candidate::after {
            display: none;
        }

        .candidate-card.winner .candidate-content::after {
            background: linear-gradient(transparent, rgba(46, 52, 64, 0.92));
        }

        .candidate-expand-btn {
            font-size: 11px;
            color: var(--primary);
            cursor: pointer;
            background: none;
            border: none;
            padding: 4px 0;
            margin-top: 4px;
        }

        .candidate-expand-btn:hover {
            text-decoration: underline;
        }

        .candidate-metric {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 8px;
        }

        .metric-bar-container {
            flex: 1;
            height: 6px;
            background: var(--bg-tertiary);
            border-radius: 3px;
            overflow: hidden;
        }

        .metric-bar {
            height: 100%;
            border-radius: 3px;
            transition: width 0.5s ease;
        }

        .metric-bar.score-bar {
            background: var(--primary);
        }

        .candidate-card.winner .metric-bar.score-bar {
            background: var(--success);
        }

        .metric-bar.vote-bar {
            background: var(--info);
        }

        .candidate-card.winner .metric-bar.vote-bar {
            background: var(--success);
        }

        .metric-bar.weight-bar {
            background: var(--primary);
        }

        .candidate-card.winner .metric-bar.weight-bar {
            background: var(--success);
        }

        .metric-value {
            font-size: 12px;
            font-weight: 600;
            font-family: 'IBM Plex Mono', monospace;
            color: var(--text-secondary);
            min-width: 50px;
            text-align: right;
        }

        .metric-label {
            font-size: 11px;
            color: var(--text-tertiary);
            min-width: 40px;
        }

        /* Vote distribution for Self-Consistency */
        .vote-distribution {
            margin-bottom: 16px;
        }

        .vote-distribution-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .vote-row {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 6px;
        }

        .vote-answer {
            font-size: 12px;
            color: var(--text-secondary);
            min-width: 80px;
            max-width: 120px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            font-family: 'IBM Plex Mono', monospace;
        }

        .vote-bar-container {
            flex: 1;
            height: 8px;
            background: var(--bg-tertiary);
            border-radius: 4px;
            overflow: hidden;
        }

        .vote-bar-fill {
            height: 100%;
            border-radius: 4px;
            background: var(--info);
            transition: width 0.5s ease;
        }

        .vote-count {
            font-size: 12px;
            font-weight: 600;
            font-family: 'IBM Plex Mono', monospace;
            color: var(--text-secondary);
            min-width: 30px;
            text-align: right;
        }

        /* Iteration tabs for Particle Gibbs */
        .iteration-tabs {
            display: flex;
            gap: 4px;
            margin-bottom: 12px;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 8px;
        }

        .iteration-tab {
            padding: 6px 14px;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-tertiary);
            background: var(--bg-primary);
            border: 2px solid var(--border-color);
            border-radius: 6px 6px 0 0;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .iteration-tab:hover {
            color: var(--text-secondary);
            border-color: var(--primary);
        }

        .iteration-tab.active {
            color: var(--primary);
            background: var(--bg-tertiary);
            border-color: var(--primary);
        }

        .iteration-content {
            display: none;
        }

        .iteration-content.active {
            display: block;
        }

        /* Guided Wizard Styles */
        .guided-wizard {
            margin-bottom: 32px;
            padding: 32px;
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
        }

        .wizard-step {
            animation: fadeInUp 0.4s ease-out;
        }

        .wizard-step-title {
            font-size: 18px;
            margin-bottom: 24px;
            color: var(--primary);
            text-align: center;
        }

        /* Wizard Use Case Cards */
        .wizard-use-case-cards {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
        }

        .wizard-card {
            padding: 32px 24px;
            background: var(--bg-primary);
            border: 2px solid var(--border-color);
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            border-radius: var(--radius-lg);
        }

        .wizard-card:hover {
            border-color: var(--primary);
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .wizard-card.selected {
            border-color: var(--primary);
            background: var(--primary-light);
            transform: scale(0.97);
            box-shadow: inset 0 0 0 2px var(--primary);
        }

        .wizard-card-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        .wizard-card h4 {
            font-size: 18px;
            margin-bottom: 12px;
            color: var(--text-primary);
        }

        .wizard-card p {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 16px;
            line-height: 1.6;
        }

        .scenario-count {
            display: inline-block;
            font-size: 12px;
            color: var(--text-tertiary);
            padding: 4px 12px;
            background: var(--bg-tertiary);
            border-radius: 12px;
        }

        /* Model Selection */
        .model-selection-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .model-card {
            padding: 24px;
            background: var(--bg-primary);
            border: 2px solid var(--border-color);
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: var(--radius);
        }

        .model-card:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .model-card.selected {
            border-color: var(--primary);
            background: var(--primary-light);
            transform: scale(0.97);
            box-shadow: inset 0 0 0 2px var(--primary);
        }

        .model-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .model-name {
            font-size: 16px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .model-provider {
            font-size: 11px;
            color: var(--text-tertiary);
            text-transform: uppercase;
            padding: 2px 8px;
            background: var(--bg-tertiary);
            border-radius: 4px;
        }

        .frontier-match {
            font-size: 13px;
            color: var(--text-secondary);
            margin-top: 8px;
            font-style: italic;
        }

        /* Algorithm Selection */
        .algorithm-selection-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .algorithm-card {
            padding: 24px;
            background: var(--bg-primary);
            border: 2px solid var(--border-color);
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: var(--radius);
        }

        .algorithm-card:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .algorithm-card.selected {
            border-color: var(--primary);
            background: var(--primary-light);
            transform: scale(0.97);
            box-shadow: inset 0 0 0 2px var(--primary);
        }

        .algorithm-card.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            pointer-events: none;
        }

        .algorithm-name {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .algorithm-type-badge {
            display: inline-block;
            font-size: 10px;
            padding: 2px 8px;
            background: var(--info);
            color: var(--bg-primary);
            text-transform: uppercase;
            margin-bottom: 12px;
            border-radius: 4px;
        }

        .algorithm-description {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.5;
            margin-bottom: 12px;
        }

        .algorithm-usecase {
            font-size: 12px;
            color: var(--text-tertiary);
            font-style: italic;
        }

        /* Wizard Breadcrumbs */
        .wizard-breadcrumbs {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 12px;
            margin-top: 32px;
            padding-top: 24px;
            border-top: 1px solid var(--border-color);
        }

        .breadcrumb {
            font-size: 12px;
            text-transform: uppercase;
            color: var(--text-tertiary);
            font-weight: 600;
            letter-spacing: 0.05em;
        }

        .breadcrumb.active {
            color: var(--primary);
        }

        .breadcrumb.completed {
            color: var(--success);
        }

        .breadcrumb-separator {
            color: var(--border-color);
        }

        /* Clickable completed breadcrumbs */
        .breadcrumb.completed {
            cursor: pointer;
            text-decoration: underline;
            text-underline-offset: 4px;
        }
        .breadcrumb.completed:hover {
            color: var(--primary);
        }

        /* Per-step back buttons */
        .wizard-back-step-btn {
            background: none;
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 13px;
            padding: 4px 12px;
            margin-bottom: 16px;
            transition: all 0.2s ease;
        }
        .wizard-back-step-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        /* Algorithm step reassurance */
        .wizard-step-reassurance {
            text-align: center;
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 24px;
            font-style: italic;
            line-height: 1.5;
        }

        /* Styled prompt display */
        .wizard-prompt-display {
            padding: 20px;
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-left: 4px solid var(--primary);
            margin-bottom: 16px;
        }
        .wizard-prompt-label {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-tertiary);
            font-weight: 600;
            margin-bottom: 8px;
        }
        .wizard-prompt-text {
            font-size: 15px;
            line-height: 1.6;
            color: var(--text-primary);
        }

        /* Results headline banner */
        .wizard-results-headline {
            padding: 20px 24px;
            background: linear-gradient(135deg, var(--primary-light), transparent);
            border: 2px solid var(--primary);
            margin-bottom: 20px;
            text-align: center;
        }
        .headline-text {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            line-height: 1.5;
        }

        /* Quality metric highlight */
        .perf-metric-card.quality-highlight {
            border-color: var(--success);
            border-width: 2px;
        }

        /* Trace intro */
        .trace-intro {
            margin-bottom: 12px;
        }
        .trace-intro strong {
            color: var(--primary);
            font-size: 14px;
        }
        .trace-intro p {
            font-size: 13px;
            color: var(--text-secondary);
            margin-top: 4px;
            line-height: 1.5;
        }

        /* Copy summary button */
        .copy-summary-btn {
            margin-top: 12px;
            font-size: 13px;
            padding: 6px 16px;
        }

        /* Trace Visualization */
        .trace-visualization-container {
            margin-top: 24px;
            border-top: 2px solid var(--border-color);
            padding-top: 24px;
        }

        .trace-section {
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: var(--radius);
        }

        .trace-toggle {
            width: 100%;
            padding: 16px 20px;
            background: transparent;
            border: none;
            color: var(--text-primary);
            font-family: 'Azeret Mono', monospace;
            font-size: 14px;
            font-weight: 700;
            text-transform: uppercase;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.2s ease;
        }

        .trace-toggle:hover {
            background: var(--bg-tertiary);
            color: var(--primary);
        }

        .trace-toggle.active {
            color: var(--primary);
        }

        .trace-toggle-icon {
            font-size: 12px;
            transition: transform 0.3s ease;
        }

        .trace-content {
            padding: 20px;
            border-top: 1px solid var(--border-color);
            animation: fadeIn 0.3s ease-out;
        }

        /* Trace Direct Display (wizard mode - no expandable wrapper) */
        .trace-direct-display {
            padding: 16px;
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-md);
            animation: fadeIn 0.3s ease-out;
        }

        /* === Self-Consistency: Voting Arena === */
        .voting-arena {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .voting-arena-header {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .voting-arena-header .arena-icon {
            font-size: 16px;
        }

        .vote-chart {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .vote-chart-row {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 12px;
            border-radius: var(--radius);
            transition: background 0.2s ease;
            position: relative;
        }

        .vote-chart-row.is-winner {
            background: rgba(163, 190, 140, 0.12);
            border: 2px solid var(--success);
        }

        .vote-chart-row:not(.is-winner) {
            background: var(--bg-primary);
            border: 2px solid var(--border-color);
        }

        .vote-chart-rank {
            font-size: 11px;
            font-weight: 700;
            color: var(--text-tertiary);
            min-width: 20px;
            text-align: center;
        }

        .vote-chart-row.is-winner .vote-chart-rank {
            color: var(--success);
        }

        .vote-chart-answer {
            flex: 0 0 120px;
            font-size: 12px;
            font-family: 'IBM Plex Mono', monospace;
            color: var(--text-primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .vote-chart-bar-wrap {
            flex: 1;
            height: 24px;
            background: var(--bg-tertiary);
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }

        .vote-chart-bar {
            height: 100%;
            border-radius: 4px;
            transition: width 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            min-width: 2px;
        }

        .vote-chart-row.is-winner .vote-chart-bar {
            background: linear-gradient(90deg, var(--success), #8fbf7f);
        }

        .vote-chart-row:not(.is-winner) .vote-chart-bar {
            background: var(--bg-elevated);
        }

        .vote-chart-count {
            font-size: 13px;
            font-weight: 700;
            font-family: 'IBM Plex Mono', monospace;
            color: var(--text-secondary);
            min-width: 55px;
            text-align: right;
        }

        .vote-chart-row.is-winner .vote-chart-count {
            color: var(--success);
        }

        .vote-chart-winner-badge {
            font-size: 10px;
            font-weight: 700;
            color: var(--success);
            background: rgba(163, 190, 140, 0.2);
            padding: 1px 6px;
            border-radius: 3px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-left: 4px;
        }

        /* Candidate chips grid */
        .candidate-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 4px;
        }

        .candidate-chip {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            color: var(--text-secondary);
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            cursor: default;
            max-width: 200px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            transition: all 0.2s ease;
        }

        .candidate-chip.is-winner {
            border-color: var(--success);
            color: var(--success);
            background: rgba(163, 190, 140, 0.08);
        }

        .candidate-chip .chip-index {
            font-weight: 700;
            font-size: 10px;
            opacity: 0.6;
        }

        /* Candidates expandable detail area */
        .trace-candidates-detail {
            margin-top: 8px;
        }

        .trace-candidates-toggle {
            font-size: 12px;
            color: var(--primary);
            cursor: pointer;
            background: none;
            border: none;
            padding: 4px 0;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .trace-candidates-toggle:hover {
            text-decoration: underline;
        }

        .trace-candidates-list {
            display: none;
            margin-top: 8px;
        }

        .trace-candidates-list.expanded {
            display: block;
        }

        /* === Best-of-N: Score Leaderboard === */
        .score-leaderboard {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .score-leaderboard-header {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .leaderboard-row {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            border-radius: var(--radius);
            transition: all 0.2s ease;
            position: relative;
        }

        .leaderboard-row.is-winner {
            background: rgba(235, 203, 139, 0.1);
            border: 2px solid var(--warning);
            margin-bottom: 8px;
        }

        .leaderboard-row:not(.is-winner) {
            background: var(--bg-primary);
            border: 2px solid var(--border-color);
        }

        .leaderboard-rank {
            font-size: 14px;
            font-weight: 800;
            min-width: 24px;
            text-align: center;
            color: var(--text-tertiary);
        }

        .leaderboard-row.is-winner .leaderboard-rank {
            color: var(--warning);
            font-size: 16px;
        }

        .leaderboard-content {
            flex: 1;
            min-width: 0;
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .leaderboard-preview {
            font-size: 12px;
            color: var(--text-secondary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            line-height: 1.4;
        }

        .leaderboard-row.is-winner .leaderboard-preview {
            color: var(--text-primary);
            font-weight: 500;
        }

        .leaderboard-bar-wrap {
            height: 8px;
            background: var(--bg-tertiary);
            border-radius: 4px;
            overflow: hidden;
        }

        .leaderboard-bar {
            height: 100%;
            border-radius: 4px;
            transition: width 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            min-width: 2px;
        }

        .leaderboard-score {
            font-size: 14px;
            font-weight: 700;
            font-family: 'IBM Plex Mono', monospace;
            min-width: 50px;
            text-align: right;
        }

        .leaderboard-row.is-winner .leaderboard-score {
            color: var(--warning);
            font-size: 16px;
        }

        .leaderboard-winner-tag {
            font-size: 10px;
            font-weight: 700;
            color: var(--warning);
            background: rgba(235, 203, 139, 0.2);
            padding: 1px 6px;
            border-radius: 3px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .leaderboard-full-text {
            display: none;
            margin-top: 6px;
            font-size: 12px;
            line-height: 1.5;
            color: var(--text-secondary);
            padding: 8px;
            background: var(--bg-secondary);
            border-radius: var(--radius);
            border: 1px solid var(--border-color);
            max-height: 200px;
            overflow-y: auto;
        }

        .leaderboard-full-text.expanded {
            display: block;
        }

        .leaderboard-expand-btn {
            font-size: 11px;
            color: var(--primary);
            cursor: pointer;
            background: none;
            border: none;
            padding: 2px 0;
        }

        .leaderboard-expand-btn:hover {
            text-decoration: underline;
        }

        /* Separator line between winner and rest */
        .leaderboard-separator {
            height: 1px;
            background: var(--border-color);
            margin: 4px 0 8px 0;
        }

        /* Performance Badges */
        .performance-badges {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--border-color);
        }

        .perf-badge {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: var(--bg-tertiary);
            border-radius: 4px;
            font-size: 12px;
        }

        .perf-label {
            color: var(--text-tertiary);
            font-weight: 600;
        }

        .perf-value {
            color: var(--text-primary);
            font-family: 'IBM Plex Mono', monospace;
            font-weight: 500;
        }

        /* Performance Details Section */
        .performance-details-section {
            margin-top: 40px;
            padding: 32px;
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
        }

        .perf-details-header {
            text-align: center;
            margin-bottom: 32px;
        }

        .perf-details-header h3 {
            font-size: 20px;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .perf-details-subtitle {
            font-size: 13px;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .perf-metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .perf-metric-card {
            padding: 20px;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            text-align: center;
            border-radius: var(--radius);
        }

        .perf-metric-label {
            font-size: 12px;
            text-transform: uppercase;
            color: var(--text-tertiary);
            font-weight: 600;
            letter-spacing: 0.05em;
            margin-bottom: 12px;
        }

        .perf-metric-values {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-bottom: 8px;
            font-family: 'IBM Plex Mono', monospace;
            font-size: 16px;
        }

        .metric-baseline {
            color: var(--text-secondary);
        }

        .metric-arrow {
            color: var(--text-tertiary);
            font-size: 14px;
        }

        .metric-its {
            color: var(--primary);
            font-weight: 700;
        }

        .perf-metric-change {
            font-size: 14px;
            font-weight: 700;
        }

        .perf-metric-change.positive {
            color: var(--success);
        }

        .perf-metric-change.negative {
            color: var(--accent);
        }

        .perf-metric-change.neutral {
            color: var(--text-tertiary);
        }

        .perf-metric-note {
            font-size: 11px;
            color: var(--text-tertiary);
            font-style: italic;
        }

        /* Why ITS Helped Banner */
        .why-its-helped-banner {
            display: flex;
            gap: 16px;
            padding: 16px;
            background: var(--primary-light);
            border-left: 4px solid var(--primary);
            border-radius: var(--radius);
            margin-bottom: 20px;
        }

        .why-its-helped-icon {
            font-size: 24px;
            flex-shrink: 0;
        }

        .why-its-helped-content {
            flex: 1;
        }

        .why-its-helped-title {
            font-size: 14px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .why-its-helped-text {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .wizard-use-case-cards {
                grid-template-columns: 1fr;
            }

            .wizard-breadcrumbs {
                font-size: 10px;
                gap: 8px;
            }
        }

        .final-answer-content .katex {
            font-size: 1.1em;
        }

        /* Make display math in final answer look better */
        .final-answer-content .katex-display {
            margin: 8px 0 0 0;
            padding: 0;
            background: transparent;
            border: none;
        }

        /* Chat response - main model output */
        .chat-response {
            padding: 20px 24px;
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-lg);
            margin-bottom: 16px;
            font-size: 15px;
            line-height: 1.7;
            color: var(--text-primary);
            animation: slideDown 0.3s ease;
        }

        .chat-response p {
            margin: 0 0 12px 0;
        }

        .chat-response p:last-child {
            margin-bottom: 0;
        }

        /* No final answer fallback */
        .no-final-answer {
            padding: 12px 16px;
            background: var(--bg-secondary);
            border: 2px dashed var(--border-color);
            border-radius: var(--radius);
            text-align: center;
            color: var(--text-tertiary);
            font-size: 13px;
            margin-bottom: 24px;
        }

        /* Reasoning trace section */
        .reasoning-section {
            padding: 16px;
        }

        .reasoning-section .reasoning-content {
            line-height: 1.6;
            color: var(--text-primary);
        }

        .reasoning-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
            cursor: pointer;
            user-select: none;
            padding: 8px 0;
        }

        .reasoning-header:hover {
            color: var(--primary);
        }

        .reasoning-header:hover .reasoning-title {
            color: var(--primary);
        }

        .reasoning-header:hover .reasoning-toggle {
            color: var(--primary);
        }

        .reasoning-title {
            font-size: 13px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .reasoning-toggle {
            font-size: 12px;
            color: var(--text-tertiary);
            transition: transform 0.2s ease;
        }

        .reasoning-toggle.collapsed {
            transform: rotate(-90deg);
        }

        .reasoning-content {
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .reasoning-content.collapsed {
            max-height: 0 !important;
            opacity: 0;
            margin-top: 0;
        }

        .reasoning-content:not(.collapsed) {
            max-height: 10000px;
            opacity: 1;
        }

        /* Enhanced readability */
        .answer-content strong {
            color: var(--text-primary);
            font-weight: 600;
        }

        .answer-content em {
            color: var(--text-secondary);
            font-style: italic;
        }

        /* List styling */
        .answer-content ul, .answer-content ol {
            margin: 12px 0 16px 20px;
        }

        .answer-content li {
            margin-bottom: 8px;
        }

        /* Custom Scrollbar */
        .answer-content::-webkit-scrollbar {
            width: 6px;
        }

        .answer-content::-webkit-scrollbar-track {
            background: transparent;
        }

        .answer-content::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 3px;
            transition: background 0.2s ease;
        }

        .answer-content::-webkit-scrollbar-thumb:hover {
            background: var(--text-tertiary);
        }

        /* Result Actions - Minimal */
        .result-actions {
            display: flex;
            gap: 6px;
        }

        .action-btn {
            padding: 6px 10px;
            background: transparent;
            border: 2px solid var(--border-color);
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
            color: var(--text-secondary);
        }

        .action-btn:hover {
            background: var(--bg-secondary);
            border-color: var(--text-tertiary);
        }

        /* Expected Answer - Clean */
        .expected-answer-container {
            background: var(--bg-primary);
            border: 2px solid var(--success);
            border-left: 4px solid var(--success);
            border-radius: var(--radius-lg);
            padding: 20px;
            margin-bottom: 24px;
            display: none;
        }

        .expected-answer-container.visible {
            display: block;
        }

        .expected-answer-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
        }

        .check-icon {
            font-size: 20px;
            color: var(--success);
        }

        .expected-answer-header strong {
            font-size: 14px;
            color: var(--text-primary);
            font-weight: 600;
        }

        .expected-answer-content {
            color: var(--text-primary);
            font-size: 14px;
            line-height: 1.8;
            padding: 16px;
            background: var(--bg-secondary);
            border-radius: var(--radius);
        }

        .expected-answer-content .katex {
            font-size: 1.05em;
        }

        .expected-answer-content .katex-display {
            margin: 12px 0;
            padding: 12px;
            background: var(--bg-primary);
            border-radius: var(--radius-sm);
            text-align: center;
        }

        .expected-answer-content p {
            margin-bottom: 12px;
        }

        .expected-answer-content p:last-child {
            margin-bottom: 0;
        }

        /* Highlight matching answers */
        @keyframes highlight {
            0%, 100% { background-color: transparent; }
            50% { background-color: rgba(16, 185, 129, 0.1); }
        }

        .answer-matches {
            animation: highlight 2s ease-in-out;
        }

        /* Analysis Panel - Hidden by default for simplicity */
        .analysis-panel {
            display: none !important;
        }

        /* Loading States - Minimal */
        .spinner {
            border: 2px solid var(--border-color);
            border-top: 2px solid var(--primary);
            border-radius: 50%;
            width: 32px;
            height: 32px;
            animation: spin 0.8s linear infinite;
            margin: 80px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .empty-state {
            color: var(--text-tertiary);
            text-align: center;
            padding: 80px 20px;
            font-size: 14px;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 12px;
            opacity: 0.3;
        }

        /* Loading skeleton */
        .loading-skeleton {
            padding: 20px 0;
        }

        .skeleton-line {
            height: 16px;
            background: linear-gradient(90deg, var(--bg-secondary) 25%, var(--bg-tertiary) 50%, var(--bg-secondary) 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            border-radius: 4px;
            margin-bottom: 12px;
        }

        .skeleton-line:last-child {
            width: 70%;
        }

        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        .error-message {
            background: var(--bg-primary);
            color: var(--danger);
            padding: 16px 20px;
            border-radius: var(--radius-lg);
            margin-bottom: 24px;
            border: 2px solid var(--danger);
            border-left: 4px solid var(--danger);
            font-weight: 400;
            font-size: 14px;
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .results {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 16px;
            }

            .section {
                padding: 24px 20px;
            }

            header {
                padding: 24px 20px;
            }

            .header-logo-section {
                flex-direction: column;
                gap: 12px;
            }

            .header-text {
                text-align: center;
            }

            .header-logo {
                width: 60px;
                height: 60px;
            }

            .header-title-main {
                font-size: 12px;
            }

            .header-content h1 {
                font-size: 20px;
            }

            .subtitle {
                font-size: 14px;
            }

            .theme-toggle {
                top: 16px;
                right: 16px;
                padding: 8px 12px;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .metrics-summary {
                flex-direction: column;
            }

            .result-pane {
                padding: 20px;
            }
        }

        /* Utility Classes */
        .text-gradient {
            background: linear-gradient(135deg, var(--primary), #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Performance Visualization Container */
        #performance-visualization-container {
            position: relative;
            z-index: 1;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px 60px 20px;
        }
    </style>
</head>
<body>
    <!-- Landing Page -->
    <div id="landingPage">
        <div class="landing-header">
            <h1 class="landing-title">Inference-Time Scaling</h1>
            <p class="landing-subtitle">
                Explore how ITS algorithms enhance model performance through computational scaling at inference time
            </p>
        </div>

        <div class="landing-choices">
            <!-- Guided Demo Option -->
            <div class="choice-card guided" onclick="selectExperience('guided')">
                <span class="choice-icon">ðŸ“š</span>
                <h2 class="choice-title">Guided Demo</h2>
                <p class="choice-description">
                    Explore curated examples showing real ITS improvements across different algorithms and providers.
                </p>
                <ul class="choice-features">
                    <li>Pre-loaded scenarios with real results</li>
                    <li>Compare baseline vs ITS side-by-side</li>
                    <li>View algorithm traces and metrics</li>
                    <li>No backend required - instant loading</li>
                    <li>Perfect for presentations and demos</li>
                </ul>
                <div class="choice-cta">Explore Scenarios â†’</div>
            </div>

            <!-- Interactive Demo Option -->
            <div class="choice-card interactive" onclick="selectExperience('interactive')">
                <span class="choice-icon">âš¡</span>
                <h2 class="choice-title">Interactive Demo</h2>
                <p class="choice-description">
                    Run live comparisons with your own questions and configurations using real models.
                </p>
                <ul class="choice-features">
                    <li>Ask your own questions</li>
                    <li>Choose models and algorithms</li>
                    <li>Adjust compute budgets</li>
                    <li>See real-time ITS improvements</li>
                    <li>Compare use cases (improve, match frontier)</li>
                </ul>
                <div class="choice-cta">Start Experimenting â†’</div>
            </div>
        </div>

        <div class="landing-footer">
            Red Hat AI Innovation Team â€¢ Powered by its_hub
        </div>
    </div>

    <!-- Main Demo Container (initially hidden) -->
    <div id="demoContainer" class="hidden">
        <!-- Back to Home Button -->
        <button class="back-to-home" id="backToHomeBtn" onclick="returnToLanding()">
            <span>â†</span>
            <span>Back to Home</span>
        </button>

        <!-- Theme Toggle (Floating) -->
        <div class="theme-toggle" onclick="toggleTheme()">
            <span class="theme-icon sun-icon">â˜€ï¸</span>
            <span class="theme-icon moon-icon">ðŸŒ™</span>
        </div>

        <!-- Expert Mode Toggle (Floating) - only show in interactive mode -->
        <div class="expert-mode-toggle" id="expertModeToggle" onclick="toggleExpertMode()">
            <span class="expert-mode-icon">ðŸŽ“</span>
            <span class="expert-mode-label">Expert Mode</span>
        </div>

        <div class="container">
        <!-- Header -->
        <header>
            <div class="header-content">
                <div class="header-logo-section">
                    <div class="header-text">
                        <div class="header-title-main">Red Hat AI Innovation Team</div>
                        <h1>Inference-Time Scaling</h1>
                    </div>
                </div>
                <p class="subtitle" id="headerSubtitle">Compare baseline inference with ITS algorithms side by side</p>
            </div>
        </header>

        <!-- Use Case Selection -->
        <div class="section" id="useCaseSection">
            <div class="section-header">
                <h2 class="section-title">Choose Your Use Case</h2>
                <p class="section-description">Select what you want to demonstrate with ITS</p>
            </div>

            <div style="display: grid; gap: 16px; grid-template-columns: 1fr 1fr 1fr;">
                <label class="use-case-card" data-use-case="improve_model">
                    <input type="radio" name="useCase" value="improve_model" checked onchange="onUseCaseChange()">
                    <div class="use-case-content">
                        <div class="use-case-header">
                            <span class="use-case-icon">ðŸ“ˆ</span>
                            <h3 class="use-case-title">Improve Model Performance</h3>
                        </div>
                        <p class="use-case-description">Use ITS to improve any model's performance on the same task</p>
                        <div class="use-case-comparison">
                            <span class="comparison-item">Model (Baseline)</span>
                            <span class="comparison-vs">vs</span>
                            <span class="comparison-item highlight">Model + ITS</span>
                        </div>
                    </div>
                </label>

                <label class="use-case-card" data-use-case="match_frontier">
                    <input type="radio" name="useCase" value="match_frontier" onchange="onUseCaseChange()">
                    <div class="use-case-content">
                        <div class="use-case-header">
                            <span class="use-case-icon">âš–ï¸</span>
                            <h3 class="use-case-title">Match Frontier with Smaller Model</h3>
                        </div>
                        <p class="use-case-description">Compare small model baseline, small model + ITS, and frontier model performance</p>
                        <div class="use-case-comparison">
                            <span class="comparison-item">Small</span>
                            <span class="comparison-vs">â†’</span>
                            <span class="comparison-item highlight">Small + ITS</span>
                            <span class="comparison-vs">â‰ˆ</span>
                            <span class="comparison-item">Frontier</span>
                        </div>
                    </div>
                </label>

                <label class="use-case-card" data-use-case="tool_consensus">
                    <input type="radio" name="useCase" value="tool_consensus" onchange="onUseCaseChange()">
                    <div class="use-case-content">
                        <div class="use-case-header">
                            <span class="use-case-icon">ðŸ¤–</span>
                            <h3 class="use-case-title">Agent Tool Consensus</h3>
                        </div>
                        <p class="use-case-description">Show how ITS creates consensus on tool selection for reliable agents</p>
                        <div class="use-case-comparison">
                            <span class="comparison-item">Single Call</span>
                            <span class="comparison-vs">vs</span>
                            <span class="comparison-item highlight">Tool Voting</span>
                        </div>
                    </div>
                </label>
            </div>
        </div>

        <!-- Guided Demo Badge -->
        <div class="guided-demo-badge" id="guidedDemoBadge" style="display: none;">
            ðŸ“š Guided Demo Mode
        </div>

        <!-- Guided Demo Wizard -->
        <div id="guidedWizard" class="guided-wizard" style="display: none;">
            <!-- Progress Bar -->
            <div class="guided-progress">
                <div class="guided-progress-bar" id="guidedProgressBar" style="width: 0%"></div>
            </div>
            <div class="guided-breadcrumbs" id="guidedBreadcrumbs">
                <span class="g-crumb active" data-step="1">Goal</span>
                <span class="g-crumb-sep">/</span>
                <span class="g-crumb" data-step="2">Method</span>
                <span class="g-crumb-sep">/</span>
                <span class="g-crumb" data-step="3">Scenario</span>
                <span class="g-crumb-sep">/</span>
                <span class="g-crumb" data-step="4">Run</span>
                <span class="g-crumb-sep">/</span>
                <span class="g-crumb" data-step="5">Trace</span>
                <span class="g-crumb-sep">/</span>
                <span class="g-crumb" data-step="6">Performance</span>
            </div>

            <!-- Step 1: Goal Selection -->
            <div id="guidedStep1" class="guided-step">
                <h3 class="guided-step-title">What would you like to explore?</h3>
                <p class="guided-step-subtitle">Select your goal to see how ITS can help</p>
                <div class="guided-cards-grid">
                    <div class="guided-card" data-goal="improve_performance" onclick="guidedSelectGoal('improve_performance')">
                        <div class="guided-card-icon">ðŸ“ˆ</div>
                        <h4>Improve Model Performance</h4>
                        <p>Use ITS to enhance any model's output quality on the same task</p>
                    </div>
                    <div class="guided-card" data-goal="match_frontier" onclick="guidedSelectGoal('match_frontier')">
                        <div class="guided-card-icon">âš–ï¸</div>
                        <h4>Improve Small Model to Match Frontier</h4>
                        <p>Make a smaller, cheaper model perform as well as a large frontier model</p>
                    </div>
                </div>
            </div>

            <!-- Step 2: ITS Method Selection -->
            <div id="guidedStep2" class="guided-step" style="display: none;">
                <button class="guided-back-btn" onclick="guidedGoBack(1)">â† Back</button>
                <h3 class="guided-step-title">Choose an ITS Method</h3>
                <p class="guided-step-subtitle">Each method uses a different strategy to improve results</p>
                <div class="guided-cards-grid">
                    <div class="guided-card" data-method="self_consistency" onclick="guidedSelectMethod('self_consistency')">
                        <div class="guided-card-icon">ðŸ—³ï¸</div>
                        <h4>Self-Consistency</h4>
                        <p>Generate multiple responses and select the most common answer via majority voting</p>
                        <span class="guided-card-tag">Best for: factual questions, math</span>
                    </div>
                    <div class="guided-card" data-method="best_of_n" onclick="guidedSelectMethod('best_of_n')">
                        <div class="guided-card-icon">ðŸ†</div>
                        <h4>Best-of-N</h4>
                        <p>Generate multiple responses and use an LLM judge to select the highest quality answer</p>
                        <span class="guided-card-tag">Best for: open-ended, creative tasks</span>
                    </div>
                </div>
            </div>

            <!-- Step 3: Model Scenario Selection -->
            <div id="guidedStep3" class="guided-step" style="display: none;">
                <button class="guided-back-btn" onclick="guidedGoBack(2)">â† Back</button>
                <h3 class="guided-step-title">Choose a Scenario</h3>
                <p class="guided-step-subtitle" id="guidedStep3Subtitle">Select a model configuration</p>
                <div id="guidedScenarioCards" class="guided-cards-grid">
                    <!-- Populated dynamically by guided-demo.js -->
                </div>
            </div>

            <!-- Step 4: Prompt + Submit -->
            <div id="guidedStep4" class="guided-step" style="display: none;">
                <button class="guided-back-btn" onclick="guidedGoBack(3)">â† Back</button>
                <div class="guided-scenario-summary" id="guidedScenarioSummary"></div>
                <h3 class="guided-step-title">Ready to Run</h3>
                <p class="guided-step-subtitle">Review the question and submit to see ITS in action</p>
                <div class="guided-prompt-area">
                    <div class="guided-prompt-label">Question</div>
                    <div class="guided-prompt-text" id="guidedPromptText"></div>
                </div>
                <div class="guided-submit-area">
                    <button class="btn-primary guided-submit-btn" id="guidedSubmitBtn" onclick="guidedSubmit()">
                        <span>â–¶</span>
                        <span>Submit</span>
                    </button>
                </div>
            </div>

            <!-- Step 5: Responses + Trace -->
            <div id="guidedStep5" class="guided-step" style="display: none;">
                <button class="guided-back-btn" onclick="guidedGoBack(4)">â† Back</button>
                <h3 class="guided-step-title">Results</h3>
                <div class="guided-responses" id="guidedResponses"></div>
                <div class="guided-trace-area" id="guidedTraceArea" style="display: none;">
                    <div class="guided-trace-header">
                        <h4>ITS Trace Visualization</h4>
                        <p>See how the algorithm evaluated multiple candidates to find the best answer</p>
                    </div>
                    <div id="guidedTraceContent"></div>
                </div>
                <div class="guided-next-area" id="guidedNextArea" style="display: none;">
                    <button class="btn-primary" onclick="guidedShowPerformance()">
                        <span>View Performance Details â†’</span>
                    </button>
                </div>
            </div>

            <!-- Step 6: Performance Page -->
            <div id="guidedStep6" class="guided-step" style="display: none;">
                <button class="guided-back-btn" onclick="guidedGoBack(5)">â† Back to Results</button>
                <h3 class="guided-step-title">Performance Analysis</h3>
                <p class="guided-step-subtitle">Cost, quality, latency, and token comparison</p>
                <div class="guided-perf-summary" id="guidedPerfSummary"></div>
                <div class="guided-perf-charts" id="guidedPerfCharts"></div>
            </div>
        </div>

        <!-- Scenario Selector (Guided Mode Only) -->
        <div class="section" id="scenarioSection">
            <div id="scenarioSelectorContainer" class="scenario-selector-container">
                <div class="scenario-selector-header">
                    <span class="scenario-selector-label">Choose a Demo Scenario</span>
                    <div class="scenario-navigation">
                        <button class="scenario-nav-btn" id="prevScenarioBtn" onclick="navigateScenario(-1)">â† Prev</button>
                        <select id="scenarioDropdown" class="scenario-dropdown" onchange="loadScenario(parseInt(this.value))">
                            <!-- Options populated dynamically -->
                        </select>
                        <button class="scenario-nav-btn" id="nextScenarioBtn" onclick="navigateScenario(1)">Next â†’</button>
                    </div>
                </div>
                <div id="scenarioInfo" class="scenario-info">
                    <!-- Scenario metadata populated dynamically -->
                </div>
            </div>
        </div>

        <!-- Configuration Section -->
        <div class="section" id="configSection">
            <div class="section-header">
                <h2 class="section-title">Configuration</h2>
                <p class="section-description" id="configDescription">Choose your model, algorithm, and compute budget</p>
            </div>

            <div class="form-grid" id="modelSelectionGrid">
                <div class="form-group" id="frontierModelGroup" style="display: none;">
                    <label for="frontierModel">Frontier Model</label>
                    <select id="frontierModel">
                        <option value="">Loading models...</option>
                    </select>
                </div>

                <div class="form-group" id="modelGroup">
                    <label for="model" id="modelLabel">Model</label>
                    <select id="model">
                        <option value="">Loading models...</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="algorithm">
                        ITS Algorithm
                    </label>
                    <select id="algorithm" onchange="onAlgorithmChange()">
                        <optgroup label="Production">
                            <option value="best_of_n">Best-of-N</option>
                            <option value="self_consistency">Self-Consistency</option>
                        </optgroup>
                        <optgroup label="Research (requires PRM)">
                            <option value="beam_search">Beam Search</option>
                            <option value="particle_filtering">Particle Filtering</option>
                            <option value="entropic_particle_filtering">Entropic Particle Filtering</option>
                            <option value="particle_gibbs">Particle Gibbs</option>
                        </optgroup>
                    </select>
                </div>
            </div>

            <!-- Algorithm Info (Dynamic) -->
            <div id="algorithmInfo"></div>

            <div class="form-group" style="margin-top: 20px;">
                <label for="budget">
                    Budget
                    <span class="label-helper">â€“ Computational resources allocated</span>
                </label>
                <div class="slider-container">
                    <div class="slider-header">
                        <span style="font-size: 13px; color: var(--text-secondary);">Lower</span>
                        <span class="budget-value" id="budgetValue">4</span>
                        <span style="font-size: 13px; color: var(--text-secondary);">Higher</span>
                    </div>
                    <input type="range" id="budget" min="1" max="32" value="4" step="1">
                </div>
            </div>
        </div>

        <!-- Question Section -->
        <div class="section" id="questionSection">
            <div class="section-header">
                <h2 class="section-title">Your Question</h2>
                <p class="section-description">Ask anything or try an example</p>
            </div>

            <div class="form-group">
                <!-- Guided Mode Question Selector -->
                <div id="guidedQuestions" class="guided-questions">
                    <label class="guided-questions-label">Choose a question that demonstrates this algorithm:</label>
                    <div id="guidedQuestionsGrid" class="guided-questions-grid">
                        <!-- Questions will be populated dynamically -->
                    </div>
                </div>

                <label for="question">Question</label>
                <textarea id="question" placeholder="Enter your question here...">Explain quantum entanglement in simple terms.</textarea>

                <div class="example-questions-container">
                    <label for="exampleQuestions" class="example-label">
                        <span>ðŸ’¡</span>
                        <span>Try an example question</span>
                    </label>
                    <select id="exampleQuestions" class="example-select">
                        <option value="">Select an example...</option>
                    </select>
                </div>
            </div>

            <div class="action-buttons">
                <button class="btn-primary" id="runButton" onclick="runComparison()">
                    <span>â–¶</span>
                    <span>Run Comparison</span>
                </button>
                <button class="btn-secondary" onclick="clearResults()">Clear</button>
            </div>
        </div>

        <div id="errorContainer"></div>

        <!-- Expected Answer -->
        <div id="expectedAnswerContainer" class="expected-answer-container">
            <div class="expected-answer-header">
                <span class="check-icon">âœ“</span>
                <strong>Expected Answer</strong>
            </div>
            <div id="expectedAnswerContent" class="expected-answer-content"></div>
        </div>

        <!-- Results -->
        <div class="results" id="resultsContainer">
            <!-- Small Model Baseline (only shown in match_frontier mode) -->
            <div class="result-pane" id="smallBaselinePane" style="display: none;">
                <div class="pane-header">
                    <div class="pane-title">
                        <span class="pane-indicator baseline"></span>
                        <span id="smallBaselineTitle">Small Model</span>
                        <span class="size-badge small" id="smallBaselineSize" style="display: none;">Small</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <div class="cost-badge" id="smallBaselineCost" style="display: none;">-</div>
                        <div class="latency-badge" id="smallBaselineLatency" style="display: none;">-</div>
                        <div class="result-actions" style="display: none;" id="smallBaselineActions">
                            <button class="action-btn" onclick="copyToClipboard('smallBaseline')" title="Copy answer">ðŸ“‹</button>
                        </div>
                    </div>
                </div>
                <div id="smallBaselineContent" class="answer-content">
                    <div class="empty-state">
                        <div class="empty-state-icon">ðŸ’­</div>
                        <div>Run a comparison to see results</div>
                    </div>
                </div>
            </div>

            <!-- ITS Result (or Baseline for improve_model mode) -->
            <div class="result-pane">
                <div class="pane-header">
                    <div class="pane-title">
                        <span class="pane-indicator baseline" id="middlePaneIndicator"></span>
                        <span id="middlePaneTitle">Baseline</span>
                        <span class="size-badge" id="middlePaneSize" style="display: none;">-</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <div class="cost-badge" id="middlePaneCost" style="display: none;">-</div>
                        <div class="latency-badge" id="middlePaneLatency" style="display: none;">-</div>
                        <div class="result-actions" style="display: none;" id="middlePaneActions">
                            <button class="action-btn" onclick="copyToClipboard('middlePane')" title="Copy answer">ðŸ“‹</button>
                        </div>
                    </div>
                </div>
                <div id="middlePaneContent" class="answer-content">
                    <div class="empty-state">
                        <div class="empty-state-icon">ðŸ’­</div>
                        <div>Run a comparison to see results</div>
                    </div>
                </div>
            </div>

            <!-- Frontier Model or ITS Result -->
            <div class="result-pane">
                <div class="pane-header">
                    <div class="pane-title">
                        <span class="pane-indicator its" id="rightPaneIndicator"></span>
                        <span id="rightPaneTitle">ITS Result</span>
                        <span class="size-badge" id="rightPaneSize" style="display: none;">-</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <div class="cost-badge" id="rightPaneCost" style="display: none;">-</div>
                        <div class="latency-badge" id="rightPaneLatency" style="display: none;">-</div>
                        <div class="result-actions" style="display: none;" id="rightPaneActions">
                            <button class="action-btn" onclick="copyToClipboard('rightPane')" title="Copy answer">ðŸ“‹</button>
                        </div>
                    </div>
                </div>
                <div id="rightPaneContent" class="answer-content">
                    <div class="empty-state">
                        <div class="empty-state-icon">ðŸš€</div>
                        <div>Run a comparison to see results</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Enhanced Performance Visualization -->
        <div id="performance-visualization-container" style="display: none; margin-top: 48px;">
            <div id="performance-visualization"></div>
        </div>
    </div>
    </div><!-- End demoContainer -->

    <script>
        const API_BASE_URL = 'http://localhost:8000';
        let currentExpectedAnswer = null;
        let selectedAlgorithm = 'best_of_n';
        let lastResults = null;
        let currentUseCase = 'improve_model';
        let isExpertMode = false;
        let isRunning = false; // Track if a comparison is currently running
        let selectedExperience = null; // 'guided' or 'interactive'

        // OFFLINE DEMO SCENARIOS FOR GUIDED MODE
        // Schema for each scenario:
        // - id: unique identifier
        // - title: short descriptive title
        // - algorithm: which ITS algorithm was used
        // - model: model name/id
        // - budget: compute budget used
        // - prompt: the user question/prompt
        // - baseline: { response, latency_ms, input_tokens, output_tokens, cost_usd, model_size }
        // - its: { response, latency_ms, input_tokens, output_tokens, cost_usd, trace, model_size }
        // - whyItsHelped: plain English explanation of ITS value
        // - tags: array of tags for filtering/categorization
        const OFFLINE_SCENARIOS = [
            {
                id: 'sc-improve-arithmetic-1',
                title: `Self Consistency - Arithmetic (Improve)`,
                algorithm: 'self_consistency',
                model: 'GPT-3.5 Turbo',
                provider: 'OpenAI',
                budget: 8,
                useCase: 'improve_model',
                prompt: `What is 144 / 12 + 7 * 3 - 5?`,
                baseline: {
                    response: `The answer is 37.`,
                    latency_ms: 523,
                    input_tokens: 24,
                    output_tokens: 6,
                    cost_usd: 2.1e-05,
                    model_size: 'Small'
                },
                its: {
                    response: `144 / 12 + 7 * 3 - 5\n\n= 12 + 21 - 5\n\n= 33 - 5\n\n= 28\n\nTherefore, 144 / 12 + 7 * 3 - 5 = 28.`,
                    latency_ms: 1022,
                    input_tokens: 192,
                    output_tokens: 48,
                    cost_usd: 0.000168,
                    trace: `{\n  "algorithm": "self_consistency",\n  "candidates": [\n    {\n      "index": 0,\n      "content": "The answer is 30. \\n\\n144 / 12 = 12\\n7 * 3 = 21\\n12 + 21 = 33\\n33 - 5 = 30",\n      "is_selected": false,\n      "tool_calls": null\n    },\n    {\n      "index": 1,\n      "content": "The result of the expression 144 / 12 + 7 * 3 - 5 is 12 + 21 - 5, which equals 28.",\n      "is_selected": false,\n      "tool_calls": null\n    },\n    {\n      "index": 2,\n      "content": "144 / 12 + 7 * 3 - 5 = 12 + 21 - 5 = 33 - 5 = 28. \\n\\nTherefore, 144 / 12 + 7 * 3 - 5 is equal to 28.",\n      "is_selected": false,\n      "tool_calls": null\n    },\n    {\n      "index": 3,\n      "content": "144 / 12 + 7 * 3 - 5\\n\\n= 12 + 21 - 5\\n\\n= 33 - 5\\n\\n= 28\\n\\nTherefore, 144 / 12 + 7 * 3 - 5 = 28.",\n      "is_selected": true,\n      "tool_calls": null\n    },\n    {\n      "index": 4,\n      "content": "144 / 12 = 12\\n7 * 3 = 21\\n\\nSo, the expression becomes:\\n12 + 21 - 5\\n= 33 - 5\\n= 28\\n\\nTherefore, 144 / 12 + 7 * 3 - 5 = 28.",\n      "is_selected": false,\n      "tool_calls": null\n    },\n    {\n      "index": 5,\n      "content": "The answer is 32.",\n      "is_selected": false,\n      "tool_calls": null\n    },\n    {\n      "index": 6,\n      "content": "The answer is 24. \\n\\n144 / 12 = 12\\n12 + 7 * 3 = 12 + 21 = 33\\n33 - 5 = 28.",\n      "is_selected": false,\n      "tool_calls": null\n    },\n    {\n      "index": 7,\n      "content": "The answer is 23.",\n      "is_selected": false,\n      "tool_calls": null\n    }\n  ],\n  "vote_counts": {\n    "The answer is 30. \\n\\n144 / 12 = 12\\n7 * 3 = 21\\n12 + 21 = 33\\n33 - 5 = 30": 1,\n    "The result of the expression 144 / 12 + 7 * 3 - 5 is 12 + 21 - 5, which equals 28.": 1,\n    "144 / 12 + 7 * 3 - 5 = 12 + 21 - 5 = 33 - 5 = 28. \\n\\nTherefore, 144 / 12 + 7 * 3 - 5 is equal to 28.": 1,\n    "144 / 12 + 7 * 3 - 5\\n\\n= 12 + 21 - 5\\n\\n= 33 - 5\\n\\n= 28\\n\\nTherefore, 144 / 12 + 7 * 3 - 5 = 28.": 1,\n    "144 / 12 = 12\\n7 * 3 = 21\\n\\nSo, the expression becomes:\\n12 + 21 - 5\\n= 33 - 5\\n= 28\\n\\nTherefore, 144 / 12 + 7 * 3 - 5 = 28.": 1,\n    "The answer is 32.": 1,\n    "The answer is 24. \\n\\n144 / 12 = 12\\n12 + 7 * 3 = 12 + 21 = 33\\n33 - 5 = 28.": 1,\n    "The answer is 23.": 1\n  },\n  "total_votes": 8,\n  "tool_voting": null\n}`,
                    model_size: 'Small'
                },
                whyItsHelped: `Self-consistency generated multiple reasoning paths and selected the most common answer through majority voting, avoiding occasional errors.`,
                tags: ["self_consistency", "openai", "improve"]
            },
            {
                id: 'sc-improve-arithmetic-2',
                title: `Self Consistency - Multi-step Math (Improve)`,
                algorithm: 'self_consistency',
                model: 'GPT-3.5 Turbo',
                provider: 'OpenAI',
                budget: 8,
                useCase: 'improve_model',
                prompt: `What is 7 * 8 + 3 * 4 - 2 * 9?`,
                baseline: {
                    response: `The answer is 74. \n\n7*8 = 56\n3*4 = 12\n2*9 = 18\n\n56 + 12 - 18 = 74`,
                    latency_ms: 819,
                    input_tokens: 27,
                    output_tokens: 38,
                    cost_usd: 7.1e-05,
                    model_size: 'Small'
                },
                its: {
                    response: `56 + 12 - 18 = 50`,
                    latency_ms: 1715,
                    input_tokens: 216,
                    output_tokens: 304,
                    cost_usd: 0.000564,
                    trace: `{\n  "algorithm": "self_consistency",\n  "candidates": [\n    {\n      "index": 0,\n      "content": "The calculation is as follows: \\n\\n7 * 8 + 3 * 4 - 2 * 9\\n= 56 + 12 - 18\\n= 68 - 18\\n= 50\\n\\nTherefore, the answer is 50.",\n      "is_selected": false,\n      "tool_calls": null\n    },\n    {\n      "index": 1,\n      "content": "The solution to the expression 7 * 8 + 3 * 4 - 2 * 9 is:\\n\\n7 * 8 = 56\\n3 * 4 = 12\\n2 * 9 = 18\\n\\nNow, substitute the values back into the expression:\\n\\n56 + 12 - 18 =\\n68 - 18 =\\n50\\n\\nTherefore, 7 * 8 + 3 * 4 - 2 * 9 equals 50.",\n      "is_selected": false,\n      "tool_calls": null\n    },\n    {\n      "index": 2,\n      "content": "The result of the expression 7 * 8 + 3 * 4 - 2 * 9 is 56 + 12 - 18, which equals 50.",\n      "is_selected": false,\n      "tool_calls": null\n    },\n    {\n      "index": 3,\n      "content": "56 + 12 - 18 = 50.",\n      "is_selected": false,\n      "tool_calls": null\n    },\n    {\n      "index": 4,\n      "content": "56 + 12 - 18 = 50",\n      "is_selected": false,\n      "tool_calls": null\n    },\n    {\n      "index": 5,\n      "content": "This equation is solved using the order of operations which is Parentheses, Exponents, Multiplication and Division (from left to right), Addition and Subtraction (from left to right).\\n\\n7 * 8 = 56\\n3 * 4 = 12\\n2 * 9 = 18\\n\\nNow, substitute these values back into the equation:\\n\\n56 + 12 - 18\\n\\nNow, solve the addition and subtraction:\\n\\n56 + 12 = 68\\n68 - 18 = 50\\n\\nTherefore, 7 * 8 + 3 * 4 - 2 * 9 = 50.",\n      "is_selected": false,\n      "tool_calls": null\n    },\n    {\n      "index": 6,\n      "content": "56 + 12 - 18 = 50",\n      "is_selected": true,\n      "tool_calls": null\n    },\n    {\n      "index": 7,\n      "content": "56 + 12 - 18 = 50",\n      "is_selected": false,\n      "tool_calls": null\n    }\n  ],\n  "vote_counts": {\n    "The calculation is as follows: \\n\\n7 * 8 + 3 * 4 - 2 * 9\\n= 56 + 12 - 18\\n= 68 - 18\\n= 50\\n\\nTherefore, the answer is 50.": 1,\n    "The solution to the expression 7 * 8 + 3 * 4 - 2 * 9 is:\\n\\n7 * 8 = 56\\n3 * 4 = 12\\n2 * 9 = 18\\n\\nNow, substitute the values back into the expression:\\n\\n56 + 12 - 18 =\\n68 - 18 =\\n50\\n\\nTherefore, 7 * 8 + 3 * 4 - 2 * 9 equals 50.": 1,\n    "The result of the expression 7 * 8 + 3 * 4 - 2 * 9 is 56 + 12 - 18, which equals 50.": 1,\n    "56 + 12 - 18 = 50.": 1,\n    "56 + 12 - 18 = 50": 3,\n    "This equation is solved using the order of operations which is Parentheses, Exponents, Multiplication and Division (from left to right), Addition and Subtraction (from left to right).\\n\\n7 * 8 = 56\\n3 * 4 = 12\\n2 * 9 = 18\\n\\nNow, substitute these values back into the equation:\\n\\n56 + 12 - 18\\n\\nNow, solve the addition and subtraction:\\n\\n56 + 12 = 68\\n68 - 18 = 50\\n\\nTherefore, 7 * 8 + 3 * 4 - 2 * 9 = 50.": 1\n  },\n  "total_votes": 8,\n  "tool_voting": null\n}`,
                    model_size: 'Small'
                },
                whyItsHelped: `Self-consistency generated multiple reasoning paths and selected the most common answer through majority voting, avoiding occasional errors.`,
                tags: ["self_consistency", "openai", "improve"]
            },
            {
                id: 'sc-match-arithmetic-1',
                title: `Self Consistency - Arithmetic (Match Frontier)`,
                algorithm: 'self_consistency',
                model: 'GPT-3.5 Turbo',
                provider: 'OpenAI',
                budget: 8,
                useCase: 'match_frontier',
                prompt: `What is 144 / 12 + 7 * 3 - 5?`,
                frontierModel: 'GPT-4o',
                baseline: {
                    response: `To solve the expression \\(144 / 12 + 7 \\times 3 - 5\\), we follow the order of operations: parentheses, exponents, multiplication and division (from left to right), and addition and subtraction (from left to right). \n\n1. Start with the division:  \n   \\(144 / 12 = 12\\).\n\n2. Next, perform the multiplication:  \n   \\(7 \\times 3 = 21\\).\n\n3. Now, substitute these results back into the expression:  \n   \\(12 + 21 - 5\\).\n\n4. Perform the addition:  \n   \\(12 + 21 = 33\\).\n\n5. Finally, perform the subtraction:  \n   \\(33 - 5 = 28\\).\n\nThus, the result of the expression is \\(28\\).`,
                    latency_ms: 1755,
                    input_tokens: 24,
                    output_tokens: 167,
                    cost_usd: 0.00173,
                    model_size: 'Large'
                },
                its: {
                    response: `144 / 12 + 7 * 3 - 5 = 12 + 21 - 5 = 28`,
                    latency_ms: 1476,
                    input_tokens: 192,
                    output_tokens: 48,
                    cost_usd: 0.000168,
                    trace: `{\n  "algorithm": "self_consistency",\n  "candidates": [\n    {\n      "index": 0,\n      "content": "144 / 12 + 7 * 3 - 5 = 12 + 21 - 5 = 28",\n      "is_selected": true,\n      "tool_calls": null\n    },\n    {\n      "index": 1,\n      "content": "144 divided by 12 is 12\\n12 plus 21 is 33\\n33 minus 5 is 28\\n\\nTherefore, the answer is 28.",\n      "is_selected": false,\n      "tool_calls": null\n    },\n    {\n      "index": 2,\n      "content": "144 / 12 = 12\\n7 * 3 = 21\\n\\n12 + 21 - 5 = 28\\n\\nSo, 144 / 12 + 7 * 3 - 5 equals 28.",\n      "is_selected": false,\n      "tool_calls": null\n    },\n    {\n      "index": 3,\n      "content": "The answer is 30. \\n\\nTo solve the expression: 144 / 12 + 7 * 3 - 5, follow the order of operations (PEMDAS):\\n\\n1. Perform division: 144 / 12 = 12\\n2. Perform multiplication: 7 * 3 = 21\\n3. Perform addition and subtraction in order from left to right: 12 + 21 - 5 = 28 - 5 = 23\\n\\nTherefore, 144 / 12 + 7 * 3 - 5 is equal to 23.",\n      "is_selected": false,\n      "tool_calls": null\n    },\n    {\n      "index": 4,\n      "content": "144 / 12 = 12\\n7 * 3 = 21\\n\\n12 + 21 - 5 = 28",\n      "is_selected": false,\n      "tool_calls": null\n    },\n    {\n      "index": 5,\n      "content": "144 / 12 + 7 * 3 - 5\\n= 12 + 21 - 5\\n= 33 - 5\\n= 28\\n\\nTherefore, 144 / 12 + 7 * 3 - 5 equals 28.",\n      "is_selected": false,\n      "tool_calls": null\n    },\n    {\n      "index": 6,\n      "content": "The answer is 38.\\n\\nFirst step: 144 / 12 = 12\\nSecond step: 7 * 3 = 21\\nThird step: 12 + 21 = 33\\nFinal step: 33 - 5 = 38\\n\\nTherefore, 144 / 12 + 7 * 3 - 5 equals 38.",\n      "is_selected": false,\n      "tool_calls": null\n    },\n    {\n      "index": 7,\n      "content": "144 / 12 + 7 * 3 - 5\\n= 12 + 21 - 5\\n= 33 - 5\\n= 28\\n\\nSo, 144 / 12 + 7 * 3 - 5 = 28.",\n      "is_selected": false,\n      "tool_calls": null\n    }\n  ],\n  "vote_counts": {\n    "144 / 12 + 7 * 3 - 5 = 12 + 21 - 5 = 28": 1,\n    "144 divided by 12 is 12\\n12 plus 21 is 33\\n33 minus 5 is 28\\n\\nTherefore, the answer is 28.": 1,\n    "144 / 12 = 12\\n7 * 3 = 21\\n\\n12 + 21 - 5 = 28\\n\\nSo, 144 / 12 + 7 * 3 - 5 equals 28.": 1,\n    "The answer is 30. \\n\\nTo solve the expression: 144 / 12 + 7 * 3 - 5, follow the order of operations (PEMDAS):\\n\\n1. Perform division: 144 / 12 = 12\\n2. Perform multiplication: 7 * 3 = 21\\n3. Perform addition and subtraction in order from left to right: 12 + 21 - 5 = 28 - 5 = 23\\n\\nTherefore, 144 / 12 + 7 * 3 - 5 is equal to 23.": 1,\n    "144 / 12 = 12\\n7 * 3 = 21\\n\\n12 + 21 - 5 = 28": 1,\n    "144 / 12 + 7 * 3 - 5\\n= 12 + 21 - 5\\n= 33 - 5\\n= 28\\n\\nTherefore, 144 / 12 + 7 * 3 - 5 equals 28.": 1,\n    "The answer is 38.\\n\\nFirst step: 144 / 12 = 12\\nSecond step: 7 * 3 = 21\\nThird step: 12 + 21 = 33\\nFinal step: 33 - 5 = 38\\n\\nTherefore, 144 / 12 + 7 * 3 - 5 equals 38.": 1,\n    "144 / 12 + 7 * 3 - 5\\n= 12 + 21 - 5\\n= 33 - 5\\n= 28\\n\\nSo, 144 / 12 + 7 * 3 - 5 = 28.": 1\n  },\n  "total_votes": 8,\n  "tool_voting": null\n}`,
                    model_size: 'Small'
                },
                smallBaseline: {
                    response: `The answer is 32.`,
                    latency_ms: 1034,
                    input_tokens: 24,
                    output_tokens: 6,
                    cost_usd: 2.1e-05,
                    model_size: 'Small'
                },
                whyItsHelped: `Self-consistency allowed the small model to generate diverse solution paths and vote on the most reliable answer, achieving frontier-level accuracy through consensus.`,
                tags: ["self_consistency", "openai", "frontier"]
            },
            {
                id: 'bon-match-science-1',
                title: `Best Of N - GPT-4o Mini (Match Frontier)`,
                algorithm: 'best_of_n',
                model: 'GPT-4o Mini',
                provider: 'OpenAI',
                budget: 16,
                useCase: 'match_frontier',
                prompt: `Explain the difference between a virus and a bacterium to someone with no science background. Use analogies.`,
                frontierModel: 'GPT-4o',
                baseline: {
                    response: `Sure, let's imagine your body is like a big city, and both viruses and bacteria are like different types of troublemakers trying to cause problems in that city.\n\n**Bacteria: The Trouble-making Neighbors**\n\nImagine bacteria as mischievous neighbors who live in their own little houses around the city (your body). These neighbors are living organisms, just like you. They eat, grow, and reproduce on their own. Some bacteria are actually friendly and help your city run smoothly, like neighbors who help with community gardens or watch your house while you're away. Other bacteria can be troublemakers. When they decide to cause problems, it might feel like they're throwing loud parties or causing disturbances, which can lead to issues like infections.\n\nTo solve these problems, you might need to call in special city services, like the police, represented by antibiotics. These antibiotics can help calm down or remove the troublemaking bacteria, restoring peace to the neighborhood.\n\n**Viruses: The Sneaky Invaders**\n\nNow, think of viruses as sneaky vandals or hackers from another city who cannot live on their own in your city. They don't have their own houses (cells), so they can't eat or reproduce by themselves. Instead, they break into homes (your body's cells) and hijack them, using your resources to create more of their kind, like vandals taking over a factory and using its tools to make more vandals.\n\nBecause viruses hide inside your city's homes and use your resources, the city services (like antibiotics) that remove bacteria don't work against them. Instead, the city's security system (your immune system) has to recognize and target these intruders specifically to stop them. Sometimes, vaccines act like a security alarm system, teaching your city's security to recognize these vandals before they cause too much trouble.\n\nSo, in summary: bacteria are like trouble-making neighbors who cause disturbances but can often be dealt with using antibiotics, while viruses are sneaky invaders that require your immune system to fight them off or vaccines to prevent them from taking hold in the first place.`,
                    latency_ms: 9879,
                    input_tokens: 28,
                    output_tokens: 412,
                    cost_usd: 0.00419,
                    model_size: 'Large'
                },
                its: {
                    response: `Sure! Letâ€™s use a couple of analogies to explain the differences between a virus and a bacterium.\n\n**The Building Analogy:**\nThink of a bacterium as a full building, like a small house. This house is complete with everything it needs to live and function on its own. It has its own kitchen (to process energy), bathrooms (for waste), windows (for interaction with the outside environment), and can even make its own decisions, like how to find food or escape danger. Bacteria can grow, reproduce, and live independently.\n\nNow, think of a virus as a tiny, uninhabitable plot of land. By itself, it canâ€™t do anything. It doesn't have the structure or resources to survive on its own. It needs to rely on a nearby house (which represents a living cell) to do all the work for it. When a virus finds a house, it sneaks in and takes over the resources to create copies of itself. In this case, the virus is very dependent on the house to exist and thrive.\n\n**The Recipe Analogy:**\nAnother way to think about it is using cooking. A bacterium is like a cook who has a complete kitchen with all the ingredients and tools needed to make a meal. This cook can prepare and serve food without any help. They can create different recipes and innovate as they go.\n\nOn the other hand, a virus is like a recipe card that contains just a list of ingredients and instructions but doesnâ€™t have any of the tools or food itself. The recipe card canâ€™t make a meal on its own. It relies on a cook (the living cell) to gather the ingredients and follow the instructions to create the dish (make copies of the virus).\n\n**In Summary:**\nBacteria are like self-sufficient little buildings or cooks, while viruses are more like tiny plots of land or recipe cards that need to rely on others to bring them to life. This fundamental need for a host is what sets viruses apart from bacteria!`,
                    latency_ms: 16443,
                    input_tokens: 448,
                    output_tokens: 5056,
                    cost_usd: 0.003101,
                    trace: `{\n  "algorithm": "best_of_n",\n  "candidates": [\n    {\n      "index": 0,\n      "content": "Sure! Let's imagine that the world of germs is like a small town with two kinds of \\"people\\": bacteria and viruses.\\n\\n### Bacteria:\\nThink of bacteria as independent small shops in this town. Each shop can operate on its own, selling its own products and serving its own customers. Bacteria are living organisms that can grow, reproduce, and even adapt to their environment. They can live in various places, including soil, water, and even inside our bodies, where some are actually helpful, like those that aid in digestion. Just like a shop owner, bacteria have everything they need to survive and thrive without needing help from others.\\n\\n### Viruses:\\nNow, let's think of viruses as uninvited guests who can\\u2019t set up their own shops. They don\\u2019t have the tools to survive on their own. Instead, they need to invade a shop (or a living cell) to borrow its resources to make copies of themselves. When a virus enters a cell, it\\u2019s like a guest taking over the shop, forcing the shop owner to produce a lot of things for them, often harming the shop in the process. In this way, viruses can make you feel sick because they hijack the body's cells to replicate.\\n\\n### Summary:\\nSo, to sum it up:\\n- **Bacteria** are like independent shop owners who can run their own business (and some can even be helpful to us).\\n- **Viruses** are like uninvited guests that need to crash someone else's shop to survive, which can lead to trouble for that shop.\\n\\nIn short, bacteria can live on their own, while viruses always need a host to help them because they can\\u2019t do anything by themselves.",\n      "is_selected": false,\n      "tool_calls": null\n    },\n    {\n      "index": 1,\n      "content": "Sure! Imagine you have two types of tiny invaders trying to get into your house. \\n\\n1. **Bacteria** are like small, independent contractors. They can live on their own and can even help you with some jobs around the house, like breaking down food in your kitchen. Some bacteria are good and useful, while others can be a bit troublemaking and cause sickness. They have their own tools (like all the machinery they need to eat and reproduce) and can multiply on their own.\\n\\n2. **Viruses**, on the other hand, are like sneaky, uninvited guests who can't do anything without your help. They show up at your door and can't enter your house unless they trick you into letting them in. Once they are inside, they take over your home's systems (like using your refrigerator or lights) to make more copies of themselves. They can't eat or grow on their own \\u2014 they need to hijack your resources to survive.\\n\\nSo, to sum it up: Bacteria can live and work independently, while viruses are dependent on invading a host to survive and replicate.",\n      "is_selected": false,\n      "tool_calls": null\n    },\n    {\n      "index": 2,\n      "content": "Imagine a virus and a bacterium as two different types of tiny invaders trying to take over a city, which represents your body.\\n\\n**Bacterium**: Think of a bacterium as a small, independent person living in the city. They have their own little house (cell), they're self-sufficient, and they can do their own thing - like eating food, growing, and making more copies of themselves. Some people (bacteria) are good citizens; they help you digest food or protect your city from invaders. But some can cause trouble, like stealing or damaging property, leading to infections.\\n\\n**Virus**: Now, picture a virus as a sneaky burglar who can't live on their own and needs to break into a house to survive. This burglar doesn't have their own home or food; instead, they sneak into a person\\u2019s house (a healthy cell) and take it over. Once inside, the burglar uses the home\\u2019s resources to create many more burglars (copies of the virus) until the house is filled with them, and eventually, the house might get damaged or shut down. \\n\\nIn summary, bacteria can live and grow independently and can be either helpful or harmful, while viruses are like thieves that need a host (like a cell) to multiply and can't survive on their own.",\n      "is_selected": false,\n      "tool_calls": null\n    },\n    {\n      "index": 3,\n      "content": "Sure! Think of living things like tiny buildings that can be either very simple or more complex. \\n\\n**Bacteria** are like small, robust buildings. They have walls, a foundation, and can stand alone. They are like little factories that can carry out all the processes needed to live, reproduce, and even help us out; for instance, some bacteria in our gut help us digest food. Bacteria can live in lots of different places, and they can grow and multiply on their own, just like a factory that produces a lot of goods all by itself.\\n\\n**Viruses**, on the other hand, are like a tiny, uninvited guest. Imagine a virus as a package that shows up at the door of your factory. This package doesn\\u2019t have its own factory (or machinery) to make anything. Instead, it needs to get inside the factory, take over some of the equipment, and force the factory to do its work for it. In this way, a virus hijacks a living cell, using that cell's resources to make more copies of itself. It can\\u2019t grow or reproduce on its own\\u2014only with the help of a host.\\n\\nIn summary, bacteria are like self-sufficient little factories that can operate on their own, while viruses are more like parasites that need to invade a healthy factory to survive and spread.",\n      "is_selected": false,\n      "tool_calls": null\n    },\n    {\n      "index": 4,\n      "content": "Imagine your body is a house. Now, think of a bacterium as a tiny handyman who can live and work inside your house. This handyman can help with some tasks, like cleaning up messes\\u2014it can even do some good things, like helping you digest food. Bacteria can multiply and live on their own, just like a handyman who can work independently to fix various things around the house.\\n\\nNow, let\\u2019s picture a virus as a tiny thief. This thief cannot survive on its own and needs to invade your house (your cells) to take over. Instead of fixing things, the virus takes control of your house and forces your own resources to help it make more thieves. It can cause trouble and damage while doing this. \\n\\nIn summary, bacteria can sometimes be helpful and can live happily on their own, while viruses are more like invaders that need to hijack your body's cells to live and cause illness.",\n      "is_selected": false,\n      "tool_calls": null\n    },\n    {\n      "index": 5,\n      "content": "Sure! Let\\u2019s use a couple of analogies to explain the differences between a virus and a bacterium.\\n\\n**The Building Analogy:**\\nThink of a bacterium as a full building, like a small house. This house is complete with everything it needs to live and function on its own. It has its own kitchen (to process energy), bathrooms (for waste), windows (for interaction with the outside environment), and can even make its own decisions, like how to find food or escape danger. Bacteria can grow, reproduce, and live independently.\\n\\nNow, think of a virus as a tiny, uninhabitable plot of land. By itself, it can\\u2019t do anything. It doesn't have the structure or resources to survive on its own. It needs to rely on a nearby house (which represents a living cell) to do all the work for it. When a virus finds a house, it sneaks in and takes over the resources to create copies of itself. In this case, the virus is very dependent on the house to exist and thrive.\\n\\n**The Recipe Analogy:**\\nAnother way to think about it is using cooking. A bacterium is like a cook who has a complete kitchen with all the ingredients and tools needed to make a meal. This cook can prepare and serve food without any help. They can create different recipes and innovate as they go.\\n\\nOn the other hand, a virus is like a recipe card that contains just a list of ingredients and instructions but doesn\\u2019t have any of the tools or food itself. The recipe card can\\u2019t make a meal on its own. It relies on a cook (the living cell) to gather the ingredients and follow the instructions to create the dish (make copies of the virus).\\n\\n**In Summary:**\\nBacteria are like self-sufficient little buildings or cooks, while viruses are more like tiny plots of land or recipe cards that need to rely on others to bring them to life. This fundamental need for a host is what sets viruses apart from bacteria!",\n      "is_selected": true,\n      "tool_calls": null\n    },\n    {\n      "index": 6,\n      "content": "Sure! Let's think of cells, which are the basic building blocks of life, as little factories.\\n\\n**Bacteria** are like small, self-sufficient factories. They can produce everything they need to run their operations on their own. They have their own tools (like machinery) to make energy and replicate themselves. They can live in various environments and can even be helpful, like bacteria in our bodies that help with digestion.\\n\\n**Viruses**, on the other hand, are like sneaky burglars. They don\\u2019t have their own factory or tools. Instead, they need to invade another factory (that is, a living cell) to make copies of themselves. Think of a virus as a tiny piece of code that breaks into a factory, takes over the machinery, and then forces the factory to make more of that code instead of producing what it usually does. Once the virus has taken over, it can spread to other factories and repeat the process.\\n\\nSo, in summary:\\n- **Bacteria** are independent factories that can operate and reproduce on their own.\\n- **Viruses** are like little invaders that need to take over a factory to survive and make copies of themselves.",\n      "is_selected": false,\n      "tool_calls": null\n    },\n    {\n      "index": 7,\n      "content": "Sure! Let\\u2019s think of a virus and a bacterium as two very different kinds of tiny invaders that can make things inside our bodies behave differently.\\n\\nImagine a **bacterium** as a small, independent restaurant. It has all the equipment it needs to cook and serve its own meals. It can take in food (nutrients), grow, and even reproduce by splitting into two new restaurants. Bacteria can live on their own, and some can be helpful, like those in our guts that help us digest food. But, just like an unhealthy restaurant can cause food poisoning, some bacteria can make us sick.\\n\\nNow, let\\u2019s picture a **virus** as a sneaky, tiny thief that doesn\\u2019t have its own restaurant. Instead, it knocks on the door of a restaurant (a cell in our body) and tricks the staff into letting it in. Once inside, the virus takes over the kitchen and uses the restaurant\\u2019s resources to create copies of itself. After the virus has made many new thieves, it often causes the restaurant to shut down (which means making us feel sick). Viruses can\\u2019t survive or reproduce on their own; they need to hijack a living cell.\\n\\nSo, in summary:\\n- **Bacterium**: A self-sufficient little restaurant that can serve food (grow and reproduce) on its own, some of which can be friendly.\\n- **Virus**: A sneaky thief that needs to break into a restaurant (cell) to take over and make more thieves, which can cause trouble.\\n\\nI hope that helps clarify the difference!",\n      "is_selected": false,\n      "tool_calls": null\n    },\n    {\n      "index": 8,\n      "content": "Sure! Think of viruses and bacteria as two different types of tiny invaders that can make us sick, but they are quite different from each other, just like an old-fashioned bicycle and a smartphone.\\n\\n**Bacteria** are like bicycles. They are living things, made up of one single cell, and they can do things on their own. Just like a bike can take you places when you pedal it, bacteria can grow, reproduce, and thrive in many environments, such as our bodies. Most bacteria are harmless or even helpful (like those that help us digest food), but some can cause infections. When bacteria get into our bodies, they multiply and can make us sick, just like pedaling a bike too much can wear it out.\\n\\n**Viruses**, on the other hand, are like smartphones. They aren\\u2019t living things on their own \\u2013 they need a host (like a person or an animal) to function and multiply, just like a smartphone needs a person to use it. If a virus were to be compared to a smartphone, it would be like a virus trying to \\"hijack\\" the phone's power. It gets inside a living cell (like inserting a software program) and then takes over, using the cell's machinery to make copies of itself. Viruses can\\u2019t survive without a host; they are like a smartphone without a user\\u2014it just sits there and does nothing.\\n\\nTo sum it up:\\n- **Bacteria = bicycles**: Living, can operate independently, some helpful, can cause sickness.\\n- **Viruses = smartphones**: Not living on their own, need a host to function, and make copies of themselves using the host's resources. \\n\\nSo, while both can make us sick, how they operate and what they need to survive are very different!",\n      "is_selected": false,\n      "tool_calls": null\n    },\n    {\n      "index": 9,\n      "content": "Sure! Think of the difference between a virus and a bacterium like the difference between a house and a burglar.\\n\\nA **bacterium** is like a house. It\\u2019s a complete, self-sufficient structure that can live on its own. Just like a house has walls, rooms, and everything it needs to function, bacteria have all the necessary parts \\u2014 like a cell wall, cell membrane, and all the tools needed to grow and reproduce. Bacteria can thrive in many places, from your gut to the soil outside, and they can even be helpful, like the good bacteria that help you digest food.\\n\\nOn the other hand, a **virus** is like a burglar that needs to break into a house to survive. A virus is much smaller than a bacterium and doesn't have the machinery to live independently. It can't reproduce on its own; instead, it relies on invading a living cell (like the burglar getting inside a house) to make copies of itself. Once it enters a cell, it uses that cell's resources to multiply, which can sometimes make the host sick, just like a burglar causing trouble in a home.\\n\\nSo in summary: Bacteria are like houses, self-sufficient and capable of living independently, while viruses are like burglars that need to invade a house (or a cell) to survive and reproduce.",\n      "is_selected": false,\n      "tool_calls": null\n    },\n    {\n      "index": 10,\n      "content": "Sure! Let\\u2019s compare a virus and a bacterium to two different types of unwanted guests who show up at your house.\\n\\n**Bacteria:** Imagine a bacterium as a person who can walk into your house, set up their own little area, and even throw a small party. They can live on their own, make their own food, and don\\u2019t need your help to survive. Some bacteria are friendly and help with things like digesting food, while others might make you sick. But the important thing is, they\\u2019re self-sufficient guests who can thrive independently.\\n\\n**Viruses:** Now, think of a virus like a sneaky intruder who knocks on your door, but instead of entering and partying on their own, they need your help to do anything. When they get inside, they don't set up their own space\\u2014they hijack your party, take over your kitchen (which represents your cells), and tell you to make more of them. They can't survive or reproduce on their own; they need to use your resources to multiply. If you don\\u2019t let them in, they can't do anything.\\n\\nSo, in summary: a bacterium can live and grow independently, like a guest that can manage on their own, while a virus needs a host (like you) to reproduce and survive, acting like an unwanted intruder that requires your help to spread.",\n      "is_selected": false,\n      "tool_calls": null\n    },\n    {\n      "index": 11,\n      "content": "Sure! Let's think of viruses and bacteria using a simple analogy of houses and their residents. \\n\\nImagine that a bacterium is like a small, self-sufficient house with everything it needs inside. It has its own kitchen, bathroom, and bedroom \\u2013 all the facilities to live and thrive on its own. Bacteria can eat, grow, and reproduce all by themselves. They can do things like break down food and even multiply into more bacteria, like a house that can build more houses by itself.\\n\\nNow, on the other hand, a virus is like a tiny, unoccupied house that doesn\\u2019t have any residents of its own \\u2013 it can\\u2019t do anything on its own. This empty house is reliant on finding someone to move in. A virus can't eat, grow, or reproduce by itself. It needs to invade a living house (like a human or an animal cell) in order to take over. When it gets inside, it hijacks the kitchen and other facilities of the resident house, making it work for the virus, so it can multiply.\\n\\nIn short, bacteria are like independent houses that can live and grow on their own, while viruses are like empty houses that need to invade a living house to grow and thrive. Bacteria can be helpful or harmful, while viruses always need a host to cause an effect, often making the host sick in the process.",\n      "is_selected": false,\n      "tool_calls": null\n    },\n    {\n      "index": 12,\n      "content": "Sure! Let\\u2019s imagine that your body is like a bustling city, with lots of healthy buildings (cells) and people (functions) going about their daily lives. Now, in this city, sometimes unwanted visitors can arrive and cause trouble. These visitors can be either viruses or bacteria, but they each function in quite different ways. \\n\\n### Bacteria:\\nThink of bacteria as the street gangs in this city. They are like small groups that can live on their own. Some gangs (bacteria) do good things, like helping with the city\\u2019s garbage (like what some bacteria do to help digest food), while others can cause problems and create chaos. Bacteria are like independent contractors; they can reproduce and live on their own, forming colonies and causing various effects in the city. They have their own equipment (cell structures) to help them survive and thrive, which is why they can often be treated with antibiotics (like sending in the police to break up the gang).\\n\\n### Viruses:\\nNow, imagine viruses as sneaky spies that can\\u2019t function on their own. They can\\u2019t live in the city by themselves and need to break into one of the city's buildings (a cell) to get anything done. It\\u2019s like a virus knocks on the door, and when someone opens, the virus sneaks in and takes over that building to make more copies of itself. This is a problem because the building (cell) can no longer do its job properly. Viruses can\\u2019t be treated with antibiotics; instead, your city (immune system) has to recognize and fight off the spies using its own defenses, like raising an alarm to call for help.\\n\\nIn summary, bacteria are like independent gangs that can do their own thing\\u2014sometimes good, sometimes harmful\\u2014while viruses are like sneaky spies that need to hijack a building to cause trouble.",\n      "is_selected": false,\n      "tool_calls": null\n    },\n    {\n      "index": 13,\n      "content": "Sure! Think of the difference between a virus and a bacterium like the difference between a car and a driver.\\n\\n**Bacterium (the car):** Bacteria are like little cars. They are living organisms that can drive themselves around. They have everything they need to make copies of themselves \\u2013 a sturdy body (cell) with engines (organelles) that help them eat, grow, and reproduce on their own. There are good bacteria, like the ones that help you digest food, and bad bacteria that can make you sick. Just like cars can run on their own without help, bacteria can live and function independently in various environments.\\n\\n**Virus (the driver):** Viruses, on the other hand, are more like a driver who needs a car to go anywhere. Viruses are not complete living organisms on their own; they are much smaller and don\\u2019t have the machinery to reproduce by themselves. Instead, they need to \\"hijack\\" a car (a host cell) in order to make copies of themselves. When a virus attaches to a living cell, it injects its own instructions (like a driver telling the car what to do), forcing the cell to make new virus particles. Once they\\u2019ve reproduced, they can leave the cell and look for new cells to take over.\\n\\nIn summary:\\n- **Bacterium = car:** Can live and function on its own.\\n- **Virus = driver:** Needs to use a host (car) to live and reproduce.\\n\\nSo, while both viruses and bacteria can cause illness, they operate in very different ways!",\n      "is_selected": false,\n      "tool_calls": null\n    },\n    {\n      "index": 14,\n      "content": "Sure! Let\\u2019s think about a virus and a bacterium as two different kinds of \\u201ccreatures\\u201d that can cause sickness, but they work in very different ways.\\n\\n**Bacterium**: Imagine a bacterium as a tiny factory. These factories are self-sufficient and can produce everything they need to survive and grow. They can live on their own, multiply, and do their own thing. When you have a bacterial infection, it's like having too many factories operating in an area where they shouldn't be, creating problems and causing illness. For example, if you get a bacterial infection in your throat, it\\u2019s like a factory that\\u2019s producing too much waste in that area, leading to a sore throat.\\n\\n**Virus**: Now, think of a virus as a tiny burglar. This burglar can't do anything on its own; it needs to break into a factory (a cell) and take over the factory\\u2019s machinery to make copies of itself. When a virus infects a cell, it\\u2019s like the burglar saying, \\"Hey, I\\u2019m in charge now!\\" and forcing the factory to make more burglars instead of doing its regular job. This process can make the cell stop working properly and even cause it to die, leading to illness.\\n\\nSo, in summary:\\n- **Bacteria** are like independent factories that can cause infections when there are too many of them.\\n- **Viruses** are like burglars that need to invade factories to make more of themselves and cause disease. \\n\\nThat's why different approaches are used to treat infections caused by bacteria (like antibiotics) versus those caused by viruses (like vaccines or antiviral medications).",\n      "is_selected": false,\n      "tool_calls": null\n    },\n    {\n      "index": 15,\n      "content": "Sure! Think of a virus and a bacterium like two different types of troublemakers in a neighborhood.\\n\\n**Bacteria:** Imagine bacteria as small, independent troublemakers with their own little houses. They can live and thrive on their own. They eat, grow, and multiply by themselves. These troublemakers can sometimes be good, like those who help keep the neighborhood clean by breaking down waste, but they can also cause problems, like making people sick. Your body's immune system can often fight them off. \\n\\n**Viruses:** Now, think of viruses as sneakier troublemakers who don't have their own houses at all. They can't live on their own and need to invade someone's house (which is like a human cell) to survive. They knock on the door (attach to the cell), trick the homeowner into letting them in, and then take over the house to create more trouble (make copies of themselves). Because they only function inside a host, they can be harder to fight off since they\\u2019re hiding out in someone else's cells.\\n\\nSo, in summary:\\n- Bacteria can be seen as self-sufficient little homes that can cause trouble on their own, while\\n- Viruses are like sneaky invaders that need to take over someone else\\u2019s house to cause trouble. \\n\\nUnderstanding this difference can help us figure out how to deal with them: antibiotics can take care of bacteria, but they don\\u2019t work on viruses, which often need different treatments.",\n      "is_selected": false,\n      "tool_calls": null\n    }\n  ],\n  "scores": [\n    8.0,\n    9.0,\n    9.0,\n    9.0,\n    9.0,\n    10.0,\n    9.0,\n    9.0,\n    9.0,\n    9.0,\n    9.0,\n    9.0,\n    9.0,\n    10.0,\n    9.0,\n    9.0\n  ],\n  "max_score": 10.0,\n  "min_score": 8.0\n}`,
                    model_size: 'Small'
                },
                smallBaseline: {
                    response: `Sure! Imagine a virus and a bacterium as two different types of tiny intruders that can invade your home, which represents your body.\n\n**Bacterium**: Think of a bacterium like a small, but fully equipped mini-house. It can live on its own, has its own structure, and can even do some things for itself, like eat and grow. Just like a house has furniture and rooms, a bacterium has various parts that help it function. If it gets into your home (or body), it can sometimes cause problems, like making you sick, but it can also be harmless or even helpful (like the good bacteria in your gut that help with digestion).\n\n**Virus**: Now, imagine a virus as a sneaky burglar that doesnâ€™t have its own house. Instead, this burglar needs to break into a house (or a cell in your body) to survive and do anything. A virus is much simpler than a bacterium â€“ it doesn't eat or grow on its own; instead, it hijacks your house's resources to replicate itself. When the virus gets inside a cell, it takes over the cell's machinery and forces it to make more viruses, kind of like forcing a homeowner to turn their house into a factory. \n\nIn summary:\n- A bacterium can live independently, like a tiny house that can stand alone.\n- A virus needs to invade a host (like a burglar needing to break into a house) to create copies of itself and survive.\n\nSo, while both can invade and cause issues, they operate very differently!`,
                    latency_ms: 6728,
                    input_tokens: 28,
                    output_tokens: 316,
                    cost_usd: 0.000194,
                    model_size: 'Small'
                },
                whyItsHelped: `Best-of-N enabled the small model to generate multiple attempts and select the best one, matching or exceeding the frontier model's quality through computational scaling.`,
                tags: ["best_of_n", "openai", "frontier"]
            }
        ];
        let currentScenarioIndex = 0; // Track which scenario is displayed in guided mode

        // Guided mode questions tailored to each algorithm
        const GUIDED_MODE_QUESTIONS = {
            best_of_n: [
                "Write a persuasive argument for why cities should invest more in public transportation infrastructure.",
                "Explain the concept of machine learning to a 10-year-old using everyday examples.",
                "Analyze the potential long-term impacts of remote work on urban development.",
                "Create a detailed plan for someone who wants to transition from a corporate job to freelancing."
            ],
            self_consistency: [
                "If a train travels 120 miles in 2 hours, then speeds up and travels 180 miles in the next 2 hours, what is its average speed for the entire journey?",
                "A farmer has 17 sheep. All but 9 die. How many sheep are left alive?",
                "If you have a 3-gallon jug and a 5-gallon jug, how can you measure exactly 4 gallons of water?",
                "What is the next number in this sequence: 2, 6, 12, 20, 30, ?"
            ],
            beam_search: [
                "Solve: A rectangular garden is 3 times as long as it is wide. If the perimeter is 96 feet, find the length and width. Show all steps.",
                "Find the value of x: 3(2x - 5) + 4 = 2(x + 7) - 1. Show your step-by-step reasoning.",
                "A store offers a 20% discount on an item, then adds 8% sales tax. Is this the same as adding 8% tax first and then applying a 20% discount? Prove your answer with calculations.",
                "Three consecutive integers sum to 72. Find these integers using algebraic reasoning."
            ],
            particle_filtering: [
                "A bakery makes three types of pastries: croissants, muffins, and cookies. A croissant uses 3 eggs and 2 cups of flour. A muffin uses 1 egg and 1 cup of flour. A cookie batch uses 2 eggs and 3 cups of flour. If the bakery has 25 eggs and 30 cups of flour, and wants to maximize revenue where croissants sell for $4, muffins for $2, and cookie batches for $5, how many of each should they make?",
                "Find all integer solutions to: xÂ² + yÂ² = 65, where both x and y are positive. Then, for each solution, calculate xÂ³ - yÂ³. What is the sum of all these cubes?",
                "A frog is at the bottom of a 30-foot well. Each day it climbs up 5 feet, but each night it slides back down 2 feet. On which day will the frog reach the top? Show your step-by-step reasoning.",
                "In a tournament, 8 teams play in a single-elimination bracket. Team strengths are: A=8, B=7, C=6, D=5, E=4, F=3, G=2, H=1. A stronger team beats a weaker team with 80% probability. If the bracket is A vs H, B vs G, C vs F, D vs E, what is the probability that team C wins the tournament?"
            ],
            entropic_particle_filtering: [
                "In how many ways can you arrange the letters in the word MISSISSIPPI? Show your complete step-by-step calculation accounting for repeated letters.",
                "A rectangular box has dimensions that are consecutive even integers. If the volume is 960 cubic inches, find the dimensions. Then calculate the surface area.",
                "Solve the system of equations: 2x + 3y - z = 7, x - 2y + 4z = -3, 3x + y + 2z = 10. Show all steps including elimination or substitution process.",
                "A sequence is defined by: aâ‚ = 2, aâ‚‚ = 5, and aâ‚™ = 3aâ‚™â‚‹â‚ - 2aâ‚™â‚‹â‚‚ for n â‰¥ 3. Find aâ‚â‚€ and derive a general formula for aâ‚™."
            ],
            particle_gibbs: [
                "Solve this cryptarithmetic puzzle: SEND + MORE = MONEY. Each letter represents a unique digit (0-9). Show the complete solution process.",
                "Eight queens must be placed on a standard 8Ã—8 chessboard so that no two queens threaten each other. Find at least one valid configuration and explain your solving strategy.",
                "Solve the nonlinear system: xÂ² + yÂ² = 25, xy = 12. Find all real solutions (x, y) and verify each one.",
                "A group of 5 friends owes each other money: Alice owes Bob $20, Bob owes Carol $15, Carol owes David $30, David owes Emma $10, Emma owes Alice $25. What is the minimum number of transactions needed to settle all debts, and what should they be?"
            ]
        };

        // Algorithm descriptions
        const ALGORITHM_DESCRIPTIONS = {
            best_of_n: {
                type: 'outcome',
                category: 'production',
                name: 'Best-of-N',
                description: 'Generates multiple complete responses and uses an LLM judge to select the highest quality answer.',
                useCase: 'Best for: Open-ended questions, creative tasks, general Q&A'
            },
            self_consistency: {
                type: 'outcome',
                category: 'production',
                name: 'Self-Consistency',
                description: 'Generates multiple complete responses and selects the most frequent answer through majority voting.',
                useCase: 'Best for: Questions with clear correct answers, factual queries'
            },
            beam_search: {
                type: 'process',
                category: 'research',
                name: 'Beam Search',
                description: 'Explores multiple reasoning paths simultaneously, keeping only the top-k most promising paths at each step. Requires a Process Reward Model (PRM) for step-level scoring.',
                useCase: 'Research: Requires dedicated PRM infrastructure for optimal performance'
            },
            particle_filtering: {
                type: 'process',
                category: 'research',
                name: 'Particle Filtering',
                description: 'Uses Sequential Monte Carlo sampling to maintain and evolve multiple reasoning paths, resampling based on quality scores. Requires a Process Reward Model (PRM).',
                useCase: 'Research: Best results with local PRM on GPU for fast step scoring'
            },
            entropic_particle_filtering: {
                type: 'process',
                category: 'research',
                name: 'Entropic Particle Filtering',
                description: 'Particle filtering enhanced with temperature annealing to balance exploration and exploitation over time. Requires a Process Reward Model (PRM).',
                useCase: 'Research: Experimental algorithm for hard reasoning tasks'
            },
            particle_gibbs: {
                type: 'process',
                category: 'research',
                name: 'Particle Gibbs',
                description: 'Iteratively refines solutions using particle filtering with Gibbs sampling for multiple refinement passes. Requires a Process Reward Model (PRM).',
                useCase: 'Research: Most compute-intensive, best with dedicated PRM hardware'
            }
        };

        // Theme management
        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
        }

        // Load saved theme
        const savedTheme = localStorage.getItem('theme') || 'dark';
        document.documentElement.setAttribute('data-theme', savedTheme);

        // GUIDED WIZARD STATE & FUNCTIONS

        // Guided Wizard State
        let wizardState = {
            useCase: null,        // 'improve_model' or 'match_frontier'
            selectedModel: null,  // e.g., 'GPT-3.5 Turbo'
            frontierModel: null,  // e.g., 'GPT-4o' (for match_frontier only)
            algorithm: null,      // e.g., 'best_of_n'
            currentStep: 1        // 1-4
        };

        // Model-to-Frontier mapping
        const FRONTIER_MODEL_MAP = {
            'GPT-3.5 Turbo': 'GPT-4o',
            'GPT-4o Mini': 'GPT-4o',
            'Claude 3.5 Haiku': 'Claude 3.5 Sonnet',
            'Llama 3.2 3B': 'Llama 3.3 70B'
        };

        let currentWizardScenario = null;

        // Event delegation for the wizard (bound once)
        document.addEventListener('DOMContentLoaded', function() {
            const wizardEl = document.getElementById('guidedWizard');
            if (!wizardEl) return;
            wizardEl.addEventListener('click', function(e) {
                const wizardCard = e.target.closest('.wizard-card[data-usecase]');
                if (wizardCard) { selectUseCase(wizardCard.dataset.usecase); return; }

                const breadcrumb = e.target.closest('.breadcrumb.completed');
                if (breadcrumb) { navigateToStep(parseInt(breadcrumb.dataset.step)); return; }

                const backStepBtn = e.target.closest('.wizard-back-step-btn');
                if (backStepBtn) { navigateToStep(parseInt(backStepBtn.dataset.backTo)); return; }
            });
        });

        function initGuidedWizard() {
            // Reset state
            wizardState = {
                useCase: null,
                selectedModel: null,
                frontierModel: null,
                algorithm: null,
                currentStep: 1
            };
            currentWizardScenario = null;

            // Show wizard
            document.getElementById('guidedWizard').style.display = 'block';

            // Hide all other sections - wizard replaces the entire flow
            const sectionsToHide = [
                'useCaseSection',
                'scenarioSection',
                'configSection',
                'questionSection',
                'errorContainer',
                'expectedAnswerContainer',
                'resultsContainer',
                'performance-visualization-container'
            ];
            sectionsToHide.forEach(id => {
                const el = document.getElementById(id);
                if (el) el.style.display = 'none';
            });

            // Clean up dynamic elements from previous runs
            const perfContainer = document.getElementById('performanceDetailsContainer');
            if (perfContainer) perfContainer.remove();
            const headlineBanner = document.getElementById('wizardResultsHeadline');
            if (headlineBanner) headlineBanner.remove();
            const promptDisplay = document.getElementById('wizardPromptDisplay');
            if (promptDisplay) promptDisplay.style.display = 'none';

            // Also hide guided demo badge (wizard is self-explanatory)
            const badge = document.getElementById('guidedDemoBadge');
            if (badge) badge.style.display = 'none';

            // Hide back button if it exists
            const backBtn = document.getElementById('wizardBackBtn');
            if (backBtn) backBtn.style.display = 'none';

            // Reset question textarea and restore hidden form elements
            const questionEl = document.getElementById('question');
            if (questionEl) questionEl.disabled = false;
            const questionSection = document.getElementById('questionSection');
            if (questionSection) {
                const formGroup = questionSection.querySelector('.form-group');
                if (formGroup) formGroup.style.display = '';
                const actionBtns = questionSection.querySelector('.action-buttons');
                if (actionBtns) actionBtns.style.display = '';
                const exampleQs = questionSection.querySelector('.example-questions-container');
                if (exampleQs) exampleQs.style.display = '';
            }

            // Reset card selections
            document.querySelectorAll('#guidedWizard .wizard-card').forEach(card => {
                card.classList.remove('selected');
            });

            // Dynamically compute scenario counts
            document.querySelectorAll('#step1Container .wizard-card').forEach(card => {
                const count = OFFLINE_SCENARIOS.filter(s => s.useCase === card.dataset.usecase).length;
                const countEl = card.querySelector('.scenario-count');
                if (countEl) countEl.textContent = `${count} scenarios available`;
            });

            // Show step 1
            showWizardStep(1);
        }

        function showWizardStep(stepNumber) {
            wizardState.currentStep = stepNumber;

            // Hide all steps
            document.querySelectorAll('.wizard-step').forEach(step => {
                step.style.display = 'none';
            });

            // Show current step
            const currentStepEl = document.getElementById(`step${stepNumber}Container`);
            if (currentStepEl) {
                currentStepEl.style.display = 'block';
            }

            // Update breadcrumbs
            updateBreadcrumbs();
        }

        function updateBreadcrumbs() {
            document.querySelectorAll('.breadcrumb').forEach((crumb, index) => {
                const stepNum = parseInt(crumb.dataset.step);
                crumb.classList.remove('active', 'completed');

                if (stepNum < wizardState.currentStep) {
                    crumb.classList.add('completed');
                } else if (stepNum === wizardState.currentStep) {
                    crumb.classList.add('active');
                }
            });
        }

        function navigateToStep(stepNumber) {
            // Clear state for steps after the target
            if (stepNumber <= 1) {
                wizardState.useCase = null;
                wizardState.selectedModel = null;
                wizardState.frontierModel = null;
                wizardState.algorithm = null;
            } else if (stepNumber <= 2) {
                wizardState.selectedModel = null;
                wizardState.frontierModel = null;
                wizardState.algorithm = null;
            } else if (stepNumber <= 3) {
                wizardState.algorithm = null;
            }

            // If navigating away from results (step 4), clean up results UI
            if (wizardState.currentStep === 4) {
                const perfContainer = document.getElementById('performanceDetailsContainer');
                if (perfContainer) perfContainer.remove();
                const headlineBanner = document.getElementById('wizardResultsHeadline');
                if (headlineBanner) headlineBanner.remove();
                const resultsContainer = document.getElementById('resultsContainer');
                if (resultsContainer) resultsContainer.style.display = 'none';
                const questionSection = document.getElementById('questionSection');
                if (questionSection) questionSection.style.display = 'none';
                const backBtn = document.getElementById('wizardBackBtn');
                if (backBtn) backBtn.style.display = 'none';
                const promptDisplay = document.getElementById('wizardPromptDisplay');
                if (promptDisplay) promptDisplay.style.display = 'none';
                const formGroup = document.querySelector('#questionSection .form-group');
                if (formGroup) formGroup.style.display = '';
                const q = document.getElementById('question');
                if (q) q.disabled = false;
                currentWizardScenario = null;
            }

            showWizardStep(stepNumber);

            // Re-populate dynamic content if needed
            if (stepNumber === 2 && wizardState.useCase) populateModelSelection();
            if (stepNumber === 3 && wizardState.selectedModel) populateAlgorithmSelection();
        }

        function selectUseCase(useCase) {
            wizardState.useCase = useCase;

            // Update card selection
            document.querySelectorAll('#guidedWizard .wizard-card').forEach(card => {
                card.classList.toggle('selected', card.dataset.usecase === useCase);
            });

            // Populate model options for step 2
            setTimeout(() => {
                populateModelSelection();
                showWizardStep(2);
            }, 300);
        }

        function populateModelSelection() {
            const container = document.getElementById('modelSelectionContainer');
            container.innerHTML = '';

            // Get available models for this use case
            const availableScenarios = OFFLINE_SCENARIOS.filter(s => s.useCase === wizardState.useCase);
            const uniqueModels = [...new Set(availableScenarios.map(s => s.model))];

            // Auto-select if only one model available
            if (uniqueModels.length === 1) {
                selectModel(uniqueModels[0]);
                return;
            }

            uniqueModels.forEach(model => {
                const card = document.createElement('div');
                card.className = 'model-card';
                card.dataset.model = model;

                // Get provider for this model
                const scenario = availableScenarios.find(s => s.model === model);
                const provider = scenario.provider;

                let frontierInfo = '';
                if (wizardState.useCase === 'match_frontier' && FRONTIER_MODEL_MAP[model]) {
                    frontierInfo = `<div class="frontier-match">â†’ Matches ${FRONTIER_MODEL_MAP[model]}</div>`;
                }

                card.innerHTML = `
                    <div class="model-card-header">
                        <span class="model-name">${model}</span>
                        <span class="model-provider">${provider}</span>
                    </div>
                    ${frontierInfo}
                `;

                card.addEventListener('click', () => selectModel(model));
                container.appendChild(card);
            });
        }

        function selectModel(model) {
            wizardState.selectedModel = model;
            wizardState.frontierModel = FRONTIER_MODEL_MAP[model] || null;

            // Update card selection
            document.querySelectorAll('.model-card').forEach(card => {
                card.classList.toggle('selected', card.dataset.model === model);
            });

            // Populate algorithm options for step 3
            setTimeout(() => {
                populateAlgorithmSelection();
                showWizardStep(3);
            }, 300);
        }

        function populateAlgorithmSelection() {
            const container = document.getElementById('algorithmSelectionContainer');
            container.innerHTML = '';

            // Get available algorithms for this use case + model combination
            const availableScenarios = OFFLINE_SCENARIOS.filter(s =>
                s.useCase === wizardState.useCase &&
                s.model === wizardState.selectedModel
            );
            const availableAlgorithms = [...new Set(availableScenarios.map(s => s.algorithm))];

            // Show only production algorithms that have available scenarios
            const productionAvailable = [];
            Object.keys(ALGORITHM_DESCRIPTIONS).forEach(algorithm => {
                const info = ALGORITHM_DESCRIPTIONS[algorithm];
                if (info.category === 'research') return;
                if (!availableAlgorithms.includes(algorithm)) return;
                productionAvailable.push(algorithm);
            });

            // Auto-select if only one algorithm available
            if (productionAvailable.length === 1) {
                selectAlgorithm(productionAvailable[0]);
                return;
            }

            productionAvailable.forEach(algorithm => {
                const info = ALGORITHM_DESCRIPTIONS[algorithm];

                const card = document.createElement('div');
                card.className = 'algorithm-card';
                card.dataset.algorithm = algorithm;

                card.innerHTML = `
                    <div class="algorithm-name">${info.name}</div>
                    <span class="algorithm-type-badge">${info.type}</span>
                    <div class="algorithm-description">${info.description}</div>
                    <div class="algorithm-usecase">${info.useCase}</div>
                `;

                card.addEventListener('click', () => selectAlgorithm(algorithm));

                container.appendChild(card);
            });
        }

        function selectAlgorithm(algorithm) {
            wizardState.algorithm = algorithm;

            // Update card selection
            document.querySelectorAll('.algorithm-card').forEach(card => {
                card.classList.toggle('selected', card.dataset.algorithm === algorithm);
            });

            // Load matching scenario
            setTimeout(() => {
                loadWizardScenario();
            }, 300);
        }

        function loadWizardScenario() {
            // Find all matching scenarios and pick one randomly
            const matches = OFFLINE_SCENARIOS.filter(s =>
                s.useCase === wizardState.useCase &&
                s.model === wizardState.selectedModel &&
                s.algorithm === wizardState.algorithm
            );

            if (matches.length === 0) {
                showError('No matching scenario found for this combination.');
                return;
            }

            const scenario = matches[Math.floor(Math.random() * matches.length)];

            // Store for copy summary
            currentWizardScenario = scenario;

            // Hide wizard step containers but keep breadcrumbs visible
            document.querySelectorAll('.wizard-step').forEach(step => {
                step.style.display = 'none';
            });

            // Update breadcrumbs to show step 4 as active
            wizardState.currentStep = 4;
            updateBreadcrumbs();

            // Show the question section with styled prompt display
            const questionSection = document.getElementById('questionSection');
            questionSection.style.display = 'block';

            // Hide form elements (textarea, buttons, examples)
            const formGroup = questionSection.querySelector('.form-group');
            if (formGroup) formGroup.style.display = 'none';
            const actionButtons = questionSection.querySelector('.action-buttons');
            if (actionButtons) actionButtons.style.display = 'none';

            // Show styled prompt display
            let promptDisplay = document.getElementById('wizardPromptDisplay');
            if (!promptDisplay) {
                promptDisplay = document.createElement('div');
                promptDisplay.id = 'wizardPromptDisplay';
                promptDisplay.className = 'wizard-prompt-display';
                questionSection.appendChild(promptDisplay);
            }
            promptDisplay.style.display = 'block';
            promptDisplay.innerHTML = `
                <div class="wizard-prompt-label">Prompt</div>
                <div class="wizard-prompt-text">${scenario.prompt.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</div>
            `;

            // Add a "Back to Selection" button in the wizard area
            const wizardEl = document.getElementById('guidedWizard');
            let backBtn = document.getElementById('wizardBackBtn');
            if (!backBtn) {
                backBtn = document.createElement('button');
                backBtn.id = 'wizardBackBtn';
                backBtn.className = 'btn-secondary';
                backBtn.style.cssText = 'margin-bottom: 16px; display: flex; align-items: center; gap: 8px;';
                backBtn.innerHTML = 'â† Back to Selection';
                backBtn.addEventListener('click', () => {
                    initGuidedWizard();
                });
                wizardEl.insertBefore(backBtn, wizardEl.querySelector('.wizard-breadcrumbs'));
            }
            backBtn.style.display = 'flex';

            // Update algorithm selector to match
            selectedAlgorithm = scenario.algorithm;

            // Render results
            renderWizardResults(scenario);
        }

        function renderWizardResponsePane(response, container) {
            const conclusion = extractConclusion(response);
            let html = `<div class="chat-response">${formatAsHTML(conclusion)}</div>`;

            // Add expandable detailed response if conclusion differs from full text
            if (conclusion !== response) {
                html += `
                    <div class="expandable-section">
                        <button class="expand-button" onclick="toggleSection(this)">
                            <svg class="expand-icon" width="16" height="16" viewBox="0 0 16 16" fill="none">
                                <path d="M4 6L8 10L12 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            <span>View Detailed Response</span>
                        </button>
                        <div class="expandable-content">
                            <div class="reasoning-section">
                                <div class="reasoning-content">
                                    ${formatReasoningSteps(response)}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
            container.innerHTML = html;
            renderMath(container);
        }

        function renderWizardResults(scenario) {
            const algName = ALGORITHM_DESCRIPTIONS[scenario.algorithm]?.name || scenario.algorithm;

            // Build and insert headline banner
            let headline = '';
            if (wizardState.useCase === 'match_frontier') {
                const costRatio = scenario.baseline.cost_usd > 0
                    ? ((scenario.its.cost_usd / scenario.baseline.cost_usd) * 100).toFixed(0)
                    : '?';
                headline = `${scenario.model} + ${algName} achieved frontier-equivalent quality at ${costRatio}% of ${wizardState.frontierModel}'s cost`;
            } else {
                headline = `${scenario.model} + ${algName}: ${scenario.budget} candidates evaluated to find the best answer`;
            }

            let headlineBanner = document.getElementById('wizardResultsHeadline');
            if (!headlineBanner) {
                headlineBanner = document.createElement('div');
                headlineBanner.id = 'wizardResultsHeadline';
                headlineBanner.className = 'wizard-results-headline';
                const resultsContainer = document.getElementById('resultsContainer');
                resultsContainer.parentNode.insertBefore(headlineBanner, resultsContainer);
            }
            headlineBanner.style.display = 'block';
            headlineBanner.innerHTML = `
                <div class="headline-text">${headline}</div>
                <button id="copySummaryBtn" class="btn-secondary copy-summary-btn" onclick="copyWizardSummary()">Copy Summary</button>
            `;

            // Show the results container
            const resultsContainer = document.getElementById('resultsContainer');
            resultsContainer.style.display = '';

            // Get actual pane elements
            const smallBaselinePane = document.getElementById('smallBaselinePane');
            const middlePaneTitle = document.getElementById('middlePaneTitle');
            const middlePaneContent = document.getElementById('middlePaneContent');
            const rightPaneTitle = document.getElementById('rightPaneTitle');
            const rightPaneContent = document.getElementById('rightPaneContent');

            // For match_frontier, show 3-column layout
            if (wizardState.useCase === 'match_frontier') {
                smallBaselinePane.style.display = 'block';

                // Small model baseline (left pane)
                const smallBaselineTitle = document.getElementById('smallBaselineTitle');
                if (smallBaselineTitle) smallBaselineTitle.textContent = scenario.model;
                const smallBaselineContent = document.getElementById('smallBaselineContent');
                renderWizardResponsePane(scenario.smallBaseline?.response || scenario.baseline.response, smallBaselineContent);
                smallBaselineContent.innerHTML += renderPerformanceBadges(scenario.smallBaseline || scenario.baseline, 'baseline');

                // Frontier model baseline (middle pane)
                middlePaneTitle.textContent = wizardState.frontierModel || 'Frontier Model';
                renderWizardResponsePane(scenario.baseline.response, middlePaneContent);
                middlePaneContent.innerHTML += renderPerformanceBadges(scenario.baseline, 'baseline');
                renderMath(middlePaneContent);

                // ITS result (right pane)
                rightPaneTitle.textContent = 'ITS Enhanced';
                renderITSPane(scenario, rightPaneContent);
            } else {
                // improve_model: 2-column layout
                smallBaselinePane.style.display = 'none';

                // Baseline (middle pane)
                middlePaneTitle.textContent = `${scenario.model} (Baseline)`;
                renderWizardResponsePane(scenario.baseline.response, middlePaneContent);
                middlePaneContent.innerHTML += renderPerformanceBadges(scenario.baseline, 'baseline');
                renderMath(middlePaneContent);

                // ITS result (right pane)
                rightPaneTitle.textContent = 'ITS Enhanced';
                renderITSPane(scenario, rightPaneContent);
            }

            // Render performance details below results
            renderPerformanceDetails(scenario);
        }

        function renderITSPane(scenario, container) {
            const algName = ALGORITHM_DESCRIPTIONS[scenario.algorithm]?.name || scenario.algorithm;

            // Why ITS Helped banner
            const whyBanner = `
                <div class="why-its-helped-banner">
                    <div class="why-its-helped-icon">ðŸ’¡</div>
                    <div class="why-its-helped-content">
                        <div class="why-its-helped-title">Why ITS Helped</div>
                        <div class="why-its-helped-text">${scenario.whyItsHelped || 'ITS enhanced the model performance through intelligent scaling.'}</div>
                    </div>
                </div>
            `;

            // Result content with conclusion extraction
            const conclusion = extractConclusion(scenario.its.response);
            let resultContent = `<div class="chat-response">${formatAsHTML(conclusion)}</div>`;
            if (conclusion !== scenario.its.response) {
                resultContent += `
                    <div class="expandable-section">
                        <button class="expand-button" onclick="toggleSection(this)">
                            <svg class="expand-icon" width="16" height="16" viewBox="0 0 16 16" fill="none">
                                <path d="M4 6L8 10L12 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            <span>View Detailed Response</span>
                        </button>
                        <div class="expandable-content">
                            <div class="reasoning-section">
                                <div class="reasoning-content">
                                    ${formatReasoningSteps(scenario.its.response)}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            // Performance badges
            const perfBadges = renderPerformanceBadges(scenario.its, 'its');

            // Parse and render trace
            let traceHTML = '';
            try {
                const trace = typeof scenario.its.trace === 'string'
                    ? JSON.parse(scenario.its.trace)
                    : scenario.its.trace;
                if (trace && trace.algorithm) {
                    const candidateCount = trace.candidates?.length || trace.num_iterations || 'multiple';
                    const candidateLabel = trace.candidates ? 'candidate responses' : 'iterations';
                    traceHTML = `
                        <div class="trace-visualization-container">
                            <div class="trace-intro">
                                <strong>Algorithm Execution Trace</strong>
                                <p>See how ${algName} explored ${candidateCount} ${candidateLabel} to find the best answer.</p>
                            </div>
                            ${renderAlgorithmTrace(trace, true)}
                        </div>
                    `;
                }
            } catch (e) {
                console.error('Failed to parse trace:', e);
            }

            container.innerHTML = `
                ${whyBanner}
                ${resultContent}
                ${perfBadges}
                ${traceHTML}
            `;
            renderMath(container);
        }

        function copyWizardSummary() {
            const scenario = currentWizardScenario;
            if (!scenario) return;

            const algName = ALGORITHM_DESCRIPTIONS[scenario.algorithm]?.name || scenario.algorithm;
            const latencyChange = ((scenario.its.latency_ms - scenario.baseline.latency_ms) / scenario.baseline.latency_ms * 100).toFixed(1);
            const costChange = scenario.baseline.cost_usd > 0
                ? ((scenario.its.cost_usd - scenario.baseline.cost_usd) / scenario.baseline.cost_usd * 100).toFixed(1)
                : 'N/A';

            let summary = `ITS Demo Summary\n`;
            summary += `================\n`;
            summary += `Use Case: ${wizardState.useCase === 'match_frontier' ? 'Match Frontier Model' : 'Improve Model Performance'}\n`;
            summary += `Model: ${scenario.model}\n`;
            summary += `Algorithm: ${algName}\n`;
            summary += `Budget: ${scenario.budget} candidates\n\n`;
            summary += `Baseline: ${scenario.baseline.latency_ms}ms, $${scenario.baseline.cost_usd.toFixed(4)}\n`;
            summary += `ITS Enhanced: ${scenario.its.latency_ms}ms, $${scenario.its.cost_usd.toFixed(4)}\n`;
            summary += `Latency change: ${latencyChange > 0 ? '+' : ''}${latencyChange}%\n`;
            summary += `Cost change: ${costChange !== 'N/A' ? (costChange > 0 ? '+' : '') + costChange + '%' : 'N/A'}\n\n`;
            summary += `Prompt: ${scenario.prompt}\n`;
            if (scenario.whyItsHelped) {
                summary += `\nWhy ITS Helped: ${scenario.whyItsHelped}\n`;
            }

            navigator.clipboard.writeText(summary).then(() => {
                const btn = document.getElementById('copySummaryBtn');
                if (btn) {
                    const orig = btn.textContent;
                    btn.textContent = 'Copied!';
                    setTimeout(() => { btn.textContent = orig; }, 1500);
                }
            });
        }

        function renderPerformanceBadges(data, type) {
            return `
                <div class="performance-badges">
                    <span class="perf-badge latency">
                        <span class="perf-label">Latency:</span>
                        <span class="perf-value">${data.latency_ms || 'N/A'} ms</span>
                    </span>
                    <span class="perf-badge cost">
                        <span class="perf-label">Cost:</span>
                        <span class="perf-value">$${(data.cost_usd || 0).toFixed(4)}</span>
                    </span>
                    <span class="perf-badge tokens">
                        <span class="perf-label">Tokens:</span>
                        <span class="perf-value">${data.input_tokens || 0} in / ${data.output_tokens || 0} out</span>
                    </span>
                </div>
            `;
        }

        function toggleTraceVisibility() {
            const content = document.getElementById('traceContent');
            const toggle = document.querySelector('.trace-toggle');
            const icon = document.querySelector('.trace-toggle-icon');

            if (content.style.display === 'none') {
                content.style.display = 'block';
                icon.textContent = 'â–²';
                toggle.classList.add('active');
            } else {
                content.style.display = 'none';
                icon.textContent = 'â–¼';
                toggle.classList.remove('active');
            }
        }

        function renderPerformanceDetails(scenario) {
            // Create performance details container
            let perfContainer = document.getElementById('performanceDetailsContainer');
            if (!perfContainer) {
                perfContainer = document.createElement('div');
                perfContainer.id = 'performanceDetailsContainer';
                perfContainer.className = 'performance-details-section';

                // Insert after the results container
                const resultsContainer = document.getElementById('resultsContainer');
                if (resultsContainer && resultsContainer.parentNode) {
                    resultsContainer.parentNode.insertBefore(perfContainer, resultsContainer.nextSibling);
                }
            }
            perfContainer.style.display = 'block';

            // Calculate comparisons
            const baseline = scenario.baseline;
            const its = scenario.its;

            const latencyChange = ((its.latency_ms - baseline.latency_ms) / baseline.latency_ms * 100).toFixed(1);
            const costChange = baseline.cost_usd > 0
                ? ((its.cost_usd - baseline.cost_usd) / baseline.cost_usd * 100).toFixed(1)
                : 'N/A';
            const tokenChange = ((its.output_tokens - baseline.output_tokens) / baseline.output_tokens * 100).toFixed(1);

            // Color logic: cost/latency increases are expected ITS tradeoff (neutral gray), decreases are wins (green)
            const latencyClass = parseFloat(latencyChange) > 0 ? 'neutral' : 'positive';
            const costClass = costChange !== 'N/A' ? (parseFloat(costChange) > 0 ? 'neutral' : (parseFloat(costChange) < 0 ? 'positive' : 'neutral')) : 'neutral';
            const algName = ALGORITHM_DESCRIPTIONS[scenario.algorithm]?.name || scenario.algorithm;

            const perfHTML = `
                <div class="perf-details-header">
                    <h3>Performance Comparison</h3>
                    <span class="perf-details-subtitle">Baseline vs ITS Enhanced</span>
                </div>

                <div class="perf-metrics-grid">
                    <!-- Quality -->
                    <div class="perf-metric-card quality-highlight">
                        <div class="perf-metric-label">Quality</div>
                        <div class="perf-metric-values">
                            <span class="metric-its" style="font-size: 20px;">Enhanced</span>
                        </div>
                        <div class="perf-metric-change positive">
                            Best of ${scenario.budget} candidates
                        </div>
                    </div>

                    <!-- Latency -->
                    <div class="perf-metric-card">
                        <div class="perf-metric-label">Latency (ITS Investment)</div>
                        <div class="perf-metric-values">
                            <span class="metric-baseline">${baseline.latency_ms} ms</span>
                            <span class="metric-arrow">â†’</span>
                            <span class="metric-its">${its.latency_ms} ms</span>
                        </div>
                        <div class="perf-metric-change ${latencyClass}">
                            ${latencyChange > 0 ? '+' : ''}${latencyChange}%
                        </div>
                        <div class="perf-metric-note">Expected tradeoff for higher quality</div>
                    </div>

                    <!-- Cost -->
                    <div class="perf-metric-card">
                        <div class="perf-metric-label">Cost (ITS Investment)</div>
                        <div class="perf-metric-values">
                            <span class="metric-baseline">$${baseline.cost_usd.toFixed(4)}</span>
                            <span class="metric-arrow">â†’</span>
                            <span class="metric-its">$${its.cost_usd.toFixed(4)}</span>
                        </div>
                        <div class="perf-metric-change ${costClass}">
                            ${costChange !== 'N/A' ? (costChange > 0 ? '+' : '') + costChange + '%' : costChange}
                        </div>
                        <div class="perf-metric-note">Expected tradeoff for higher quality</div>
                    </div>

                    <!-- Tokens -->
                    <div class="perf-metric-card">
                        <div class="perf-metric-label">Output Tokens</div>
                        <div class="perf-metric-values">
                            <span class="metric-baseline">${baseline.output_tokens}</span>
                            <span class="metric-arrow">â†’</span>
                            <span class="metric-its">${its.output_tokens}</span>
                        </div>
                        <div class="perf-metric-change ${tokenChange > 0 ? 'neutral' : 'positive'}">
                            ${tokenChange > 0 ? '+' : ''}${tokenChange}%
                        </div>
                    </div>
                </div>
            `;

            perfContainer.innerHTML = perfHTML;
        }

        // LANDING PAGE & EXPERIENCE SELECTION

        function selectExperience(experience) {
            selectedExperience = experience;
            localStorage.setItem('selectedExperience', experience);

            // Hide landing page
            document.getElementById('landingPage').classList.add('hidden');

            // Show demo container
            document.getElementById('demoContainer').classList.remove('hidden');

            // Show back to home button
            document.getElementById('backToHomeBtn').classList.add('visible');

            // Configure experience
            if (experience === 'guided') {
                // Set to guided mode (non-expert)
                isExpertMode = false;
                localStorage.setItem('expertMode', 'false');
                document.getElementById('expertModeToggle').style.display = 'none';

                // Initialize wizard instead of scenario selector
                initGuidedWizard();
            } else {
                // Interactive mode - show expert toggle, default to non-expert
                isExpertMode = false;
                localStorage.setItem('expertMode', 'false');
                document.getElementById('expertModeToggle').style.display = 'flex';
            }

            // Initialize the demo
            initializeDemo();
        }

        function returnToLanding() {
            // Clear selection
            selectedExperience = null;
            localStorage.removeItem('selectedExperience');

            // Reset wizard state
            wizardState = { useCase: null, selectedModel: null, frontierModel: null, algorithm: null, currentStep: 1 };
            currentWizardScenario = null;

            // Clean up wizard DOM elements
            const perfContainer = document.getElementById('performanceDetailsContainer');
            if (perfContainer) perfContainer.remove();
            const headlineBanner = document.getElementById('wizardResultsHeadline');
            if (headlineBanner) headlineBanner.remove();

            // Hide wizard UI
            const wizard = document.getElementById('guidedWizard');
            if (wizard) wizard.style.display = 'none';
            const backBtn = document.getElementById('wizardBackBtn');
            if (backBtn) backBtn.style.display = 'none';
            const promptDisplay = document.getElementById('wizardPromptDisplay');
            if (promptDisplay) promptDisplay.style.display = 'none';

            // Re-enable question textarea
            const questionEl = document.getElementById('question');
            if (questionEl) questionEl.disabled = false;

            // Restore hidden UI elements
            const questionSection = document.getElementById('questionSection');
            if (questionSection) {
                const formGroup = questionSection.querySelector('.form-group');
                if (formGroup) formGroup.style.display = '';
                const actionButtons = questionSection.querySelector('.action-buttons');
                if (actionButtons) actionButtons.style.display = '';
                const exampleQuestions = questionSection.querySelector('.example-questions-container');
                if (exampleQuestions) exampleQuestions.style.display = '';
            }

            // Hide results
            const resultsContainer = document.getElementById('resultsContainer');
            if (resultsContainer) resultsContainer.style.display = 'none';

            // Hide demo container
            document.getElementById('demoContainer').classList.add('hidden');

            // Show landing page
            document.getElementById('landingPage').classList.remove('hidden');

            // Hide back button
            document.getElementById('backToHomeBtn').classList.remove('visible');

            // Clear any running state
            isRunning = false;
        }

        function initializeDemo() {
            // This will be called after experience selection
            showAlgorithmInfo(selectedAlgorithm);
            loadModels();
            loadExampleQuestions();
            updateUIForUseCase();

            // Skip old scenario initialization in guided mode
            // (Wizard handles its own initialization via initGuidedWizard)

            updateUIForExpertMode();

            // Initialize budget slider gradient
            const budgetSlider = document.getElementById('budget');
            budgetSlider.addEventListener('input', updateBudgetSliderGradient);
            updateBudgetSliderGradient.call(budgetSlider);
        }

        function updateBudgetSliderGradient() {
            const value = this.value;
            const max = this.max;
            const percentage = (value / max) * 100;
            this.style.background = `linear-gradient(to right, var(--primary) 0%, var(--primary) ${percentage}%, var(--border-color) ${percentage}%, var(--border-color) 100%)`;
        }

        // Check if user has a saved experience preference
        function checkSavedExperience() {
            const savedExperience = localStorage.getItem('selectedExperience');
            if (savedExperience) {
                // Auto-select the previously chosen experience
                selectExperience(savedExperience);
            }
            // Otherwise, show landing page (default state)
        }

        // Expert Mode management
        function toggleExpertMode() {
            // Prevent toggling during active run
            if (isRunning) {
                showError('Cannot change mode during active comparison. Please wait for the current run to complete.');
                return;
            }

            isExpertMode = !isExpertMode;
            localStorage.setItem('expertMode', isExpertMode ? 'true' : 'false');

            // Update toggle button visual state
            const toggleButton = document.getElementById('expertModeToggle');
            if (isExpertMode) {
                toggleButton.classList.add('active');
            } else {
                toggleButton.classList.remove('active');
            }

            // Update UI based on mode
            updateUIForExpertMode();
        }

        // Load saved expert mode preference
        const savedExpertMode = localStorage.getItem('expertMode') === 'true';
        isExpertMode = savedExpertMode;
        if (isExpertMode) {
            document.getElementById('expertModeToggle').classList.add('active');
        }

        // Update UI based on expert mode
        function updateUIForExpertMode() {
            const useCaseSection = document.querySelector('.section:has(input[name="useCase"])');
            const algorithmGroup = document.getElementById('algorithm').closest('.form-group');
            const budgetGroup = document.getElementById('budget').closest('.form-group');
            const algorithmSelect = document.getElementById('algorithm');
            const budgetSlider = document.getElementById('budget');
            const algorithmInfo = document.getElementById('algorithmInfo');
            const exampleQuestionsContainer = document.querySelector('.example-questions-container');
            const configDescription = document.getElementById('configDescription');
            const frontierModelGroup = document.getElementById('frontierModelGroup');
            const clearButton = document.querySelector('.btn-secondary');
            const configSectionTitle = document.querySelector('.section:has(#modelSelectionGrid) .section-title');
            const questionSectionTitle = document.querySelector('.section:has(#question) .section-title');
            const questionSectionDescription = document.querySelector('.section:has(#question) .section-description');
            const headerSubtitle = document.getElementById('headerSubtitle');
            const guidedQuestions = document.getElementById('guidedQuestions');
            const questionTextarea = document.getElementById('question');
            const scenarioSelectorContainer = document.getElementById('scenarioSelectorContainer');
            const guidedDemoBadge = document.getElementById('guidedDemoBadge');
            const runButton = document.getElementById('runButton');
            const configSection = document.querySelector('.section:has(#modelSelectionGrid)');
            const questionSection = document.querySelector('.section:has(#question)');

            // GUIDED DEMO: Always offline scenarios, no expert mode
            if (selectedExperience === 'guided') {
                // Hide use case selection entirely
                if (useCaseSection) {
                    useCaseSection.style.display = 'none';
                }

                // Hide budget slider
                budgetGroup.style.display = 'none';

                // Hide algorithm info cards
                if (algorithmInfo) {
                    algorithmInfo.style.display = 'none';
                }

                // Hide example questions
                if (exampleQuestionsContainer) {
                    exampleQuestionsContainer.style.display = 'none';
                }

                // Hide config description
                if (configDescription) {
                    configDescription.style.display = 'none';
                }

                // Hide clear button
                if (clearButton) {
                    clearButton.style.display = 'none';
                }

                // Hide frontier model group
                if (frontierModelGroup) {
                    frontierModelGroup.style.display = 'none';
                }

                // Disable use case radio buttons
                document.querySelectorAll('input[name="useCase"]').forEach(radio => {
                    radio.disabled = true;
                });

                // Set default budget
                budgetSlider.value = 16;
                document.getElementById('budgetValue').textContent = '16';

                // Hide guided questions
                if (guidedQuestions) {
                    guidedQuestions.classList.remove('visible');
                }

                // Show scenario selector
                if (scenarioSelectorContainer) {
                    scenarioSelectorContainer.classList.add('visible');
                }

                // Show guided demo badge
                if (guidedDemoBadge) {
                    guidedDemoBadge.style.display = 'block';
                }

                // Hide Run button (scenarios are pre-loaded)
                if (runButton) {
                    runButton.style.display = 'none';
                }

                // Hide configuration section (scenarios are pre-configured)
                if (configSection) {
                    configSection.style.display = 'none';
                }

                // Make question textarea read-only
                if (questionTextarea) {
                    questionTextarea.placeholder = 'Question from selected scenario';
                    questionTextarea.disabled = true;
                }

                // Update headers for guided mode
                if (headerSubtitle) {
                    headerSubtitle.textContent = 'Explore curated examples showing how ITS improves model responses';
                }
                if (questionSectionTitle) {
                    questionSectionTitle.textContent = 'Scenario Prompt';
                }
                if (questionSectionDescription) {
                    questionSectionDescription.style.display = 'none';
                }
                if (configSectionTitle) {
                    configSectionTitle.textContent = 'Setup';
                }

            // INTERACTIVE DEMO: Original live experience with expert mode toggle
            } else if (selectedExperience === 'interactive') {
                // Always hide scenario selector and guided badge in interactive mode
                if (scenarioSelectorContainer) {
                    scenarioSelectorContainer.classList.remove('visible');
                }
                if (guidedDemoBadge) {
                    guidedDemoBadge.style.display = 'none';
                }

                // Expert Mode: Show all controls (original behavior)
                if (isExpertMode) {
                    if (useCaseSection) {
                        useCaseSection.style.display = 'block';
                    }

                    // Show budget slider
                    budgetGroup.style.display = 'block';

                    // Show algorithm info
                    if (algorithmInfo) {
                        algorithmInfo.style.display = 'block';
                    }

                    // Show example questions
                    if (exampleQuestionsContainer) {
                        exampleQuestionsContainer.style.display = 'block';
                    }

                    // Show config description
                    if (configDescription) {
                        configDescription.style.display = 'block';
                    }

                    // Show clear button
                    if (clearButton) {
                        clearButton.style.display = 'inline-flex';
                    }

                    // Enable algorithm selection
                    algorithmSelect.disabled = false;

                    // Enable budget slider
                    budgetSlider.disabled = false;

                    // Enable use case radio buttons
                    document.querySelectorAll('input[name="useCase"]').forEach(radio => {
                        radio.disabled = false;
                    });

                    // Restore section titles and descriptions
                    if (configSectionTitle) {
                        configSectionTitle.textContent = 'Configuration';
                    }
                    if (questionSectionTitle) {
                        questionSectionTitle.textContent = 'Your Question';
                    }
                    if (questionSectionDescription) {
                        questionSectionDescription.style.display = 'block';
                        questionSectionDescription.textContent = 'Ask anything or try an example';
                    }
                    if (headerSubtitle) {
                        headerSubtitle.textContent = 'Compare baseline inference with ITS algorithms side by side';
                    }

                    // Hide guided questions
                    if (guidedQuestions) {
                        guidedQuestions.classList.remove('visible');
                    }

                    // Show Run button
                    if (runButton) {
                        runButton.style.display = 'inline-flex';
                    }

                    // Show configuration section
                    if (configSection) {
                        configSection.style.display = 'block';
                    }

                    // Restore placeholder
                    if (questionTextarea) {
                        questionTextarea.placeholder = 'Enter your question here...';
                        questionTextarea.disabled = false;
                    }

                // Non-Expert Mode: Simplified but still live (original behavior)
                } else {
                    // Simplify section headers
                    if (configSectionTitle) {
                        configSectionTitle.textContent = 'Setup';
                    }
                    if (questionSectionTitle) {
                        questionSectionTitle.textContent = 'Your Question';
                    }
                    if (questionSectionDescription) {
                        questionSectionDescription.style.display = 'none';
                    }
                    if (headerSubtitle) {
                        headerSubtitle.textContent = 'Compare model responses with different ITS algorithms';
                    }

                    // Hide use case selection
                    if (useCaseSection) {
                        useCaseSection.style.display = 'none';
                    }

                    // Hide budget slider
                    budgetGroup.style.display = 'none';

                    // Hide algorithm info cards
                    if (algorithmInfo) {
                        algorithmInfo.style.display = 'none';
                    }

                    // Hide example questions
                    if (exampleQuestionsContainer) {
                        exampleQuestionsContainer.style.display = 'none';
                    }

                    // Hide config description
                    if (configDescription) {
                        configDescription.style.display = 'none';
                    }

                    // Hide clear button
                    if (clearButton) {
                        clearButton.style.display = 'none';
                    }

                    // Hide frontier model group if visible
                    if (frontierModelGroup) {
                        frontierModelGroup.style.display = 'none';
                    }

                    // Set default budget
                    budgetSlider.value = 16;
                    document.getElementById('budgetValue').textContent = '16';

                    // Hide guided questions
                    if (guidedQuestions) {
                        guidedQuestions.classList.remove('visible');
                    }

                    // Show Run button (live API calls)
                    if (runButton) {
                        runButton.style.display = 'inline-flex';
                    }

                    // Show configuration section
                    if (configSection) {
                        configSection.style.display = 'block';
                    }

                    // Enable question textarea
                    if (questionTextarea) {
                        questionTextarea.placeholder = 'Enter your question here...';
                        questionTextarea.disabled = false;
                    }
                }
            }
        }

        // Show algorithm info
        function showAlgorithmInfo(algorithmKey) {
            const algo = ALGORITHM_DESCRIPTIONS[algorithmKey];
            const container = document.getElementById('algorithmInfo');

            const researchNote = algo.category === 'research'
                ? '<div style="margin-top:8px;padding:8px 12px;background:rgba(255,152,0,0.1);border-left:3px solid #ff9800;border-radius:4px;font-size:12px;color:#e65100;">Research algorithm â€” requires a local Process Reward Model (PRM) for optimal latency and cost. Results may vary without dedicated PRM hardware.</div>'
                : '';

            container.innerHTML = `
                <div class="algorithm-info">
                    <div class="algorithm-info-header">
                        <span class="algorithm-type-badge ${algo.type}">
                            ${algo.type === 'outcome' ? 'Outcome-Based' : 'Process-Based'}
                        </span>
                        ${algo.category === 'research' ? '<span class="algorithm-type-badge" style="background:#ff9800;">Research</span>' : ''}
                        <h3>${algo.name}</h3>
                    </div>
                    <p>${algo.description}</p>
                    <div class="use-case">${algo.useCase}</div>
                    ${researchNote}
                </div>
            `;
        }

        // Handle use case change
        function onUseCaseChange() {
            const selectedRadio = document.querySelector('input[name="useCase"]:checked');
            currentUseCase = selectedRadio.value;

            // Update UI based on use case
            updateUIForUseCase();

            // Clear results when switching use cases
            clearResults();
        }

        // Update UI elements based on selected use case
        function updateUIForUseCase() {
            const modelGroup = document.getElementById('modelGroup');
            const frontierModelGroup = document.getElementById('frontierModelGroup');
            const modelLabel = document.getElementById('modelLabel');
            const configDescription = document.getElementById('configDescription');
            const headerSubtitle = document.getElementById('headerSubtitle');
            const resultsContainer = document.getElementById('resultsContainer');
            const smallBaselinePane = document.getElementById('smallBaselinePane');
            const middlePaneIndicator = document.getElementById('middlePaneIndicator');
            const middlePaneTitle = document.getElementById('middlePaneTitle');
            const rightPaneIndicator = document.getElementById('rightPaneIndicator');
            const rightPaneTitle = document.getElementById('rightPaneTitle');

            if (currentUseCase === 'match_frontier') {
                // Use Case 2: 3-column layout - Small, Small+ITS, Frontier
                modelLabel.textContent = 'Small Model';
                frontierModelGroup.style.display = 'block';
                configDescription.textContent = 'Choose a small model to enhance with ITS and a frontier model to compare against';
                headerSubtitle.textContent = 'Demonstrate how ITS can make smaller models competitive with large frontier models';

                // Show 3-column layout
                resultsContainer.classList.add('three-column');
                smallBaselinePane.style.display = 'block';

                // Update pane titles and indicators for 3-column layout
                // Left: Small Model baseline (gray)
                // Middle: Small Model + ITS (blue)
                // Right: Frontier Model baseline (green)
                middlePaneIndicator.className = 'pane-indicator its';
                middlePaneTitle.textContent = 'Small Model + ITS';
                rightPaneIndicator.className = 'pane-indicator frontier';
                rightPaneTitle.textContent = 'Frontier Model';

                // Adjust grid to show both models
                document.getElementById('modelSelectionGrid').style.gridTemplateColumns = '1fr 1fr';

                // Reload all models (no filter)
                loadModels();
            } else if (currentUseCase === 'tool_consensus') {
                // Use Case 3: 2-column layout - Single Tool Call, Tool Voting
                modelLabel.textContent = 'Model';
                frontierModelGroup.style.display = 'none';
                configDescription.textContent = 'Compare single agent call vs ITS with tool voting for reliable tool selection';
                headerSubtitle.textContent = 'Demonstrate how ITS creates consensus on tool selection for reliable agent behavior';

                // Show 2-column layout
                resultsContainer.classList.remove('three-column');
                smallBaselinePane.style.display = 'none';

                // Update pane titles and indicators for 2-column layout
                // Middle: Single Call (gray)
                // Right: Tool Voting (blue)
                middlePaneIndicator.className = 'pane-indicator baseline';
                middlePaneTitle.textContent = 'Single Agent Call';
                rightPaneIndicator.className = 'pane-indicator its';
                rightPaneTitle.textContent = 'ITS + Tool Voting';

                // Reset grid
                document.getElementById('modelSelectionGrid').style.gridTemplateColumns = '';

                // Reload models to show only tool-compatible models
                loadModels('tool_consensus');
            } else {
                // Use Case 1: 2-column layout - Baseline, ITS
                modelLabel.textContent = 'Model';
                frontierModelGroup.style.display = 'none';
                configDescription.textContent = 'Choose your model, algorithm, and compute budget';
                headerSubtitle.textContent = 'Compare baseline inference with ITS algorithms side by side';

                // Show 2-column layout
                resultsContainer.classList.remove('three-column');
                smallBaselinePane.style.display = 'none';

                // Update pane titles and indicators for 2-column layout
                // Middle: Baseline (gray)
                // Right: ITS Result (blue)
                middlePaneIndicator.className = 'pane-indicator baseline';
                middlePaneTitle.textContent = 'Baseline';
                rightPaneIndicator.className = 'pane-indicator its';
                rightPaneTitle.textContent = 'ITS Result';

                // Reset grid
                document.getElementById('modelSelectionGrid').style.gridTemplateColumns = '';

                // Reload all models (no filter)
                loadModels();
            }
        }

        // OFFLINE SCENARIO FUNCTIONS

        // Populate scenario dropdown
        function populateScenarioDropdown() {
            const dropdown = document.getElementById('scenarioDropdown');
            dropdown.innerHTML = '';

            OFFLINE_SCENARIOS.forEach((scenario, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = `${index + 1}. ${scenario.title} (${scenario.algorithm})`;
                dropdown.appendChild(option);
            });

            dropdown.value = currentScenarioIndex;
        }

        // Navigate between scenarios
        function navigateScenario(direction) {
            const newIndex = currentScenarioIndex + direction;
            if (newIndex >= 0 && newIndex < OFFLINE_SCENARIOS.length) {
                currentScenarioIndex = newIndex;
                loadScenario(currentScenarioIndex);
            }
        }

        // Load and render a scenario
        function loadScenario(index) {
            currentScenarioIndex = index;
            const scenario = OFFLINE_SCENARIOS[index];

            // Update dropdown
            document.getElementById('scenarioDropdown').value = index;

            // Update navigation buttons
            document.getElementById('prevScenarioBtn').disabled = (index === 0);
            document.getElementById('nextScenarioBtn').disabled = (index === OFFLINE_SCENARIOS.length - 1);

            // Update scenario info display
            const scenarioInfo = document.getElementById('scenarioInfo');
            scenarioInfo.innerHTML = `
                <div>
                    <div style="margin-bottom: 8px;">
                        ${scenario.tags.map(tag => `<span class="scenario-tag">${tag}</span>`).join('')}
                    </div>
                    <div class="scenario-meta">
                        <div class="scenario-meta-item">
                            <strong>Algorithm:</strong> ${scenario.algorithm}
                        </div>
                        <div class="scenario-meta-item">
                            <strong>Budget:</strong> ${scenario.budget}
                        </div>
                        <div class="scenario-meta-item">
                            <strong>Model:</strong> ${scenario.model}
                        </div>
                    </div>
                </div>
            `;

            // Update question field (read-only in guided mode)
            document.getElementById('question').value = scenario.prompt;

            // Update algorithm dropdown to match scenario
            document.getElementById('algorithm').value = scenario.algorithm;
            selectedAlgorithm = scenario.algorithm;

            // Render the scenario results
            renderScenarioResults(scenario);
        }

        // Render scenario results in the result panes
        function renderScenarioResults(scenario) {
            // Show results container
            const resultsContainer = document.getElementById('resultsContainer');

            // Middle pane: Baseline (ITS off)
            const middlePaneContent = document.getElementById('middlePaneContent');
            middlePaneContent.innerHTML = renderResponse({
                response: scenario.baseline.response,
                latency_ms: scenario.baseline.latency_ms,
                input_tokens: scenario.baseline.input_tokens,
                output_tokens: scenario.baseline.output_tokens,
                cost_usd: scenario.baseline.cost_usd,
                model_size: scenario.baseline.model_size
            });

            // Show latency badge
            const middlePaneLatency = document.getElementById('middlePaneLatency');
            middlePaneLatency.textContent = `${scenario.baseline.latency_ms}ms`;
            middlePaneLatency.style.display = 'block';

            // Show cost badge if available
            if (scenario.baseline.cost_usd > 0) {
                const middlePaneCost = document.getElementById('middlePaneCost');
                const costFormatted = scenario.baseline.cost_usd < 0.0001
                    ? `$${scenario.baseline.cost_usd.toExponential(2)}`
                    : `$${scenario.baseline.cost_usd.toFixed(4)}`;
                middlePaneCost.textContent = costFormatted;
                middlePaneCost.style.display = 'block';
            }

            // Show actions
            document.getElementById('middlePaneActions').style.display = 'flex';

            // Right pane: ITS result
            const rightPaneContent = document.getElementById('rightPaneContent');
            rightPaneContent.innerHTML = renderResponse({
                response: scenario.its.response,
                latency_ms: scenario.its.latency_ms,
                input_tokens: scenario.its.input_tokens,
                output_tokens: scenario.its.output_tokens,
                cost_usd: scenario.its.cost_usd,
                model_size: scenario.its.model_size,
                trace: scenario.its.trace
            });

            // Add "Why ITS Helped" banner at the top of ITS result
            const whyItsHelpedBanner = `
                <div style="
                    background: var(--primary-light);
                    border-left: 4px solid var(--primary);
                    padding: 12px 16px;
                    margin-bottom: 16px;
                    border-radius: var(--radius-sm);
                ">
                    <div style="font-size: 11px; font-weight: 700; color: var(--primary); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 6px;">
                        ðŸ’¡ Why ITS Helped
                    </div>
                    <div style="font-size: 13px; color: var(--text-primary); line-height: 1.6;">
                        ${scenario.whyItsHelped}
                    </div>
                </div>
            `;
            rightPaneContent.innerHTML = whyItsHelpedBanner + rightPaneContent.innerHTML;

            // Show latency badge
            const rightPaneLatency = document.getElementById('rightPaneLatency');
            rightPaneLatency.textContent = `${scenario.its.latency_ms}ms`;
            rightPaneLatency.style.display = 'block';

            // Show cost badge if available
            if (scenario.its.cost_usd > 0) {
                const rightPaneCost = document.getElementById('rightPaneCost');
                const costFormatted = scenario.its.cost_usd < 0.0001
                    ? `$${scenario.its.cost_usd.toExponential(2)}`
                    : `$${scenario.its.cost_usd.toFixed(4)}`;
                rightPaneCost.textContent = costFormatted;
                rightPaneCost.style.display = 'block';

                // Add cost comparison badge
                const costMultiple = (scenario.its.cost_usd / scenario.baseline.cost_usd).toFixed(1);
                if (costMultiple > 1) {
                    rightPaneCost.classList.add('expensive');
                }
            }

            // Show actions
            document.getElementById('rightPaneActions').style.display = 'flex';

            // Hide performance visualization for now
            document.getElementById('performance-visualization-container').style.display = 'none';
        }

        // Helper function to render response HTML (simplified version)
        function renderResponse(data) {
            let html = '';

            // If response contains TODO, show placeholder
            if (data.response.includes('TODO')) {
                html = `
                    <div style="padding: 40px; text-align: center; color: var(--text-tertiary);">
                        <div style="font-size: 48px; margin-bottom: 16px; opacity: 0.3;">ðŸ“</div>
                        <div style="font-size: 14px; font-weight: 600; margin-bottom: 8px;">Scenario Not Yet Captured</div>
                        <div style="font-size: 13px;">This scenario will be populated with real run data in Phase B.</div>
                    </div>
                `;
                return html;
            }

            // Main response
            html += `<div class="chat-response">${formatAsHTML(data.response)}</div>`;

            // Performance details (expandable)
            html += `
                <div class="expandable-section" style="margin-top: 16px;">
                    <button class="expand-button" onclick="toggleSection(this)">
                        <svg class="expand-icon" width="16" height="16" viewBox="0 0 16 16" fill="none">
                            <path d="M4 6L8 10L12 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span>Performance Details</span>
                    </button>
                    <div class="expandable-content">
                        <div class="details-section">
                            <div class="detail-row">
                                <span class="detail-label">Latency</span>
                                <span class="detail-value">${data.latency_ms || 0}ms</span>
                            </div>
            `;

            if (data.input_tokens > 0) {
                html += `
                    <div class="detail-row">
                        <span class="detail-label">Input Tokens</span>
                        <span class="detail-value">${data.input_tokens.toLocaleString()}</span>
                    </div>
                `;
            }

            if (data.output_tokens > 0) {
                html += `
                    <div class="detail-row">
                        <span class="detail-label">Output Tokens</span>
                        <span class="detail-value">${data.output_tokens.toLocaleString()}</span>
                    </div>
                `;
            }

            if (data.cost_usd > 0) {
                const costFormatted = data.cost_usd < 0.0001
                    ? `$${data.cost_usd.toExponential(2)}`
                    : `$${data.cost_usd.toFixed(4)}`;
                html += `
                    <div class="detail-row">
                        <span class="detail-label">Cost</span>
                        <span class="detail-value">${costFormatted}</span>
                    </div>
                `;
            }

            html += `
                        </div>
                    </div>
                </div>
            `;

            // Add trace section if available
            if (data.trace && !data.trace.includes('TODO')) {
                html += `
                    <div class="expandable-section" style="margin-top: 12px;">
                        <button class="expand-button" onclick="toggleSection(this)">
                            <svg class="expand-icon" width="16" height="16" viewBox="0 0 16 16" fill="none">
                                <path d="M4 6L8 10L12 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            <span>Algorithm Trace</span>
                        </button>
                        <div class="expandable-content">
                            <div class="trace-section">
                                <div style="font-size: 13px; line-height: 1.6; color: var(--text-primary);">
                                    ${formatAsHTML(data.trace)}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            return html;
        }

        // Populate guided mode questions based on algorithm
        function populateGuidedQuestions() {
            const questionsGrid = document.getElementById('guidedQuestionsGrid');
            const questions = GUIDED_MODE_QUESTIONS[selectedAlgorithm] || [];

            questionsGrid.innerHTML = '';

            questions.forEach((question, index) => {
                const card = document.createElement('label');
                card.className = 'guided-question-card';
                card.innerHTML = `
                    <input type="radio" name="guidedQuestion" value="${index}">
                    <div class="guided-question-text">
                        <span class="guided-question-number">${index + 1}</span>
                        <span>${question}</span>
                    </div>
                `;

                card.addEventListener('click', () => {
                    // Remove selected class from all cards
                    document.querySelectorAll('.guided-question-card').forEach(c => {
                        c.classList.remove('selected');
                    });
                    // Add selected class to clicked card
                    card.classList.add('selected');
                    // Update textarea with selected question
                    document.getElementById('question').value = question;
                });

                questionsGrid.appendChild(card);
            });
        }

        // Handle algorithm change
        function onAlgorithmChange() {
            selectedAlgorithm = document.getElementById('algorithm').value;
            showAlgorithmInfo(selectedAlgorithm);
            loadExampleQuestions();

            // Update guided questions if in guided mode
            if (!isExpertMode) {
                populateGuidedQuestions();
                // Clear any previous selection
                document.getElementById('question').value = '';
                document.querySelectorAll('.guided-question-card').forEach(c => {
                    c.classList.remove('selected');
                });
            }
        }

        // Copy to clipboard
        async function copyToClipboard(type) {
            let element;
            if (type === 'smallBaseline') {
                element = document.getElementById('smallBaselineContent');
            } else if (type === 'middlePane') {
                element = document.getElementById('middlePaneContent');
            } else if (type === 'rightPane') {
                element = document.getElementById('rightPaneContent');
            }

            // Get plain text content (strips HTML tags)
            const content = element.textContent || element.innerText;

            try {
                await navigator.clipboard.writeText(content);
                // Visual feedback - find the button that triggered this
                const btn = document.querySelector(`#${type}Actions .action-btn`);
                if (!btn) return;
                const originalText = btn.textContent;
                btn.textContent = 'âœ“';
                btn.style.background = 'var(--success)';
                btn.style.color = 'white';
                btn.style.borderColor = 'var(--success)';
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.style.background = '';
                    btn.style.color = '';
                    btn.style.borderColor = '';
                }, 1500);
            } catch (err) {
                console.error('Failed to copy:', err);
                alert('Failed to copy to clipboard');
            }
        }

        // Clear results
        function clearResults() {
            // Clear small baseline pane
            document.getElementById('smallBaselineContent').innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">ðŸ’­</div>
                    <div>Run a comparison to see results</div>
                </div>
            `;
            document.getElementById('smallBaselineLatency').style.display = 'none';
            document.getElementById('smallBaselineActions').style.display = 'none';
            document.getElementById('smallBaselineSize').style.display = 'none';
            document.getElementById('smallBaselineCost').style.display = 'none';

            // Clear middle pane
            document.getElementById('middlePaneContent').innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">ðŸ’­</div>
                    <div>Run a comparison to see results</div>
                </div>
            `;
            document.getElementById('middlePaneLatency').style.display = 'none';
            document.getElementById('middlePaneActions').style.display = 'none';
            document.getElementById('middlePaneSize').style.display = 'none';
            document.getElementById('middlePaneCost').style.display = 'none';

            // Clear right pane
            document.getElementById('rightPaneContent').innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">ðŸš€</div>
                    <div>Run a comparison to see results</div>
                </div>
            `;
            document.getElementById('rightPaneLatency').style.display = 'none';
            document.getElementById('rightPaneActions').style.display = 'none';
            document.getElementById('rightPaneSize').style.display = 'none';
            document.getElementById('rightPaneCost').style.display = 'none';

            document.getElementById('expectedAnswerContainer').classList.remove('visible');

            // Hide performance visualization
            document.getElementById('performance-visualization-container').style.display = 'none';
        }

        // Update budget value and slider gradient
        document.getElementById('budget').addEventListener('input', (e) => {
            // In guided mode, prevent budget changes
            if (!isExpertMode) {
                e.target.value = 16;
                document.getElementById('budgetValue').textContent = '16';
                return;
            }

            const value = e.target.value;
            const max = e.target.max;
            const percentage = (value / max) * 100;

            document.getElementById('budgetValue').textContent = value;

            // Update gradient
            e.target.style.background = `linear-gradient(to right, var(--primary) 0%, var(--primary) ${percentage}%, var(--border-color) ${percentage}%, var(--border-color) 100%)`;
        });

        // Handle example question selection
        document.getElementById('exampleQuestions').addEventListener('change', (e) => {
            const selectedIndex = e.target.selectedIndex;
            if (selectedIndex > 0) {
                const selectedOption = e.target.options[selectedIndex];
                const question = selectedOption.dataset.question;
                const expectedAnswer = selectedOption.dataset.expected;

                if (question) {
                    document.getElementById('question').value = question;
                    currentExpectedAnswer = expectedAnswer;
                    clearResults();
                }
            } else {
                currentExpectedAnswer = null;
                document.getElementById('expectedAnswerContainer').classList.remove('visible');
            }
        });

        // Load models
        async function loadModels(useCase = null) {
            try {
                const url = useCase ? `${API_BASE_URL}/models?use_case=${useCase}` : `${API_BASE_URL}/models`;
                const response = await fetch(url);
                if (!response.ok) throw new Error('Failed to load models');

                const data = await response.json();

                // Filter models for tool_consensus to only show those supporting tools
                let models = data.models;
                if (useCase === 'tool_consensus') {
                    models = models.filter(m => m.supports_tools);
                }

                if (models.length === 0 && useCase === 'tool_consensus') {
                    const errorMsg = '<option value="">No models support tool calling - use OpenAI models</option>';
                    document.getElementById('model').innerHTML = errorMsg;
                    document.getElementById('frontierModel').innerHTML = errorMsg;
                    return;
                }

                const modelHTML = models.map(model => {
                    const sizeLabel = model.size ? ` [${model.size}]` : '';
                    return `<option value="${model.id}">${model.description}${sizeLabel}</option>`;
                }).join('');

                // Populate both model selects
                document.getElementById('model').innerHTML = modelHTML;
                document.getElementById('frontierModel').innerHTML = modelHTML;

                // Pre-select a good default for frontier model (e.g., gpt-4o if available)
                const frontierSelect = document.getElementById('frontierModel');
                const gpt4oOption = Array.from(frontierSelect.options).find(opt => opt.value === 'gpt-4o');
                if (gpt4oOption) {
                    frontierSelect.value = 'gpt-4o';
                }
            } catch (error) {
                console.error('Error loading models:', error);
                document.getElementById('model').innerHTML = '<option value="">Error loading models</option>';
                document.getElementById('frontierModel').innerHTML = '<option value="">Error loading models</option>';
            }
        }

        // Load example questions
        async function loadExampleQuestions() {
            const exampleSelect = document.getElementById('exampleQuestions');

            try {
                const url = `${API_BASE_URL}/examples?algorithm=${selectedAlgorithm}&use_case=${currentUseCase}`;
                const response = await fetch(url);
                if (!response.ok) throw new Error('Failed to load examples');

                const data = await response.json();

                const byDifficulty = { 'Easy': [], 'Medium': [], 'Hard': [] };
                data.examples.forEach(ex => byDifficulty[ex.difficulty].push(ex));

                let optionsHTML = '<option value="">Select an example...</option>';

                ['Easy', 'Medium', 'Hard'].forEach(difficulty => {
                    if (byDifficulty[difficulty].length > 0) {
                        optionsHTML += `<optgroup label="${difficulty} Questions">`;
                        byDifficulty[difficulty].forEach(ex => {
                            const label = `${ex.category}: ${ex.question.substring(0, 60)}${ex.question.length > 60 ? '...' : ''}`;
                            const questionAttr = ex.question.replace(/"/g, '&quot;');
                            const expectedAttr = ex.expected_answer.replace(/"/g, '&quot;');
                            optionsHTML += `<option value="${ex.question}" data-question="${questionAttr}" data-expected="${expectedAttr}" title="${ex.why}">${label}</option>`;
                        });
                        optionsHTML += '</optgroup>';
                    }
                });

                exampleSelect.innerHTML = optionsHTML;
            } catch (error) {
                console.error('Error loading examples:', error);
                exampleSelect.innerHTML = '<option value="">Error loading examples</option>';
            }
        }

        // Show error
        function showError(message) {
            const errorContainer = document.getElementById('errorContainer');
            errorContainer.innerHTML = `<div class="error-message">${message}</div>`;
            setTimeout(() => errorContainer.innerHTML = '', 5000);
        }

        // Show loading
        function showLoading() {
            const loadingHTML = `
                <div class="loading-skeleton">
                    <div class="skeleton-line"></div>
                    <div class="skeleton-line"></div>
                    <div class="skeleton-line"></div>
                    <div class="skeleton-line"></div>
                    <div class="skeleton-line"></div>
                    <div class="skeleton-line"></div>
                </div>
            `;

            // Show loading in all visible panes
            if (currentUseCase === 'match_frontier') {
                document.getElementById('smallBaselineContent').innerHTML = loadingHTML;
                document.getElementById('smallBaselineLatency').style.display = 'none';
                document.getElementById('smallBaselineActions').style.display = 'none';
                document.getElementById('smallBaselineCost').style.display = 'none';
            }

            document.getElementById('middlePaneContent').innerHTML = loadingHTML;
            document.getElementById('middlePaneLatency').style.display = 'none';
            document.getElementById('middlePaneActions').style.display = 'none';
            document.getElementById('middlePaneCost').style.display = 'none';

            document.getElementById('rightPaneContent').innerHTML = loadingHTML;
            document.getElementById('rightPaneLatency').style.display = 'none';
            document.getElementById('rightPaneActions').style.display = 'none';
            document.getElementById('rightPaneCost').style.display = 'none';
        }

        // Metrics moved to Performance Details within each result pane

        // Extract final answer from text
        function extractFinalAnswer(text) {
            // Try to find boxed answer (common in math problems)
            // Need to handle nested braces properly for things like \boxed{\frac{14}{3}}
            const boxedIndex = text.indexOf('\\boxed{');
            if (boxedIndex !== -1) {
                let braceCount = 0;
                let startIndex = boxedIndex + 7; // Start after '\boxed{'
                let endIndex = startIndex;

                for (let i = startIndex; i < text.length; i++) {
                    if (text[i] === '{') {
                        braceCount++;
                    } else if (text[i] === '}') {
                        if (braceCount === 0) {
                            endIndex = i;
                            break;
                        }
                        braceCount--;
                    }
                }

                if (endIndex > startIndex) {
                    return text.substring(startIndex, endIndex);
                }
            }

            // Try to find explicit "Final Answer:" patterns
            const finalAnswerPatterns = [
                /Final Answer:\s*(.+?)(?:\n\n|$)/is,
                /Answer:\s*(.+?)(?:\n\n|$)/is,
                /Therefore,?\s+the\s+(?:answer|value|result)\s+(?:is|equals?)\s+(.+?)(?:\.|$)/is,
                /Therefore,?\s+(.+?)(?:\n\n|$)/is,
                /Thus,?\s+(.+?)(?:\n\n|$)/is,
                /So,?\s+(.+?)(?:\n\n|$)/is,
                /In conclusion,?\s+(.+?)(?:\n\n|$)/is
            ];

            for (const pattern of finalAnswerPatterns) {
                const match = text.match(pattern);
                if (match) {
                    let answer = match[1].trim();

                    // Extract just the math expression if it's in the format "is $...$"
                    const mathMatch = answer.match(/\$([^$]+)\$/);
                    if (mathMatch) {
                        answer = mathMatch[1];
                    }

                    // Only use if it's reasonably short (not a whole paragraph)
                    if (answer.length < 200) {
                        return answer;
                    }
                }
            }

            // Look for standalone answer at the end
            const lines = text.trim().split('\n');
            const lastLine = lines[lines.length - 1].trim();

            // If last line is short and looks like an answer
            if (lastLine.length < 150 && (
                /^[A-Z]:|^[-+]?\d+/.test(lastLine) ||
                /\$.*\$/.test(lastLine) ||
                /^x\s*=|^y\s*=/i.test(lastLine) ||
                /=.*\d/.test(lastLine)
            )) {
                return lastLine;
            }

            return null;
        }

        // Format and render answer text
        function formatAnswer(text) {
            if (!text || !text.trim()) return '';

            // Extract final answer
            const finalAnswer = extractFinalAnswer(text);

            // Remove final answer from main text if present
            let mainText = text;
            if (finalAnswer) {
                // Remove boxed answer notation
                mainText = text.replace(/\\boxed\{[^}]+\}/, '').trim();

                // Remove common "Final Answer:" patterns
                mainText = mainText.replace(/(?:Final Answer|Answer|Therefore|Thus|So|In conclusion)[:\s]+[^\n]+/gi, '').trim();

                // If the final answer is the last line, remove it from main text to avoid duplication
                const lines = mainText.trim().split('\n');
                const lastLine = lines[lines.length - 1].trim();
                if (lastLine === finalAnswer || lastLine.includes(finalAnswer)) {
                    lines.pop();
                    mainText = lines.join('\n').trim();
                }

                // If the entire text is just the final answer (no reasoning), clear mainText
                if (mainText === finalAnswer || mainText.trim() === finalAnswer.trim()) {
                    mainText = '';
                }
            }

            let html = '';

            // Add final answer section at the top
            if (finalAnswer) {
                // Check if the answer contains LaTeX
                const hasLatex = finalAnswer.includes('$') || /[\\{}_^]/.test(finalAnswer);
                const displayAnswer = hasLatex
                    ? finalAnswer
                    : (finalAnswer.includes('=') || /^[-+]?\d/.test(finalAnswer))
                        ? '$' + finalAnswer + '$'
                        : finalAnswer;

                html += `
                    <div class="final-answer-section">
                        <div class="final-answer-label">
                            <span>âœ“</span>
                            <span>Final Answer</span>
                        </div>
                        <div class="final-answer-content">${displayAnswer}</div>
                    </div>
                `;
            }

            // Add reasoning section - show full text if no answer extracted
            const contentToShow = mainText && mainText.trim() ? mainText : text;
            if (contentToShow && contentToShow.trim()) {
                const sectionTitle = finalAnswer ? 'Reasoning Steps' : 'Response';
                const sectionIcon = finalAnswer ? 'ðŸ“' : 'ðŸ’¬';

                // Check if content is very short (just one paragraph)
                const isShort = contentToShow.length < 300 && !contentToShow.includes('\n\n');

                if (isShort && !finalAnswer) {
                    // For short responses without final answer, just show directly
                    html += `<div>${formatReasoningSteps(contentToShow)}</div>`;
                } else {
                    // Show in collapsible section
                    html += `
                        <div class="reasoning-section">
                            <div class="reasoning-header" onclick="toggleReasoning(event)">
                                <div class="reasoning-title">
                                    <span>${sectionIcon}</span>
                                    <span>${sectionTitle}</span>
                                </div>
                                <div class="reasoning-toggle">â–¼</div>
                            </div>
                            <div class="reasoning-content">
                                ${formatReasoningSteps(contentToShow)}
                            </div>
                        </div>
                    `;
                }
            }

            return html || '<p>No answer provided</p>';
        }

        // Format the reasoning steps
        function formatReasoningSteps(text) {
            // Split into paragraphs
            let paragraphs = text.split(/\n\n+/);

            // If no double line breaks, try single line breaks for numbered lists
            if (paragraphs.length === 1 && /\n\d+\./.test(text)) {
                paragraphs = text.split(/\n(?=\d+\.)/);
            }

            // Check if this looks like step-by-step
            const hasSteps = paragraphs.some(p =>
                /^(\d+\.|Step \d+:?|\*\*Step \d+|#+ Step|\d+\))/i.test(p.trim())
            );

            let html = '';

            if (hasSteps) {
                // Format as steps with visual markers
                let stepNum = 1;
                paragraphs.forEach(para => {
                    const trimmed = para.trim();
                    if (trimmed) {
                        html += `<div class="answer-step">`;

                        // Extract step number if present, otherwise use counter
                        const stepMatch = trimmed.match(/^(\d+)[\.\)]/);
                        const currentStepNum = stepMatch ? stepMatch[1] : stepNum;

                        // Add step marker
                        html += `<span class="step-marker">${currentStepNum}</span>`;

                        // Remove step prefix from text if present
                        let stepText = trimmed.replace(/^(\d+[\.\)]|Step \d+:?|\*\*Step \d+\*\*:?|#+ Step \d+:?)\s*/i, '');

                        html += `<span>${formatParagraph(stepText)}</span>`;
                        html += `</div>`;

                        stepNum++;
                    }
                });
            } else {
                // Format as regular paragraphs
                paragraphs.forEach(para => {
                    const trimmed = para.trim();
                    if (trimmed) {
                        html += `<p>${formatParagraph(trimmed)}</p>`;
                    }
                });
            }

            return html;
        }

        // Format expected answer (simpler version)
        function formatExpectedAnswer(text) {
            if (!text || !text.trim()) return '';

            // Check if it looks like it has LaTeX
            const hasLatex = text.includes('$') || /\\[a-z]+\{/.test(text);

            // If it has clear paragraphs, format them
            if (text.includes('\n\n')) {
                const paragraphs = text.split(/\n\n+/);
                return paragraphs.map(p => `<p>${formatParagraph(p.trim())}</p>`).join('');
            }

            // Otherwise just format as a single paragraph
            return `<p>${formatParagraph(text.trim())}</p>`;
        }

        // Toggle reasoning section
        function toggleReasoning(event) {
            const header = event.currentTarget;
            const content = header.nextElementSibling;
            const toggle = header.querySelector('.reasoning-toggle');

            content.classList.toggle('collapsed');
            toggle.classList.toggle('collapsed');
        }

        function formatParagraph(text) {
            // Convert **bold** to <strong>
            text = text.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');

            // Convert *italic* to <em> (but not if it's part of math expression)
            text = text.replace(/\*([^*$]+?)\*/g, '<em>$1</em>');

            // Convert ### headers to styled headers (if present)
            text = text.replace(/^###\s+(.+)$/gm, '<strong style="font-size: 1.1em; display: block; margin: 8px 0;">$1</strong>');
            text = text.replace(/^##\s+(.+)$/gm, '<strong style="font-size: 1.2em; display: block; margin: 10px 0;">$1</strong>');

            // Preserve line breaks within paragraph
            text = text.replace(/\n/g, '<br>');

            return text;
        }

        function renderMath(element) {
            if (typeof renderMathInElement !== 'undefined') {
                renderMathInElement(element, {
                    delimiters: [
                        {left: '$$', right: '$$', display: true},
                        {left: '$', right: '$', display: false},
                        {left: '\\[', right: '\\]', display: true},
                        {left: '\\(', right: '\\)', display: false}
                    ],
                    throwOnError: false,
                    errorColor: '#cc0000',
                    trust: true
                });
            }
        }

        // Helper to set size badge
        function setSizeBadge(elementId, size) {
            const badge = document.getElementById(elementId);
            if (size) {
                badge.textContent = size;
                badge.className = 'size-badge ' + size.toLowerCase();
                badge.style.display = 'inline-block';
            } else {
                badge.style.display = 'none';
            }
        }

        // Helper to set cost badge
        function setCostBadge(elementId, cost_usd, threshold = 0.01) {
            const badge = document.getElementById(elementId);
            if (cost_usd !== null && cost_usd !== undefined && cost_usd > 0) {
                // Format cost
                let costText;
                if (cost_usd < 0.01) {
                    costText = '<$0.01';
                } else if (cost_usd < 1) {
                    costText = '$' + cost_usd.toFixed(3);
                } else {
                    costText = '$' + cost_usd.toFixed(2);
                }

                badge.textContent = costText;
                // Mark as expensive if above threshold
                badge.className = cost_usd > threshold ? 'cost-badge expensive' : 'cost-badge';
                badge.style.display = 'inline-block';
            } else {
                badge.style.display = 'none';
            }
        }

        // Display results
        function toggleSection(button) {
            const section = button.parentElement;
            section.classList.toggle('expanded');
        }

        // Extract the concluding answer from a model response.
        // Returns the last meaningful paragraph(s) that contain the answer,
        // stripping away the step-by-step reasoning.
        function extractConclusion(text) {
            if (!text || !text.trim()) return text;

            // Split into paragraphs
            const paragraphs = text.trim().split(/\n\n+/).map(p => p.trim()).filter(p => p);

            // If 3 or fewer paragraphs, it's already short â€” show it all
            if (paragraphs.length <= 3) return text;

            // Look for concluding paragraphs from the end
            // These typically start with conclusion-like phrases or contain "answer is"
            const conclusionPatterns = [
                /^(therefore|thus|so,|hence|in conclusion|the answer|the sum|the value|the result|the remainder|the probability|the largest|the number|there are|this gives|we get|we find|we have|finally)/i,
                /answer is/i,
                /=\s*\$?[\d\\]/,
                /\\boxed/,
            ];

            // Walk backwards to find where the conclusion starts
            let conclusionStart = paragraphs.length - 1;
            for (let i = paragraphs.length - 1; i >= Math.max(0, paragraphs.length - 3); i--) {
                const p = paragraphs[i];
                const isConclusion = conclusionPatterns.some(pat => pat.test(p));
                if (isConclusion) {
                    conclusionStart = i;
                }
            }

            // Take from the conclusion start to the end
            const conclusion = paragraphs.slice(conclusionStart).join('\n\n');
            return conclusion;
        }

        // Format text as HTML paragraphs
        function formatAsHTML(text) {
            if (!text || !text.trim()) return '<p>No response</p>';

            let html = text;

            // Escape HTML but preserve $ for KaTeX
            html = html.replace(/&/g, '&amp;')
                       .replace(/</g, '&lt;')
                       .replace(/>/g, '&gt;');

            // Bold: **text**
            html = html.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');

            // Split into paragraphs on double newlines
            const paragraphs = html.split(/\n\n+/);
            html = paragraphs.map(p => {
                p = p.trim();
                if (!p) return '';
                p = p.replace(/\n/g, '<br>');
                return `<p>${p}</p>`;
            }).filter(p => p).join('');

            return html;
        }

        // --- Algorithm Trace Rendering ---

        function toggleCandidateContent(btn) {
            const content = btn.previousElementSibling;
            content.classList.toggle('expanded-candidate');
            btn.textContent = content.classList.contains('expanded-candidate') ? 'Show less' : 'Show more';
        }

        function renderCandidateCard(candidate, metricHtml) {
            const winnerClass = candidate.is_selected ? ' winner' : '';
            const winnerBadge = candidate.is_selected ? '<span class="winner-badge">Winner</span>' : '';
            return `
                <div class="candidate-card${winnerClass}">
                    <div class="candidate-header">
                        <span class="candidate-label">Candidate ${candidate.index + 1}</span>
                        ${winnerBadge}
                    </div>
                    <div class="candidate-content">${candidate.content.replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\n/g, '<br>')}</div>
                    <button class="candidate-expand-btn" onclick="toggleCandidateContent(this)">Show more</button>
                    ${metricHtml}
                </div>
            `;
        }

        function renderSelfConsistencyTrace(trace) {
            const totalVotes = trace.total_votes || trace.candidates.length;
            let html = '<div class="voting-arena">';

            // Header
            html += `
                <div class="voting-arena-header">
                    <span class="arena-icon">&#9745;</span>
                    <span>Majority Vote &mdash; ${trace.candidates.length} candidates, ${totalVotes} votes</span>
                </div>
            `;

            // Tool voting section if present
            if (trace.tool_voting) {
                const tv = trace.tool_voting;
                html += `
                    <div class="tool-voting-section" style="margin: 0 0 8px 0; padding: 12px 16px; background: var(--primary-light); border-radius: var(--radius); border-left: 4px solid var(--primary);">
                        <div style="font-weight: 600; color: var(--primary); margin-bottom: 6px; font-size: 13px;">
                            Tool Voting Consensus
                        </div>
                        <div style="font-size: 12px; margin-bottom: 10px; color: var(--text-secondary);">
                            Type: <strong>${tv.tool_vote_type}</strong> | Calls: <strong>${tv.total_tool_calls}</strong>
                        </div>
                        <div class="vote-chart">
                `;

                const sortedTools = Object.entries(tv.tool_counts).sort((a, b) => b[1] - a[1]);
                const maxToolVotes = sortedTools.length > 0 ? sortedTools[0][1] : 1;

                sortedTools.forEach(([tool, count], i) => {
                    const pct = (count / maxToolVotes) * 100;
                    const isWinner = tool === tv.winning_tool;
                    const displayTool = tool.length > 30 ? tool.substring(0, 30) + '...' : tool;
                    html += `
                        <div class="vote-chart-row ${isWinner ? 'is-winner' : ''}">
                            <span class="vote-chart-rank">${i + 1}</span>
                            <span class="vote-chart-answer" title="${tool.replace(/"/g, '&quot;')}">${displayTool}</span>
                            <div class="vote-chart-bar-wrap">
                                <div class="vote-chart-bar" style="width: ${pct}%; ${!isWinner ? 'background: var(--primary);' : ''}"></div>
                            </div>
                            <span class="vote-chart-count">${count}${isWinner ? ' <span class="vote-chart-winner-badge">WINNER</span>' : ''}</span>
                        </div>
                    `;
                });

                html += `
                        </div>
                    </div>
                `;
            }

            // Vote distribution bar chart â€” the main visualization
            const sortedVotes = Object.entries(trace.vote_counts).sort((a, b) => b[1] - a[1]);
            const maxVotes = sortedVotes.length > 0 ? sortedVotes[0][1] : 1;
            const winningAnswer = sortedVotes.length > 0 ? sortedVotes[0][0] : '';

            html += '<div class="vote-chart">';
            sortedVotes.forEach(([answer, count], i) => {
                const pct = (count / maxVotes) * 100;
                const isWinner = answer === winningAnswer;
                const displayAnswer = answer.length > 40 ? answer.substring(0, 40) + '...' : answer;
                html += `
                    <div class="vote-chart-row ${isWinner ? 'is-winner' : ''}">
                        <span class="vote-chart-rank">${i + 1}</span>
                        <span class="vote-chart-answer" title="${answer.replace(/"/g, '&quot;')}">${displayAnswer}</span>
                        <div class="vote-chart-bar-wrap">
                            <div class="vote-chart-bar" style="width: ${pct}%"></div>
                        </div>
                        <span class="vote-chart-count">
                            ${count} vote${count !== 1 ? 's' : ''}${isWinner ? ' <span class="vote-chart-winner-badge">WINNER</span>' : ''}
                        </span>
                    </div>
                `;
            });
            html += '</div>';

            // Candidate chips grouped by answer
            html += '<div class="candidate-chips">';
            for (const candidate of trace.candidates) {
                const preview = candidate.content ? candidate.content.substring(0, 50).replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\n/g, ' ') : '';
                const isWinner = candidate.is_selected;
                html += `
                    <span class="candidate-chip ${isWinner ? 'is-winner' : ''}" title="${candidate.content ? candidate.content.substring(0, 200).replace(/"/g, '&quot;').replace(/\n/g, ' ') : ''}">
                        <span class="chip-index">#${candidate.index + 1}</span>
                        ${isWinner ? '&#10003; ' : ''}${preview}${candidate.content && candidate.content.length > 50 ? '...' : ''}
                    </span>
                `;
            }
            html += '</div>';

            // Expandable full candidate details
            const traceId = 'sc_candidates_' + Date.now();
            html += `
                <div class="trace-candidates-detail">
                    <button class="trace-candidates-toggle" onclick="document.getElementById('${traceId}').classList.toggle('expanded'); this.textContent = document.getElementById('${traceId}').classList.contains('expanded') ? 'Hide full responses' : 'Show full responses'">Show full responses</button>
                    <div id="${traceId}" class="trace-candidates-list">
            `;
            for (const candidate of trace.candidates) {
                html += renderCandidateCard(candidate, '');
            }
            html += '</div></div>';

            html += '</div>'; // close .voting-arena
            return html;
        }

        function renderBestOfNTrace(trace) {
            // Sort candidates by score descending
            const sorted = trace.candidates.map((c, i) => ({ ...c, score: trace.scores[i] }))
                .sort((a, b) => b.score - a.score);

            const range = trace.max_score - trace.min_score || 1;
            let html = '<div class="score-leaderboard">';

            // Header
            html += `
                <div class="score-leaderboard-header">
                    <span>&#9733;</span>
                    <span>Score Leaderboard &mdash; ${trace.candidates.length} candidates scored by LLM judge</span>
                </div>
            `;

            sorted.forEach((candidate, i) => {
                const pct = ((candidate.score - trace.min_score) / range) * 100;
                const isWinner = i === 0;
                const preview = candidate.content
                    ? candidate.content.substring(0, 60).replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\n/g, ' ')
                    : '';
                const hasMore = candidate.content && candidate.content.length > 60;

                // Color gradient: red (low) to green (high) based on percentage
                const r = Math.round(220 - (pct / 100) * 140);
                const g = Math.round(80 + (pct / 100) * 100);
                const b = Math.round(80 + (pct / 100) * 20);
                const barColor = isWinner ? 'var(--warning)' : `rgb(${r}, ${g}, ${b})`;

                const fullTextId = 'bon_full_' + (candidate.index || i) + '_' + Date.now();

                html += `
                    <div class="leaderboard-row ${isWinner ? 'is-winner' : ''}">
                        <span class="leaderboard-rank">${isWinner ? '&#9733;' : i + 1}</span>
                        <div class="leaderboard-content">
                            <div class="leaderboard-preview">
                                ${isWinner ? '<span class="leaderboard-winner-tag">BEST</span> ' : ''}${preview}${hasMore ? '...' : ''}
                                ${hasMore ? `<button class="leaderboard-expand-btn" onclick="document.getElementById('${fullTextId}').classList.toggle('expanded'); this.textContent = document.getElementById('${fullTextId}').classList.contains('expanded') ? 'Show less' : 'Show full'">Show full</button>` : ''}
                            </div>
                            <div class="leaderboard-bar-wrap">
                                <div class="leaderboard-bar" style="width: ${pct}%; background: ${barColor}"></div>
                            </div>
                            ${hasMore ? `<div id="${fullTextId}" class="leaderboard-full-text">${candidate.content.replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\n/g, '<br>')}</div>` : ''}
                        </div>
                        <span class="leaderboard-score" style="color: ${barColor}">${candidate.score.toFixed(2)}</span>
                    </div>
                `;

                // Separator after winner
                if (isWinner && sorted.length > 1) {
                    html += '<div class="leaderboard-separator"></div>';
                }
            });

            html += '</div>';
            return html;
        }

        function renderBeamSearchTrace(trace) {
            let html = '<div class="trace-summary">Beam Search: explored ' + trace.candidates.length + ' beams with PRM scoring</div>';

            // Sort by score descending
            const sorted = trace.candidates.map((c, i) => ({ ...c, score: trace.scores[i], steps: trace.steps_used[i] }))
                .sort((a, b) => b.score - a.score);

            const maxScore = Math.max(...trace.scores);
            const minScore = Math.min(...trace.scores);
            const range = maxScore - minScore || 1;

            for (const candidate of sorted) {
                const pct = ((candidate.score - minScore) / range) * 100;
                const metricHtml = `
                    <div class="candidate-metric">
                        <span class="metric-label">PRM</span>
                        <div class="metric-bar-container">
                            <div class="metric-bar score-bar" style="width: ${pct}%"></div>
                        </div>
                        <span class="metric-value">${candidate.score.toFixed(3)}</span>
                    </div>
                    <div class="candidate-metric">
                        <span class="metric-label">Steps</span>
                        <span class="metric-value">${candidate.steps}</span>
                    </div>
                `;
                html += renderCandidateCard(candidate, metricHtml);
            }
            return html;
        }

        function renderParticleFilteringTrace(trace, containerId) {
            let html = '<div class="trace-summary">Particle Filtering: maintained ' + trace.candidates.length + ' particles with importance weighting</div>';

            // Sort by normalized weight descending
            const sorted = trace.candidates.map((c, i) => ({
                ...c,
                logWeight: trace.log_weights[i],
                normWeight: trace.normalized_weights[i],
                steps: trace.steps_used[i],
            })).sort((a, b) => b.normWeight - a.normWeight);

            const maxWeight = Math.max(...trace.normalized_weights);

            for (const candidate of sorted) {
                const pct = maxWeight > 0 ? (candidate.normWeight / maxWeight) * 100 : 0;
                const metricHtml = `
                    <div class="candidate-metric">
                        <span class="metric-label">Weight</span>
                        <div class="metric-bar-container">
                            <div class="metric-bar weight-bar" style="width: ${pct}%"></div>
                        </div>
                        <span class="metric-value">${(candidate.normWeight * 100).toFixed(1)}%</span>
                    </div>
                    <div class="candidate-metric">
                        <span class="metric-label">Steps</span>
                        <span class="metric-value">${candidate.steps}</span>
                    </div>
                `;
                html += renderCandidateCard(candidate, metricHtml);
            }
            return html;
        }

        function switchIteration(tabBtn, iterIdx, containerId) {
            // Update tab active state
            const tabContainer = tabBtn.parentElement;
            tabContainer.querySelectorAll('.iteration-tab').forEach(t => t.classList.remove('active'));
            tabBtn.classList.add('active');

            // Show/hide iteration content
            const parent = tabContainer.parentElement;
            parent.querySelectorAll('.iteration-content').forEach(c => c.classList.remove('active'));
            const target = parent.querySelector('[data-iteration="' + iterIdx + '"]');
            if (target) target.classList.add('active');
        }

        function renderParticleGibbsTrace(trace, containerId) {
            let html = '<div class="trace-summary">Particle Gibbs: ' + trace.num_iterations + ' iterations of particle filtering with reference particle</div>';

            // Iteration tabs
            html += '<div class="iteration-tabs">';
            for (let i = 0; i < trace.num_iterations; i++) {
                const activeClass = i === trace.num_iterations - 1 ? ' active' : '';
                html += `<button class="iteration-tab${activeClass}" onclick="switchIteration(this, ${i}, '${containerId}')">Iteration ${i + 1}</button>`;
            }
            html += '</div>';

            // Iteration content
            for (let i = 0; i < trace.num_iterations; i++) {
                const activeClass = i === trace.num_iterations - 1 ? ' active' : '';
                html += `<div class="iteration-content${activeClass}" data-iteration="${i}">`;
                html += renderParticleFilteringTrace(trace.iterations[i], containerId + '_iter' + i);
                html += '</div>';
            }

            return html;
        }

        function renderToolCalls(toolCalls) {
            if (!toolCalls || toolCalls.length === 0) return '';

            let html = `
                <div class="expandable-section">
                    <button class="expand-button" onclick="toggleSection(this)">
                        <svg class="expand-icon" width="16" height="16" viewBox="0 0 16 16" fill="none">
                            <path d="M4 6L8 10L12 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span>Tool Calls (${toolCalls.length})</span>
                    </button>
                    <div class="expandable-content">
                        <div class="trace-section">
            `;

            toolCalls.forEach((tc, idx) => {
                const args = JSON.stringify(tc.arguments, null, 2);
                html += `
                    <div class="tool-call-item" style="margin-bottom: 12px; padding: 12px; background: var(--bg-tertiary); border-radius: 4px;">
                        <div style="font-weight: 600; color: var(--primary); margin-bottom: 8px;">
                            ðŸ”§ ${tc.name}
                        </div>
                        <div style="font-size: 0.9em; color: var(--text-secondary); margin-bottom: 8px;">
                            <strong>Arguments:</strong>
                            <pre style="margin: 4px 0; padding: 8px; background: var(--bg-primary); border-radius: 4px; overflow-x: auto;">${args}</pre>
                        </div>
                        ${tc.result ? `
                        <div style="font-size: 0.9em; color: var(--text-secondary);">
                            <strong>Result:</strong>
                            <pre style="margin: 4px 0; padding: 8px; background: var(--bg-primary); border-radius: 4px; overflow-x: auto;">${tc.result}</pre>
                        </div>
                        ` : ''}
                    </div>
                `;
            });

            html += `
                        </div>
                    </div>
                </div>
            `;

            return html;
        }

        function renderAlgorithmTrace(trace, directDisplay = false) {
            if (!trace || !trace.algorithm) return '';

            let traceHtml = '';
            switch (trace.algorithm) {
                case 'self_consistency':
                    traceHtml = renderSelfConsistencyTrace(trace);
                    break;
                case 'best_of_n':
                    traceHtml = renderBestOfNTrace(trace);
                    break;
                case 'beam_search':
                    traceHtml = renderBeamSearchTrace(trace);
                    break;
                case 'entropic_particle_filtering':
                case 'particle_filtering':
                    traceHtml = renderParticleFilteringTrace(trace, 'pf_trace');
                    break;
                case 'particle_gibbs':
                    traceHtml = renderParticleGibbsTrace(trace, 'pg_trace');
                    break;
                default:
                    return '';
            }

            if (directDisplay) {
                return `
                    <div class="trace-direct-display">
                        ${traceHtml}
                    </div>
                `;
            }

            return `
                <div class="expandable-section">
                    <button class="expand-button" onclick="toggleSection(this)">
                        <svg class="expand-icon" width="16" height="16" viewBox="0 0 16 16" fill="none">
                            <path d="M4 6L8 10L12 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span>Algorithm Trace (${trace.candidates ? trace.candidates.length + ' candidates' : trace.num_iterations + ' iterations'})</span>
                    </button>
                    <div class="expandable-content">
                        <div class="trace-section">
                            ${traceHtml}
                        </div>
                    </div>
                </div>
            `;
        }

        function renderAnswerBox(containerId, data, comparisonData = null) {
            const container = document.getElementById(containerId);

            // The full response from the model
            const fullResponse = data.answer;

            // Extract just the concluding answer for the main display
            const conclusion = extractConclusion(fullResponse);

            let html = '';

            // Main response area â€” show just the conclusion/answer
            html += `<div class="chat-response">${formatAsHTML(conclusion)}</div>`;

            // Expandable section with full detailed reasoning
            html += `
                <div class="expandable-section">
                    <button class="expand-button" onclick="toggleSection(this)">
                        <svg class="expand-icon" width="16" height="16" viewBox="0 0 16 16" fill="none">
                            <path d="M4 6L8 10L12 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span>View Detailed Response</span>
                    </button>
                    <div class="expandable-content">
                        <div class="reasoning-section">
                            <div class="reasoning-content">
                                ${formatReasoningSteps(fullResponse)}
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // Add expandable performance details section
            html += `
                <div class="expandable-section">
                    <button class="expand-button" onclick="toggleSection(this)">
                        <svg class="expand-icon" width="16" height="16" viewBox="0 0 16 16" fill="none">
                            <path d="M4 6L8 10L12 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span>Performance Details</span>
                    </button>
                    <div class="expandable-content">
                        <div class="details-section">
                            <div class="detail-row">
                                <span class="detail-label">Latency</span>
                                <span class="detail-value">${data.latency_ms}ms</span>
                            </div>
            `;

            if (data.model_size) {
                html += `
                    <div class="detail-row">
                        <span class="detail-label">Model Size</span>
                        <span class="detail-value">${data.model_size}</span>
                    </div>
                `;
            }

            if (data.input_tokens) {
                html += `
                    <div class="detail-row">
                        <span class="detail-label">Input Tokens</span>
                        <span class="detail-value">${data.input_tokens.toLocaleString()}</span>
                    </div>
                `;
            }

            if (data.output_tokens) {
                html += `
                    <div class="detail-row">
                        <span class="detail-label">Output Tokens</span>
                        <span class="detail-value">${data.output_tokens.toLocaleString()}</span>
                    </div>
                `;
            }

            if (data.cost_usd !== null && data.cost_usd !== undefined) {
                const costFormatted = data.cost_usd < 0.0001
                    ? `$${data.cost_usd.toExponential(2)}`
                    : `$${data.cost_usd.toFixed(4)}`;
                html += `
                    <div class="detail-row">
                        <span class="detail-label">Cost</span>
                        <span class="detail-value">${costFormatted}</span>
                    </div>
                `;
            }

            // Add comparison data if provided
            if (comparisonData) {
                html += `
                    <div class="detail-row">
                        <span class="detail-label">${comparisonData.label}</span>
                        <span class="detail-value">${comparisonData.value}</span>
                    </div>
                `;
            }

            html += `
                        </div>
                    </div>
                </div>
            `;

            // Add tool calls section if present
            if (data.tool_calls && data.tool_calls.length > 0) {
                html += renderToolCalls(data.tool_calls);
            }

            // Add algorithm trace section (only for ITS results that have trace data)
            if (data.trace) {
                html += renderAlgorithmTrace(data.trace);
            }

            container.innerHTML = html;
            container.classList.add('fade-in');

            // Render math in the final answer and reasoning
            renderMath(container);

            // Hide the old badges and latency display
            const paneId = containerId.replace('Content', '');
            const latencyEl = document.getElementById(paneId + 'Latency');
            const actionsEl = document.getElementById(paneId + 'Actions');
            if (latencyEl) latencyEl.style.display = 'none';
            if (actionsEl) actionsEl.style.display = 'none';

            setTimeout(() => {
                container.classList.remove('fade-in');
            }, 300);
        }

        function displayResults(data) {
            lastResults = data;

            if (currentUseCase === 'match_frontier' && data.small_baseline) {
                // 3-column layout: Small baseline, Small+ITS, Frontier
                const smallMs = data.small_baseline.latency_ms;
                const itsMs = data.its.latency_ms;
                const frontierMs = data.baseline.latency_ms;

                renderAnswerBox('smallBaselineContent', data.small_baseline);
                renderAnswerBox('middlePaneContent', data.its, {
                    label: 'vs Small Model',
                    value: `${itsMs - smallMs > 0 ? '+' : ''}${(itsMs - smallMs).toFixed(0)}ms`
                });
                renderAnswerBox('rightPaneContent', data.baseline, {
                    label: 'vs ITS Result',
                    value: `${frontierMs - itsMs > 0 ? '+' : ''}${(frontierMs - itsMs).toFixed(0)}ms`
                });
            } else {
                // 2-column layout: Baseline, ITS
                const baselineMs = data.baseline.latency_ms;
                const itsMs = data.its.latency_ms;

                renderAnswerBox('middlePaneContent', data.baseline);
                renderAnswerBox('rightPaneContent', data.its, {
                    label: 'vs Baseline',
                    value: `${itsMs - baselineMs > 0 ? '+' : ''}${(itsMs - baselineMs).toFixed(0)}ms`
                });
            }

            // Expected answer - show simply without the complex formatting
            if (currentExpectedAnswer) {
                const expectedContent = document.getElementById('expectedAnswerContent');
                expectedContent.innerHTML = formatExpectedAnswer(currentExpectedAnswer);
                renderMath(expectedContent);
                document.getElementById('expectedAnswerContainer').classList.add('visible');
            }

            // Render enhanced performance visualization
            renderPerformanceVisualization(data);
        }

        // Render enhanced performance visualization
        function renderPerformanceVisualization(data) {
            console.log('ðŸŽ¨ renderPerformanceVisualization called with data:', data);

            const container = document.getElementById('performance-visualization-container');

            if (!container) {
                console.error('âŒ Container element not found!');
                return;
            }

            // Show the container
            container.style.display = 'block';
            console.log('âœ… Container display set to block');

            // Initialize and render the visualization with V2
            if (typeof PerformanceVizV2 !== 'undefined') {
                try {
                    const perfViz = new PerformanceVizV2('performance-visualization');
                    perfViz.render(data);
                    console.log('âœ… Performance visualization V2 rendered successfully!');

                    // Scroll to visualization
                    setTimeout(() => {
                        container.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }, 500);
                } catch (error) {
                    console.error('âŒ Error rendering visualization:', error);
                    console.error('Stack trace:', error.stack);
                }
            } else {
                console.error('âŒ PerformanceVizV2 class not loaded. Make sure performance-viz-v2.js is included.');
            }
        }

        // Run comparison
        async function runComparison() {
            const question = document.getElementById('question').value.trim();
            const model_id = document.getElementById('model').value;
            const budget = parseInt(document.getElementById('budget').value);

            if (!question) {
                showError('Please enter a question');
                return;
            }
            if (!model_id) {
                showError('Please select a model');
                return;
            }

            // Additional validation for match_frontier use case
            if (currentUseCase === 'match_frontier') {
                const frontier_model_id = document.getElementById('frontierModel').value;
                if (!frontier_model_id) {
                    showError('Please select a frontier model');
                    return;
                }
            }

            const runButton = document.getElementById('runButton');
            runButton.disabled = true;
            runButton.textContent = 'Running...';
            isRunning = true; // Set running flag
            showLoading();

            try {
                const requestBody = {
                    question,
                    model_id,
                    algorithm: selectedAlgorithm,
                    budget,
                    use_case: currentUseCase,
                };

                // Add frontier model if using match_frontier use case
                if (currentUseCase === 'match_frontier') {
                    requestBody.frontier_model_id = document.getElementById('frontierModel').value;
                }

                // Add tool calling parameters for tool_consensus use case
                if (currentUseCase === 'tool_consensus') {
                    requestBody.enable_tools = true;
                    requestBody.tool_vote = 'tool_name';  // Default to tool_name voting
                    requestBody.exclude_args = [];
                }

                const response = await fetch(`${API_BASE_URL}/compare`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestBody),
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.detail || 'Comparison failed');
                }

                const data = await response.json();
                displayResults(data);
            } catch (error) {
                console.error('Error running comparison:', error);
                showError(`Error: ${error.message}`);

                if (currentUseCase === 'match_frontier') {
                    document.getElementById('smallBaselineContent').innerHTML = '<div class="empty-state">Error occurred</div>';
                }
                document.getElementById('middlePaneContent').innerHTML = '<div class="empty-state">Error occurred</div>';
                document.getElementById('rightPaneContent').innerHTML = '<div class="empty-state">Error occurred</div>';
            } finally {
                runButton.disabled = false;
                runButton.textContent = 'Run Comparison';
                isRunning = false; // Reset running flag
            }
        }

        // Wait for KaTeX to load
        function initializeApp() {
            checkSavedExperience();
        }

        // Initialize when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeApp);
        } else {
            initializeApp();
        }
    </script>

    <!-- Performance Visualization V2 JS -->
    <script src="performance-viz-v2.js"></script>

    <!-- Guided Demo Flow JS -->
    <script src="guided-demo.js"></script>
</body>
</html>
